# This is an OpenAPI Specification (https://swagger.io/specification/)
# for the Personal Demographics Service (PDS) API
# owned by NHS Digital (https://digital.nhs.uk/)
openapi: "3.0.0"
info:
  version: "{VERSION}"
  title: Personal Demographics Service (FHIR) API
  description: |
    ## Overview 
    Use this API to access the [Personal Demographics Service (PDS)](https://digital.nhs.uk/services/demographics) - the national electronic database of NHS patient details such as name, address, date of birth, related people, registered GP practice and NHS number.

    This API has three access modes, which give you different functionality and ways of authenticating. Depending on your access mode, you may:
    * search for patients
    * get patient details
    * update patient details
    * get a patient's related people
    * get patient coverage
    * update patient coverage


    You cannot currently use this API to:
    * create a new record for a birth - use [PDS HL7 V3 API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-hl7-v3)
    * receive birth notifications - use [PDS HL7 V3 API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-hl7-v3) or [PDS Notifications FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir) 
    * create a record for a new patient - use [PDS HL7 V3 API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-hl7-v3)
    * register a new patient at a GP Practice - use [NHAIS GP Links API](https://digital.nhs.uk/developer/api-catalogue/nhais-gp-links)
    * receive patient death notifications - use [PDS Notifications FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir) 
    * receive notifications about a patient's change of address - use [PDS Notifications FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir) 
    * receive notifications about a patient's change of GP - use [PDS Notifications FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir) 
    * receive notifications about any PDS record change - use [PDS Notifications FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir) 
    
    You can read and update the following data:
    * NHS number (read only)
    * name
    * administrative gender
    * addresses and contact details
    * birth information
    * death information
    * registered GP
    * nominated pharmacy
    * dispensing doctor pharmacy
    * medical appliance supplier pharmacy
    * related people, such as next of kin (read only)
    * patient coverage data
    
    ### Patients included in PDS
    Regardless of nationality, or where they live now, PDS includes all patients who have ever been registered with a GP practice, or treated by a health or care organisation (even as a visitor or migrant) in England, Wales, the Isle of Man, or in a UK Defence Medical Services unit anywhere in the world. 

    All patients in PDS have an NHS number which is unique. The 10-digit NHS number is used in England, Wales, the Isle of Man, Scotland and Northern Ireland, but not the Channel Islands. Scotland and Northern Ireland have their own distinct number ranges.
    
    ## Who can use this API
    This API can only be used where there is a [legal basis](http://digital.nhs.uk/services/demographics/access-data-on-the-personal-demographics-service) to do so. Make sure you have a valid use case before you go too far with your development.  You must demonstrate you have a [valid use case](https://digital.nhs.uk/services/demographics/access-data-on-the-personal-demographics-service) as part of digital onboarding. 
    
    You must do this before you can go live (see ‘Onboarding’ below).

    ### Who can access PDS records
    Health and care organisations in England and the Isle of Man can access PDS records. Legitimate direct care examples include NHS organisations delivering healthcare, local authorities delivering care, third sector and private sector health and care organisations, and developers delivering systems to health and care organisations. 

    Health and care organisations in Wales access their own version of PDS called the Welsh Demographics Service (WDS) which is connected to PDS behind the scenes. 

    Patients who receive health and social care or make use of NHS services in England, Wales and the Isle of Man can access their own PDS records. 

    Health and care organisations and patients in Scotland, Northern Ireland and the Channel Islands access their own equivalents of PDS.

    ### Existing API users
    To find out which healthcare software development organisations and products are already using this API, see [PDS FHIR API - integrated products](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir/integrated-products).

    ## Access modes
    This API has three access modes. They are: 
    * healthcare worker access 
    * patient access 
    * restricted access 

    ### Healthcare worker access 
    If the end user is a healthcare worker then you must use this access mode. Use this access mode to: 
    * search for patients – and be able to present a list of matches for the user to choose from 
    * get patient details 
    * update patient details 
    * get a patient's related people

    This access mode is [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis), meaning an end user must be present, authenticated and authorised. 

    The end user must be: 
    * a healthcare worker 
    * strongly authenticated, using [NHS Care Identity Service 2 (NHS CIS2)](https://digital.nhs.uk/services/care-identity-service/applications-and-services/cis2-authentication)
    * authorised, using [national role-based access control (RBAC)](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/national-rbac-for-developers)

    To use this access mode, use one of the following security patterns:
    
    |	Security pattern		                                                                                                                                                                                                  |	Technical details	                                             |	Advantages                                                              | Disadvantages                                                             |
    |-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| ---------------------------------------------------------| -------------------------------------------------------------------------|---------------------------------------------------------------------------|
    |[NHS CIS2 - combined authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-combined-authentication-and-authorisation) |OAuth 2.0 authorisation code flow with API key and secret |No need to integrate and onboard separately with NHS CIS2.                |No access to user information.<br> Not recommended for use in GP software.     |
    |[NHS CIS2 - separate authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-separate-authentication-and-authorisation) |OAuth 2.0 token exchange with signed JWT                  |Gives access to user information.<br>Recommended for use in GP software.     |Need to integrate and onboard separately with NHS CIS2.                    |

    This access mode is available in production ([beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status)).  

    ### Patient access 
    If the end user is a patient then you must use this access mode. Use this access mode to: 
    * get the patient’s own details 
    * update the patient’s own details (limited)
    * get the patient's related people
    * get patient coverage (for specific use cases only)
    * update patient coverage (for specific use cases only)

    This access mode is [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis), meaning an end user must be present, authenticated and authorised. 
    
    The end user must be: 
    * a patient who receives health and social care or makes use of NHS services 
    * strongly authenticated, using [NHS login](https://digital.nhs.uk/services/nhs-login)

    To use this access mode, use one of the following security patterns:
    
    |	Security pattern		                                                                                                                                                                                                          |	Technical details	                                  |	Advantages	                                                | Disadvantages                                           |
    |-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| ----------------------------------------------------| ------------------------------------------------------------|---------------------------------------------------------|
    |[NHS login - combined authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-login-combined-authentication-and-authorisation) |OAuth 2.0 authorisation code with API key and secret |No need to integrate and onboard separately with NHS login.  |No access to user information.                           |
    |[NHS login - separate authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-login-separate-authentication-and-authorisation) |OAuth 2.0 token exchange with signed JWT             |Gives access to user information.                            |Need to integrate and onboard separately with NHS login. |

    Patient access mode users must be authenticated to a high proofing level (P9) and to one of the following [vectors of trust](https://nhsconnect.github.io/nhslogin/vectors-of-trust/): 
    * P9.Cp.Cd
    * P9.Cp.Ck
    * P9.Cm
    
    This access mode is available in production ([beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status)).

    ### Restricted access
    You must only use this access mode if you need to: 
    * search for a patient and get a single match result returned 
    * get a patient's details
    * get a patient's related people

    This access mode is [application-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#application-restricted-apis), meaning we authenticate and authorise the calling application but not the end user. 

    This access mode is not designed to be accessed by an end user. You might use this access mode as part of a back-end process to: 
    * retrieve NHS numbers for data flowing from one system to another
    *	verify an NHS number
    *	get a patient’s registered GP practice or contact details

    To use this access mode, use this security pattern:
    * [Application-restricted RESTful API - signed JWT authentication](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/application-restricted-restful-apis-signed-jwt-authentication)

    Available in production ([stable](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status))
    
    ## Roadmap
    The [Personal Demographics Service (PDS) ](https://digital.nhs.uk/services/personal-demographics-service/pds-roadmap-and-strategy) roadmap shows the planned changes for PDS products, including the PDS FHIR API. 

    To see our roadmap, or to suggest, comment or vote on features for this API, see our [interactive product backlog](https://nhs-digital-api-management.featureupvote.com/?order=popular&filter=allexceptdone&tag=pds-fhir-api).
    
    If you have any other queries, please [contact us](https://digital.nhs.uk/developer/help-and-support).

    ## Service level
    
    This API is a platinum service, meaning it is operational and supported 24 hours a day, 365 days a year.

    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).
    
    ## Rate limits

    The default rate limit is 5TPS (Transactions Per Second), per app. If you require a higher rate limit please [contact us](https://digital.nhs.uk/developer/help-and-support). or raise this during the onboarding process.

    ## Technology
    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).

    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir) global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.

    It includes some country-specific FHIR extensions, which are built against [FHIR UK Core](https://digital.nhs.uk/services/fhir-uk-core), specifically [UK.core.r4 1.0.0](https://simplifier.net/packages/uk.core.r4/1.0.0).
    
    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules.
    In particular:
    - resource names are capitalised and singular, for example `/Patient` not `/patients`
    - array names are singular, for example `line` not `lines` for address lines
    - data items that are country-specific and thus not included in the FHIR global base resources are usually wrapped in an `extension` object

    There are [libraries and SDKs available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.

    ## Network access
    This API is available on the internet and, indirectly, on the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network).

    To use this API with [NHS smartcards](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/nhs-smartcards-for-developers), the end user needs an HSCN connection, although internet-facing alternatives to smartcards are available.
    
    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).
       
    ## Errors
    We use standard HTTP status codes to show whether an API request succeeded or not. They are usually in the range:

    * 200 to 299 if it succeeded, including code 202 if it was accepted by an API that needs to wait for further action
    * 400 to 499 if it failed because of a client error by your application
    * 500 to 599 if it failed because of an error on our server
    
    Errors specific to each API are shown in the Endpoints section, under Response. See our [reference guide](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#http-status-codes) for more on errors.

    Your API-calling application should have a mechanism to automatically try again, for example by giving status information to your end user, before giving up. See our [reference guide](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#error-handling) for more information about error handling.
    
    ## Open source
    You might find the following [open source](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#open-source) resources useful:

    | Resource                  | Description                                                          | Links                                                                          |
    |---------------------------|----------------------------------------------------------------------|--------------------------------------------------------------------------------|
    | PDS FHIR API              | Source code for the API proxy, sandbox and specification.            | [GitHub repo](https://github.com/NHSDigital/personal-demographics-service-api) |
    | FHIR libraries and SDKs   | Various open source libraries for integrating with FHIR APIs.        | [FHIR libraries and SDKs](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) |
    | nhs-number                | Python package containing utilities for NHS numbers including validity checks, normalisation and generation. | [GitHub repo](https://github.com/uk-fci/nhs-number) \| [Python Package index](https://pypi.org/project/nhs-number/) \| [Docs](https://nhs-number.uk-fci.tech/) |

    We currently don't have any open source client libraries or sample code for this API. If you think this would be useful, you can [upvote the suggestion on our Interactive Product Backlog](https://nhs-digital-api-management.featureupvote.com/suggestions/107439/client-libraries-and-reference-implementations).

    The source code for the PDS FHIR back end (the Core Spine source code) is not currently in the open. If you think this would be useful, you can [upvote the suggestion on our Interactive Product Backlog](https://nhs-digital-api-management.featureupvote.com/suggestions/466692/open-source-core-spine-including-pds-eps-scr-and-more).

    ## Environments and testing

    | Environment       | Base URL                                                               |
    | ----------------- | ---------------------------------------------------------------------- |
    | Sandbox           | `https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4/`    |
    | Integration test  | `https://int.api.service.nhs.uk/personal-demographics/FHIR/R4/`        |
    | Production        | `https://api.service.nhs.uk/personal-demographics/FHIR/R4/`            |

    ### Sandbox testing
    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing):
    * is for early developer testing
    * only covers a limited set of scenarios
    * is stateless, so does not actually persist any updates
    * is open access, so does not allow you to test authorisation

    For details of sandbox test scenarios, or to try out the sandbox using our 'Try this API' feature, see the documentation for each endpoint.

    Alternatively, you can try out the sandbox using our Postman collection:
    
    [![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/32547823-005ebee4-7510-44c3-bb0e-58f26b2ba747)

    ### Integration testing
    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing):
    * is for formal integration testing
    * is stateful, so persists updates
    * includes authorisation, with options for user-restricted access (with or without [smartcards](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/nhs-smartcards-for-developers) and application-restricted access
         
    For read-only testing, you can either use our [PDS FHIR API test data packs](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir/pds-fhir-api-test-data) or set up your own test data.
    
    To test updating patient details, you must set up your own test data.

    For more details see [integration testing with our RESTful APIs](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing-with-our-restful-apis).

    ### Production smoke testing
    You must not use real patient data for smoke testing in the production environment.
    
    Rather, use our [production test patient](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir/pds-fhir-api-test-data#production-smoke-testing).

    ## Onboarding
    You need to get your software approved by us before it can go live with this API. We call this onboarding. The onboarding process can sometimes be quite long, so it’s worth planning well ahead.
    
    As part of this process, you need to demonstrate your technical conformance to the requirements for this API. For more details according to your access mode, see:
    * [PDS FHIR API technical conformance - application-restricted access mode](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir/pds-fhir-technical-conformance---application-restricted-access-mode)
    * [PDS FHIR API technical conformance - healthcare worker access mode](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir/pds-fhir-technical-conformance---healthcare-worker-access-mode)

    You also need to demonstrate that you can manage risks. This might impact the design of your software. For details, see [Onboarding support information](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir/onboarding-support-information).
    
    To understand how our online digital onboarding process works, see [digital onboarding](https://digital.nhs.uk/developer/guides-and-documentation/digital-onboarding). 
    
    <div class="nhsd-m-emphasis-box nhsd-m-emphasis-box--emphasis nhsd-!t-margin-bottom-6" aria-label="Highlighted Information">
        <div class="nhsd-a-box nhsd-a-box--border-blue">
            <div class="nhsd-m-emphasis-box__image-box">
                <figure class="nhsd-a-image">
                    <picture class="nhsd-a-image__picture">
                        <img src="http://digital.nhs.uk/binaries/content/gallery/icons/play-circle.svg?colour=231f20" alt="" style="object-fit:fill">
                    </picture>
                </figure>
            </div>
            <div class="nhsd-m-emphasis-box__content-box">
                <div data-uipath="website.contentblock.emphasis.content" class="nhsd-t-word-break"><p class="nhsd-t-body">To get started, sign in or create a <a href="https://onboarding.prod.api.platform.nhs.uk/">developer account</a>, then select 'product onboarding'.</p></div>            
            </div>
        </div>
    </div>

    ## Related APIs

    The following APIs are related to this API:

    ### Personal Demographics Service (PDS) HL7 V3 API
    Use [PDS HL7 V3 API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-hl7-v3) if you want to use functions that are not yet available on the FHIR API, such as creating a new record for a birth, receiving birth notifications, or creating a record for a new patient (except when registering a new patient at a GP Practice, use [Primary Care Registration Management (PCRM)](https://digital.nhs.uk/services/primary-care-registration-management)). For birth notifications, another option is [PDS Notifications - FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir).

    Once our roadmap is complete, PDS HL7 V3 API will become redundant. 
    
    ### Personal Demographics Service (PDS) Notifications - FHIR API
    Use [PDS Notifications - FHIR API](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-notifications-fhir) to subscribe to be notified of a set of patient record changes, including any record update, birth, death, change of address and change of GP.
    
    ### Organisation Data Service FHIR API  
    Use [Organisation Data Service FHIR API](https://developer.nhs.uk/apis/ods/) to get full details for the organisations related to the patient, such as their registered GP or nominated pharmacy.
    
    ### Ordnance Survey (OS Places) API  
    Use [Ordnance Survey (OS Places) API](https://digital.nhs.uk/developer/api-catalogue/ordnance-survey-places-api) to identify, look up and verify addresses prior to a PDS update.

    <div class="nhsd-m-emphasis-box nhsd-m-emphasis-box--emphasis nhsd-!t-margin-bottom-6" aria-label="Highlighted Information">
        <div class="nhsd-a-box nhsd-a-box--border-blue">
          <div class="nhsd-m-emphasis-box__content-box">
            <div data-uipath="website.contentblock.emphasis.content" class="nhsd-t-word-break"><p class="nhsd-t-body"><strong><a href="https://fhir.nhs.uk/Id/ods-organization-code">ODS codes and documentation</a></strong></p></div>            
            </div>
          </div>
        </div>
    </div>
  contact:
    name: Personal Demographics Service FHIR API Support
    url: 'https://digital.nhs.uk/developer/help-and-support'
    email: ssd.nationalservicedesk@nhs.net
servers:
  - url: 'https://sandbox.api.service.nhs.uk/personal-demographics/FHIR/R4'
    description: Sandbox environment.
  - url: 'https://int.api.service.nhs.uk/personal-demographics/FHIR/R4'
    description: Integration test environment.
  - url: 'https://api.service.nhs.uk/personal-demographics/FHIR/R4'
    description: Production environment.
paths:
  '/Patient':
    parameters:
    - $ref: '#/components/parameters/BearerAuthorization'
    - $ref: '#/components/parameters/RoleId'
    - $ref: '#/components/parameters/RequestID'
    - $ref: '#/components/parameters/CorrelationID'
    - $ref: '#/components/parameters/NHSD-End-User-Organisation-ODS'
    get:
      $ref: 'components/paths/patient-search.yaml'
  '/Patient/{id}':
    parameters:
      - $ref: '#/components/parameters/Id'
      - $ref: '#/components/parameters/BearerAuthorization'
      - $ref: '#/components/parameters/RoleId'
      - $ref: '#/components/parameters/RequestID'
      - $ref: '#/components/parameters/CorrelationID'
      - $ref: '#/components/parameters/NHSD-End-User-Organisation-ODS'
    get:
      $ref: 'components/paths/patient-get.yaml'
    patch:
      $ref: 'components/paths/patient-patch.yaml'
  '/Patient/{id}/RelatedPerson':
    get:
      $ref: 'components/paths/relatedpersons-get.yaml'
  '/Coverage':
    get:
      $ref: 'components/paths/coverage-get.yaml'
    post:
      $ref: 'components/paths/coverage-post.yaml'
components:
  headers:
    ETag:
      $ref: 'components/schemas/ETag.yaml'
    X-Correlation-Id:
      $ref: 'components/schemas/XCorrelationId.yaml'
    X-Request-Id:
      $ref: 'components/schemas/XRequestID.yaml'
    RetryAfter:
      $ref: 'components/schemas/RetryAfter.yaml'
  parameters:
    Id:
      name: id
      in: path
      description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
      required: true
      schema:
        type: string
        example: "9000000009"
    MessageId:
      name: message_id
      in: path
      description: The message ID of the accepted update that needs to be submitted to confirm the resource a successfully updated.
      required: true
      schema:
        type: string
        example: '20200522091633363041_000001A'
    ObjectId:
      name: object_id
      in: path
      description: A resource Object ID. The primary identifier of a resource.
      required: true
      schema:
        type: string
        example: "507B7621"
    IfMatch:
      in: header
      name: If-Match
      description: |
        Latest known version identifier enclosed in quotes preceded by `W/`.

        Send the value of the patient's `ETag` response header on patient retrieval when updating a patient.
        This is to ensure that any updates are applied against an up-to-date version of the patient resource.
      required: true
      schema:
        type: string
        pattern: "^W\/\"[0-9]+\"$"  # Printable characters enclosed in quotes. See: https://tools.ietf.org/html/rfc7230#section-3.2.6
        example: 'W/"2"'
    RoleId:
      in: header
      name: NHSD-Session-URID
      description: |
      
        The user role ID (URID) for the current session. Also known as a user role profile ID (URPID).

        This header is optional.
        
        In Application-restricted and Patient access mode this header is ignored.

        In Healthcare worker access mode if you send this header it must be valid for the logged-in user. See [determine the user's role](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-separate-authentication-and-authorisation#step-9-determine-the-user-s-role) for guidance.
        
      required: false
      schema:
        type: string
        pattern: '^[0-9]+$'
        example: '555254240100'
    BearerAuthorization:
      in: header
      name: Authorization
      description: |
        An [OAuth 2.0 bearer token](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis).

        Required in all environments except sandbox.
      required: false
      schema:
        type: string
        format: '^Bearer\ [[:ascii:]]+$'
        example: 'Bearer g1112R_ccQ1Ebbb4gtHBP1aaaNM'
    ContentType:
      in: header
      name: Content-Type
      description: |
        For a PATCH request, this must be set to `application/json-patch+json`.
      required: true
      schema:
        type: string
        example: application/json-patch+json
    RequestID:
      in: header
      name: X-Request-ID
      required: true
      description: |
        A globally unique identifier (GUID) for the request, which we use to de-duplicate repeated requests and to trace the request if you contact our helpdesk.
        
        Must be a universally unique identifier (UUID) (ideally version 4).

        Mirrored back in a response header.

        This is a mandatory header.

        If you re-send a failed request, use the same value in this header.
      schema:
        type: string
        pattern: '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$'
        example: 60E0B220-8136-4CA5-AE46-1D97EF59D068
    CorrelationID:
      in: header
      name: X-Correlation-ID
      required: false
      description: |
        An optional ID which you can use to track transactions across multiple systems. It can take any value, but we recommend avoiding `.` characters.
        
        Mirrored back in a response header.
      schema:
        type: string
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
    NHSD-End-User-Organisation-ODS:
      in: header
      name: NHSD-End-User-Organisation-ODS
      required: false
      description: |
        The ODS code of the user.
        
        Mandatory for client applications which service multiple end user organisations (EUO). This will allow the calls to be attributed to the correct EUO.
      schema:
        type: string
        example: Y12345
    FuzzyMatch:
      name: _fuzzy-match
      description: |
        A fuzzy search is performed, including checks for homophones, transposed names and historic information.

        You cannot use wildcards with a fuzzy search.
      example: false
      in: query
      required: false
      schema:
        type: boolean
        default: false
    ExactMatch:
      name: _exact-match
      description: The search only returns results where the `score` field is 1.0. Use this with care - it is unlikely to work with fuzzy search or wildcards.
      example: false
      in: query
      required: false
      schema:
        type: boolean
        default: false
    History:
      name: _history
      description: |
        The search looks for matches in historic information such as previous names and addresses.

        This parameter has no effect for a fuzzy search, which always includes historic information.
      example: false
      in: query
      required: false
      schema:
        type: boolean
        default: false
    MaxResults:
      name: _max-results
      description: |
        The maximum number of matching patients to return. For healthcare worker access, this must be between 1 and 50, and the default is 50.
        For application-restricted access, this must be 1, and the default is 1.
        If too many patients match the search criteria, we return a `TOO_MANY_MATCHES` error.
      example: 1
      in: query
      required: false
      schema:
        type: integer
        format: int32
    Family:
      name: family
      description: |
        The patient's family name (surname).

        Not case sensitive. Max 35 characters.
        Use `*` as a wildcard but not in the first two characters and not in fuzzy search mode.
        Must be [URL encoded](https://en.wikipedia.org/wiki/Percent-encoding), for example a space must be represented by either `%20` or `+` and a wildcard must be encoded as `%2A`.
      examples:
        simple:
          value: Smith
          summary: Matches Smythe if `_fuzzy-match` is specified.
        wildcarded:
          value: "Sm*t*"
          summary: 'Wildcards must contain at least two characters, this matches Smith, Smythe'
      in: query
      required: false
      schema:
        type: string
    Given:
      name: given
      description: |
        The patient's given names, including their first and middle names.

        Not case sensitive. Max 35 characters.
        Use `*` as a wildcard but not in the first two characters and not in fuzzy search mode.
        Wildcard searches will match the start of the first given name and not subsequent given names, for example the given names "Alan Michael" can be searched with "Ala*" but not "Mic*".
        Must be [URL encoded](https://en.wikipedia.org/wiki/Percent-encoding), for example a space must be represented by either `%20` or `+` and a wildcard must be encoded as `%2A`.

        A patient may have more than one given name, for example because they have a first name and a middle name.
        Specify multiple given names by repeating this parameter.
        To search for  `Jane Anne Smith` use `given=Jane&given=Anne&family=Smith`.

        The first name may be a [compound name](https://en.wikipedia.org/wiki/Given_name#Compound), for example `John Paul`.
        To search for `John Paul James Smith` (where `John Paul` is the first name, `James` is the middle name, and `Smith` the family name) use `given=John%20Paul&given=James&family=Smith`.

        It is not necessary to specify subsequent given names, and doing so may impact your search results if they are not recorded in the PDS.
      example: Jane
      in: query
      required: false
      schema:
        type: array
        items:
          type: string
    Gender:
      name: gender
      description: This is the gender that is recorded on official documents, for example a birth certificate or passport. For some people, the gender held in PDS might not match the gender they identify with.
      example: female
      in: query
      required: false
      schema:
        type: string
        enum:
          - male
          - female
          - other
          - unknown
        example: female
    Birthdate:
      name: birthdate
      in: query
      description: Date of birth in the format `<eq|ge|le>yyyy-mm-dd`. To specify a range, use `birthdate=geyyyy-mm-dd&birthdate=leyyyy-mm-dd`.
      examples:
        simple:
          value:
            - eq2010-10-22
          description: Exact match date
        rangege:
          value:
            - ge2010-10-22
          description: Greater than or equals match, which matches 2010-10-22 or 2010-10-23
        rangele:
          value:
            - le2010-10-22
          description: Less than or equals match, which matches 2010-10-22 or 2010-10-21
      required: false
      schema:
        type: array
        items:
          type: string
    DeathDate:
      name: death-date
      in: query
      description: |
        Date of death in the format `<eq|ge|le>yyyy-mm-dd`. To specify a range, use `death-date=geyyyy-mm-dd&death-date=leyyyy-mm-dd`.

        For a fuzzy search, this is ignored for matching but included in the score calculation.
      examples:
        simple:
          value: eq2010-10-22
          description: Exact match date
        rangege:
          value: ge2010-10-22
          description: Greater than or equals match which matches 2010-10-22 or 2010-10-23
        rangele:
          value: 'le2010-10-22'
          description: Less than or equals match, which matches 2010-10-22 or 2010-10-21
      required: false
      schema:
        type: string
        format: date
    AddressPostalcode:
      name: address-postalcode
      description: |
        The postcode of any of the patient’s known addresses.

        Not case sensitive.
        Spaces are ignored, for example `LS16AE` and `LS1 6AE` both match `LS1 6AE`.
        Use `*` as a wildcard but not in the first two characters and not in fuzzy search mode.
        Must be [URL encoded](https://en.wikipedia.org/wiki/Percent-encoding), for example a space must be represented by either `%20` or `+` and a wildcard must be encoded as `%2A`.
      examples:
        simple:
          value: LS1 6AE
          summary: 'Spaces ignored, would match LS16AE'
        wildcarded:
          value: "LS1*"
          summary: "Matches 'LS16AE', 'LS1 6AE' and 'LS1 6AB'"
      in: query
      required: false
      schema:
        type: string
    AddressPostcode:
      name: address-postcode
      description: |
        **N.B. that address-postcode will be deprecated in the future, address-postalcode should be used instead. 
        If both address-postcode and address-postalcode are provided, an INVALID_SEARCH_DATA error will be returned.**
        The postcode of any of the patient’s known addresses.

        Not case sensitive.
        Spaces are ignored, for example `LS16AE` and `LS1 6AE` both match `LS1 6AE`.
        Use `*` as a wildcard but not in the first two characters and not in fuzzy search mode.
        Must be [URL encoded](https://en.wikipedia.org/wiki/Percent-encoding), for example a space must be represented by either `%20` or `+` and a wildcard must be encoded as `%2A`.
      examples:
        simple:
          value: LS1 6AE
          summary: 'Spaces ignored, would match LS16AE'
        wildcarded:
          value: "LS1*"
          summary: "Matches 'LS16AE', 'LS1 6AE' and 'LS1 6AB'"
      in: query
      required: false
      schema:
        type: string
    GeneralPractitioner:
      name: general-practitioner
      description: |
        The Organisation Data Service (ODS) code of the patient's registered GP practice.

        Not case sensitive.
        For a fuzzy search, this is ignored for matching but included in the score calculation.
      example: Y12345
      in: query
      required: false
      schema:
        type: string
    ManagingOrganization:
      name: managing-organization
      description: |
        **This field is for internal-use only**.
        
        The Organisation Data Service (ODS) code of the patient's current managing organization.
        Not case sensitive.
        For a fuzzy search, this is ignored for matching but included in the score calculation.
      example: Y12345
      in: query
      required: false
      schema:
        type: string
    ETag:
      name: etag
      schema:
        type: string
        pattern: "^W\/\"[0-9]+\"$" # Printable characters enclosed in quotes. See: https://tools.ietf.org/html/rfc7230#section-3.2.6
        example: W/"2"
      in: header
      description: |
        Record version identifier enclosed in quotes and preceded by 'W/'. For example, `W/"2"`.

        Corresponds to `meta.versionId` attribute in the patient resource body.

        When you retrieve a patient resource, you get a version number for the resource (in the `ETag` response header and in the `versionId` field in the response).
        You must then pass the resource's version number in any update request (in the `If-Match` response header) made for the patient.
    XCorrelationId:
      name: x-correlation-id
      schema:
        type: string
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
      in: header
      description: |
        The X-Correlation-ID from the request header, if supplied, mirrored back.
    RetryAfter:
      name: retry-after
      description: Time to wait before retrying your request in seconds
      in: header
      schema:
        type: string
        example: "5"    
    EmailAddress:
      name: email
      description: |
        Email address
      example: jane.smith@example.com
      in: query
      required: false
      schema:
        type: string
    PhoneNumber:
      name: phone
      description: |
        Phone number
      example: "01632960587"
      in: query
      required: false
      schema:
        type: string
    SubscriberIdentifier:
          name: subscriber:identifier
          description: |
            The NHS number that identifies the holder/subscriber of the coverage.
          examples:
            ehic_holder:
              value: 9733162868
              summary: Returns a bundle that contains a Coverage resource for the patient with NHS number 9733162868.
            no_ehic:
              value: 9733162876
              summary: Returns an empty bundle, alongside a meta object that can be used to apply an update to the patient's coverage.
          in: query
          required: true
          schema:
            type: string
  schemas:
    Patient:
      $ref: components/schemas/Patient.yaml
    PatientSearch:
      $ref: components/schemas/PatientSearch.yaml
    RelatedPersonBundle:
      $ref: components/schemas/RelatedPersonBundle.yaml
    OperationOutcome:
      $ref: components/schemas/OperationOutcome.yaml
  examples:
    OperationOutcome:
      summary: OperationOutcome example
      value:
        resourceType: OperationOutcome
        issue:
          - severity: error
            code: value
            details:
              coding:
                - system: 'https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode'
                  version: '1'
                  code: INVALID_RESOURCE_ID
                  display: Resource Id is invalid
