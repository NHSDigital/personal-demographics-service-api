parameters:
  - $ref: '#/components/parameters/BearerAuthorization'
  - $ref: '#/components/parameters/RoleId'
  - $ref: '#/components/parameters/RequestID'
  - $ref: '#/components/parameters/CorrelationID'
  - $ref: '#/components/parameters/NHSD-End-User-Organisation-ODS'
get:
    parameters:
      BeneficiaryIdentifier:
        name: beneficiary:identifier
        description: |
          The NHS number that identifies the holder/beneficiary of the coverage.
        examples:
          ehic_holder:
            value: 9733162868
            summary: Returns a bundle that contains a Coverage resource for the patient with NHS number 9733162868.
          no_ehic:
            value: 9733162876
            summary: Returns an empty bundle, alongside a meta object that can be used to apply an update to the patient's coverage.
        in: query
        required: true
        schema:
          type: string
    responses:
      '200':
        description: |
          A completed search for coverage. This will contain zero or one Coverage resources in the Bundle.

        headers:
          X-Correlation-Id:
            $ref: '#/components/headers/X-Correlation-Id'
          X-Request-Id:
            $ref: '#/components/headers/X-Request-Id'

      '4XX':
        description: |
            An error occurred as follows:

            | HTTP status | Error code                 | Description                                                                                                                                |
            | ----------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
            | 400         | INVALID_SEARCH_DATA	       | Invalid combination of search parameters. For details, see the `diagnostics` field.
            | 400         | MISSING_VALUE              | Missing header or query parameter. For details, see the `diagnostics` field.
            | 400         | INVALID_VALUE              | Invalid header or query parameter. For details, see the `diagnostics` field.
            | 401         | ACCESS_DENIED     	       | Access token missing, invalid or expired, or calling application not configured for this operation.
            | 403         | ACCESS_DENIED     	       | User cannot perform this operation.
            | 404         | RESOURCE_NOT_FOUND         | Patient does not exist for given NHS number.
            | 404         | INVALIDATED_RESOURCE       | Patient did exist for given NHS number, but has been invalidated and not superseded by another NHS number.
            | 408         | UNABLE_TO_CALL_SERVICE     | The downstream domain processing has not completed within the configured timeout period.
            | 429         | TOO_MANY_REQUESTS          | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits).

        headers:
          X-Correlation-Id:
            $ref: '#/components/headers/X-Correlation-Id'
          X-Request-Id:
            $ref: '#/components/headers/X-Request-Id'

        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/OperationOutcome'
            example:
              resourceType: OperationOutcome
              issue:
                - severity: error
                  code: forbidden
                  details:
                    coding:
                      - system: 'https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode'
                        version: '1'
                        code: ACCESS_DENIED
                        display: Cannot GET resource with user-restricted access token
                  diagnostics: "Your app has insufficient permissions to use this operation. Please contact support."
post:
    parameters:
      - $ref: '#/components/parameters/IfMatch'
    responses:
      '2XX':
        description: |
          A completed update to coverage. This will contain the Coverage resource just posted in the Bundle.
            | HTTP status | Error code                 | Description                                                                                                                                |
            | ----------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
            | 200         |                            | Coverage successfully updated
            | 201         |                            | Coverage successfully added

        headers:
          X-Correlation-Id:
            $ref: '#/components/headers/X-Correlation-Id'
          X-Request-Id:
            $ref: '#/components/headers/X-Request-Id'

      '4XX':
        description: |
            An error occurred as follows:

            | HTTP status | Error code                 | Description                                                                                                                                |
            | ----------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
            | 400         | MISSING_VALUE              | Missing header or value in the body. For details, see the `diagnostics` field.
            | 400         | INVALID_VALUE              | Invalid header or value in the body. For details, see the `diagnostics` field.
            | 400         | INVALID_UPDATE             | Malformed request body or client error after the update was accepted and patient was not updated.
            | 400         | INVALID_RESOURCE_ID        | Invalid NHS number.
            | 400         | VALIDATION_ERROR           | This is the "default" error thrown when no others are applicable.
            | 401         | ACCESS_DENIED              | Access token missing, invalid or expired, or calling application not configured for this operation (ASID not set for interaction)
            | 404         | RESOURCE_NOT_FOUND         | Patient does not exist for given NHS number.
            | 408         | UNABLE_TO_CALL_SERVICE     | The downstream domain processing has not completed within the configured timeout period.
            | 409         | RESOURCE_VERSION_MISMATCH  | The resource version in the If-Match header of the update request did not match the current version of the resource. See Patient resource versioning.
            | 429         | TOO_MANY_REQUESTS          | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits).
            | 503         | SERVICE_UNAVAILABLE        | The request timed out during processing. This does not imply the request has failed or been rejected.
            | 400	        | TOO_FEW_VALUES_SUBMITTED	 | The field in question has a minimum number of items and the user sent too few.
            | 400	        | TOO_MANY_VALUES_SUBMITTED	 | The field in question has a maximum number of items and the user sent too many.
            | 403	        | FORBIDDEN_UPDATE	         | The user is not permitted to update certain resources or elements, for example most users are not allowed to update the date of death once it has been set. A detailed description will be added to the display. For example - updating a sensitive patient or adding a formal death notification is only permitted from certain systems.
            | 403	        | ACCESS_DENIED	             | Patient cannot perform this action.
            | 412	        | PRECONDITION_FAILED	       | Problem with request, for example missing If-Match header. For details, see the diagnostics field.
        headers:
          X-Correlation-Id:
            $ref: '#/components/headers/X-Correlation-Id'
          X-Request-Id:
            $ref: '#/components/headers/X-Request-Id'

        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/OperationOutcome'
            example:
              resourceType: OperationOutcome
              issue:
                - severity: error
                  code: forbidden
                  details:
                    coding:
                      - system: 'https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode'
                        version: '1'
                        code: ACCESS_DENIED
                        display: Cannot POST resource with user-restricted access token
                  diagnostics: "Your app has insufficient permissions to use this operation. Please contact support."