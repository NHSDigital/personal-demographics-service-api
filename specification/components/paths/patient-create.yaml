summary: Create a record for a new patient
operationId: create-patient
description: |
  ## Overview
  Use this endpoint to create a record for a new patient, which involves allocating them a new NHS number. Only use this if a search for the patient has been done and no NHS number can be found.

  You should not use this API to create a new record when registering a new patient at a GP Practice. Instead, use the Primary Care Registration Management - NHS Digital (PCRM) system.

  You should not use this API to create a new record at birth.

  This endpoint is only available to users with Healthcare worker access.

  ## Sandbox test scenarios

  You can test the following scenarios in our sandbox environment.

  | Scenario                                                  | Request                                                                                                      | Response                                            |
  | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------ | --------------------------------------------------- |
  | Patient record is created and allocated a new NHS number	| Body: One of the provided examples or your own combination<br><br>Headers: `Content-Type`=`application/json` | HTTP Status 201 with patient data in response       |
  | Single match found	                                      | Body: Provided example<br><br>Headers: `Content-Type`=`application/json`                                     | HTTP Status 200 with matched NHS number in response |
  | Multiple matches found	                                  | Body: Provided example<br><br>Headers: `Content-Type`=`application/json`                                     | HTTP Status 200 with problem description            |
  | Missing X-Request-ID                                      | X-Request-ID header missing                                                                                  | HTTP Status 400 with problem description            |
  | Invalid X-Request-ID                                      | `X-Request-ID`= `1234`                                                                                       | HTTP Status 400 with problem description            |

  You can try out the sandbox by selecting the 'Try' button at the end of the schema.

  Alternatively, you can try out the sandbox using our Postman collection:

  [![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/32547823-005ebee4-7510-44c3-bb0e-58f26b2ba747)

requestBody:
  required: true
  content:
    application/json:
      schema:
        $ref: '../schemas/PatientCreateRequest.yaml'
      examples:
        create-patient:
          summary: Create a patient
          value:
            $ref: '../examples/requests/PatientCreate/create-patient.json'

responses:
  '201':
    description: |
      New record successfully created. Patient data, including newly allocated NHS number, returned in response.

    headers:
      X-Correlation-Id:
        $ref: '../../personal-demographics.yaml#/components/headers/X-Correlation-Id'
      X-Request-Id:
        $ref: '../../personal-demographics.yaml#/components/headers/X-Request-Id'
    content:
      application/fhir+json:
        schema:
          $ref: '../schemas/Patient.yaml'
        example:
          $ref: '../examples/Patient.json'

  '200':
    description: |
      New record not created. Single or multiple matches found for supplied demographic data.

      | HTTP status | Error code                 | Description                                                                                         |
      | ----------- | -------------------------- | --------------------------------------------------------------------------------------------------- |
      | 200         | SINGLE_MATCH               | Unable to create new patient record. A single matching record found for supplied demographic data.           |
      | 200         | MULTIPLE_MATCHES           | Unable to create new patient record. Multiple matching records found for supplied demographic data. |

    headers:
      X-Correlation-Id:
        $ref: '../../personal-demographics.yaml#/components/headers/X-Correlation-Id'
      X-Request-Id:
        $ref: '../../personal-demographics.yaml#/components/headers/X-Request-Id'
    content:
      application/fhir+json:
        schema:
          $ref: '../../personal-demographics.yaml#/components/schemas/OperationOutcome'
        example:
          resourceType: OperationOutcome
          issue:
            - severity: error
              code: structure
              details:
                coding:
                  - system: 'https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode'
                    version: '1'
                    code: MULTIPLE_MATCHES
                    display: Multiple matches found
              diagnostics: "Unable to create new patient. Multiple matches found for supplied demographic data."

  '4XX':
    description: |
      An error occurred as follows:
      
      | HTTP status | Error code                      | Description |
      | ----------- | ------------------------------- | --------------------------------------------- |
      | 400         | MISSING_VALUE                   | Missing header parameter. For details, see the `diagnostics` field. |
      | 400         | INVALID_VALUE                   | Invalid header parameter or invalid value in body of post request. For details, see the `diagnostics` field. |
      | 400         | VALIDATION_ERROR                | This is the "default" error thrown when no others are applicable. |
      | 400         | UNSUPPORTED_CHARACTERS_IN_FIELD | Invalid value in body of post request. For details, see the `diagnostics` field. |
      | 400         | ADDITIONAL_PROPERTIES           | The user sent additional properties within the dictionary. For example sending a patient post and attempting to include 'pets', which is not an allowed field within the patient resource. |
      | 400         | UNSUPPORTED_VALUE               | There was an unsupported value in the request. The value may be valid in the schema - however it could be a legacy value that we do not allow to be set anymore. The invalid value and field will be presented in the display. |
      | 400         | TOO_FEW_VALUES_SUBMITTED        | The field in question has a minimum number of items and the user sent too few. |
      | 400         | TOO_MANY_VALUES_SUBMITTED       | The field in question has a maximum number of items and the user sent too many. |
      | 401         | ACCESS_DENIED                   | Access token missing, invalid or expired, or calling application not configured for this operation. |
      | 403         | ACCESS_DENIED                   | Patient cannot perform this action. |
      | 408         | UNABLE_TO_CALL_SERVICE          | The downstream domain processing has not completed within the configured timeout period. |
      | 429         | TOO_MANY_REQUESTS               | You have exceeded your application's [rate limit](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#rate-limits). |
    
    headers:
      X-Correlation-Id:
        $ref: '../../personal-demographics.yaml#/components/headers/X-Correlation-Id'
      X-Request-Id:
        $ref: '../../personal-demographics.yaml#/components/headers/X-Request-Id'
    content:
      application/fhir+json:
        schema:
          $ref: '../../personal-demographics.yaml#/components/schemas/OperationOutcome'
        example:
          resourceType: OperationOutcome
          issue:
            - severity: error
              code: structure
              details:
                coding:
                  - system: 'https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode'
                    version: '1'
                    code: INVALID_UPDATE
                    display: Update is invalid
              diagnostics: "Invalid update with error - Update unsupported for resource - 'pets'"      

  '503':
    description: |
      The request timed out during processing. This does not imply the request has failed or been rejected. Error code: `SERVICE_UNAVAILABLE`.

      Re-send the request after the time specified in the `Retry-After` header using the same `X-Request-ID` value.
    headers:
      RetryAfter:
        $ref: '../../personal-demographics.yaml#/components/headers/RetryAfter'
    content:
      application/fhir+json:
        schema:
          $ref: '../../personal-demographics.yaml#/components/schemas/OperationOutcome'
        example:
          resourceType: OperationOutcome
          issue:
            - severity: error
              code: timeout
              details:
                coding:
                  - system: 'https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode'
                    version: '1'
                    code: SERVICE_UNAVAILABLE
                    display: Service unavailable
              diagnostics: "The downstream domain processing has not completed within the configured timeout period. Using the same 'X-Request-ID' header, retry your request after the time specified by the 'Retry-After' response header."

  