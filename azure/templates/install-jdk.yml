parameters:
  - name: service_name
    type: string

steps:
  - bash: |
      set -e

      # Try to find the versioned subfolder inside personal-demographics/
      versioned_dir=$(find personal-demographics -maxdepth 1 -type d -name 'personal-demographics-*+*' | head -n 1)

      if [ -n "$versioned_dir" ]; then
        dir="$versioned_dir"
        echo "Using nested versioned directory: $dir"
      else
        dir="personal-demographics"
        echo "Falling back to base directory: $dir"
      fi

      if [ -f "$dir/Makefile" ]; then
        echo "Makefile found."
      else
        echo "No Makefile found in $dir"
        exit 1
      fi

      cd "$dir"
      make download-openjdk
    displayName: "Download OpenJDK"

  - task: JavaToolInstaller@0
    displayName: Install JRE & JDK v20 x64
    inputs:
      versionSpec: "20"
      jdkArchitectureOption: "x64"
      jdkSourceOption: "LocalDirectory"
      jdkFile: "/tmp/openjdk.tar.gz"
      jdkDestinationDirectory: "/tmp/openjdk"