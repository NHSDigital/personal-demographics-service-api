steps:
  - task: UseNode@1
    inputs:
      version: '20.x'

  - task: Npm@1
    inputs:
      command: 'custom'
      customCommand: 'install newman -g'

  - bash: newman run patient-demographics-sandbox.postman_collection.json -r cli,junit --reporter-junit-export newman-test-report.xml
    workingDirectory: $(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)/postman
    displayName: Run Postman collection tests

  - task: PublishTestResults@2
    displayName: 'Publish Postman collection test results'
    inputs:
      testResultsFiles: $(Pipeline.Workspace)/s/$(SERVICE_NAME)/$(SERVICE_ARTIFACT_NAME)/newman-test-report.xml
      failTaskOnFailedTests: true
