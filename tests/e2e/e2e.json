{
	"info": {
		"_postman_id": "d513cf22-d500-4e2e-bde6-f356130e27cb",
		"name": "Personal Demographics Service",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Framwork Setup",
			"item": [
				{
					"name": "checkSearchMappings",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "002ec4c9-fb6d-4f4f-bde8-e3030c37f4f6",
								"exec": [
									"/*functions*/\r",
									"var checkSearchMappings = () => {\r",
									"\r",
									"/*Resource Type mapping function*/\r",
									"\r",
									"pm.test(\"Resource Type has been mapped correctly\", function () {\r",
									"    pm.expect(response.entry[0].resource.resourceType).to.eql(\"Patient\");\r",
									"    }\r",
									");\r",
									"\r",
									"/*Patient id mapping function*/\r",
									"pm.test(\"Patient 'Id' has been mapped correctly\", function () {\r",
									"    pm.expect(response.entry[0].resource.id).to.eql(pm.variables.get(\"patientId\"));\r",
									"    }\r",
									");\r",
									"\r",
									"/*Identifier Value mapping function*/\r",
									"pm.test(\"Identifier has been mapped correctly\", function () {\r",
									"    \r",
									"    pm.expect(response.entry[0].resource.identifier[0].extension[0].url).to.eql(\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\");\r",
									"    pm.expect(response.entry[0].resource.identifier[0].extension[0].valueCodeableConcept.coding[0].code).to.eql(\"01\");\r",
									"    pm.expect(response.entry[0].resource.identifier[0].extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Number present and verified\");\r",
									"    pm.expect(response.entry[0].resource.identifier[0].extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\");\r",
									"    pm.expect(response.entry[0].resource.identifier[0].value).to.eql(pm.variables.get(\"patientId\"));\r",
									"    }\r",
									");\r",
									"\r",
									"/*Meta version id mapping function\r",
									"pm.test(\"Meta 'versionId' has been mapped correctly\", function () {\r",
									"    console.log(\"expected metaVersionId = \" + (pm.variables.get(\"metaVersionId\")));\r",
									"    console.log(\"returned metaVersionId = \" + (response.entry[0].resource.meta.versionId));\r",
									"    pm.expect(response.entry[0].resource.meta.versionId).to.eql(pm.variables.get(\"metaVersionId\"));\r",
									"    }\r",
									");*/\r",
									"\r",
									"/*Check Name Related items*/\r",
									"\r",
									"/*Check family has been populated properly*/\r",
									"pm.test(\"Name 'family' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].family).to.eql(pm.variables.get(\"family\"));\r",
									"});\r",
									"\r",
									"/*Check given has been populated properly*/\r",
									"pm.test(\"Name 'given' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].given).to.eql(pm.variables.get(\"given\"));\r",
									"});\r",
									"\r",
									"/*Check prefix has been populated properly*/\r",
									"pm.test(\"Name 'prefix' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].prefix[0]).to.eql(pm.variables.get(\"prefix\"));\r",
									"});\r",
									"\r",
									"/*Check suffix has been populated properly*/\r",
									"pm.test(\"Name 'suffix' has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"suffix\")  === undefined ) {\r",
									"        pm.expect(response.entry[0].resource.name[0].suffix).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        pm.expect(response.entry[0].resource.name[0].suffix).to.eql(pm.variables.get(\"suffix\"));\r",
									"    }\r",
									"    pm.variables.unset(\"suffix\");\r",
									"}\r",
									"\r",
									");\r",
									"\r",
									"/*Check name use has been populated properly*/\r",
									"pm.test(\"Name 'type' has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"nameType\") == \"Usual name\") {\r",
									"            pm.expect(response.entry[0].resource.name[0].use).to.eql(\"usual\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == \"alias\") {\r",
									"            pm.expect(response.entry[0].resource.name[1].use).to.eql(\"temp\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == \"preferred\") {\r",
									"            pm.expect(response.entry[0].resource.name[1].use).to.eql(\"nickname\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"previous\")) {\r",
									"            pm.expect(response.entry[0].resource.name[1].use).to.eql(\"old\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"birth\")) {\r",
									"            pm.expect(response.entry[0].resource.name[1].use).to.eql(\"old\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"bachelor\")) {\r",
									"            pm.expect(response.entry[0].resource.name[1].use).to.eql(\"maiden\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"maiden\")) {\r",
									"            pm.expect(response.entry[0].resource.name[1].use).to.eql(\"maiden\");\r",
									"    }\r",
									"    else pm.expect.fail(\"fail\");\r",
									"});\r",
									"\r",
									"\r",
									"/*Check name start date has been populated properly*/\r",
									"pm.test(\"Name 'startdate' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].period.start).to.eql(pm.variables.get(\"namePeriodStart\"));\r",
									"});\r",
									"\r",
									"/*gender mapping function*/\r",
									"pm.test(\"Gender has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"gender\") == \"female\") {\r",
									"            pm.expect(response.entry[0].resource.gender).to.eql(\"female\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"gender\") == \"male\") {\r",
									"            pm.expect(response.entry[0].resource.gender).to.eql(\"male\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"gender\") == \"not known\") {\r",
									"            pm.expect(response.entry[0].resource.gender).to.eql(\"unknown\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"gender\") == \"not specified\") {\r",
									"            pm.expect(response.entry[0].resource.gender).to.eql(\"other\");\r",
									"    }\r",
									"    else pm.expect.fail(\"fail\");\r",
									"});\r",
									"\r",
									"/*Birthday mapping function*/\r",
									"pm.test(\"BirthDate has been mapped correctly\", function () {\r",
									"    pm.expect(response.entry[0].resource.birthDate).to.eql(pm.variables.get(\"birthdate\"));\r",
									"    }\r",
									");\r",
									"\r",
									"/*deceasedDateTime mapping function*/\r",
									"pm.test(\"deceasedDateTime has been mapped correctly\", function () {\r",
									"   let deceasedDateTimeExists = (pm.variables.get(\"deceasedDateTime\"));\r",
									"   if (!deceasedDateTimeExists) {\r",
									"       pm.expect(response.entry[0].resource.deceasedDateTime).to.eql(undefined);\r",
									"   }\r",
									"   else if (deceasedDateTimeExists) {\r",
									"    pm.expect((response.entry[0].resource.deceasedDateTime).substring(0,10)).to.eql((pm.variables.get(\"deceasedDateTime\")));\r",
									"    }\r",
									"    pm.variables.unset(\"deceasedDateTime\");\r",
									"});\r",
									"\r",
									"/*Check Address Related items*/\r",
									"\r",
									"/*address line mapping function*/\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test('Address is not displayed for Sensitive Patient', () => {\r",
									"        pm.expect(response.entry[0].resource.address).to.be.undefined;\r",
									"    });\r",
									"} else {\r",
									"    pm.test(\"Address has been mapped correctly\", function () {\r",
									"        pm.expect(JSON.stringify(response.entry[0].resource.address[0].line)).to.eql(pm.variables.get(\"addressLine\"));\r",
									"    }\r",
									"    );\r",
									"\r",
									"    // /*addressPeriodStart mapping function*/\r",
									"    pm.test(\"Address 'periodStart' has been mapped correctly\", function () {\r",
									"        pm.expect(response.entry[0].resource.address[0].period.start).to.eql((pm.variables.get(\"addressPeriodStart\")));\r",
									"    }\r",
									"    );\r",
									"\r",
									"    // /*addressPostCode mapping function*/\r",
									"    pm.test(\"Address 'PostCode' has been mapped correctly\", function () {\r",
									"        pm.expect(response.entry[0].resource.address[0].postalCode).to.eql(pm.variables.get(\"postalCode\"));\r",
									"    }\r",
									"    );\r",
									"\r",
									"    // /*address.use mapping function*/\r",
									"    pm.test(\"Address 'Use' has been mapped correctly\", function () {\r",
									"        pm.expect(response.entry[0].resource.address[0].use).to.eql(\"home\");\r",
									"    }\r",
									"    );\r",
									"}\r",
									"\r",
									"/*telecom.system mapping function*/\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test(\"Telecom is not displayed for Sensitive Patient\", () => {\r",
									"        pm.expect(response.entry[0].resource.telecom).to.be.undefined;\r",
									"    })\r",
									"} else {\r",
									"    pm.test(\"Telecom 'System' has been mapped correctly\", function () {\r",
									"        console.log(\"expected telecomType = \" + (pm.variables.get(\"telecomType\")) + \" and should = \" + (response.entry[0].resource.telecom[0].system));\r",
									"        console.log(\"returned telecomSystem = \" + (response.entry[0].resource.telecom[0].system));\r",
									"        if (pm.variables.get(\"telecomType\") == \"telephone\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"phone\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomType\") == \"fax\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"fax\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomType\") == \"textphone\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"pager\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomType\") == \"email\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"email\");\r",
									"        }\r",
									"        else pm.expect.fail(\"fail\");\r",
									"\r",
									"    });\r",
									"\r",
									"    /*telecom.use mapping function*/\r",
									"\r",
									"    pm.test(\"Telecom 'Use' has been mapped correctly\", function () {\r",
									"\r",
									"        if (pm.variables.get(\"telecomUse\") == \"home\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"home\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomUse\") == \"work\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"work\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomUse\") == \"pager\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"mobile\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomUse\") == \"mobile\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"mobile\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomUse\") == \"temporary\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"temp\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomUse\") == \"Answering Machine\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"home\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"telecomUse\") == \"Emergency\") {\r",
									"            pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"home\");\r",
									"        }\r",
									"        else pm.expect.fail(\"fail\");\r",
									"    }\r",
									"    );\r",
									"\r",
									"    /*telecomPeriodStart mapping function*/\r",
									"    pm.test(\"Telecom 'periodStart' has been mapped correctly\", function () {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].period.start).to.eql((pm.variables.get(\"telecomPeriodStart\")));\r",
									"    }\r",
									"    );\r",
									"\r",
									"    /*telecomValue mapping function*/\r",
									"    pm.test(\"Telecom 'Value' has been mapped correctly\", function () {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].value).to.eql((pm.variables.get(\"telecomValue\")));\r",
									"    }\r",
									"    );\r",
									"}\r",
									"\r",
									"/*generalPractitioner mapping function*/\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test('generalPractitioner is not displayed for Sensitive Patient', () => {\r",
									"        pm.expect(response.entry[0].resource.generalPractitioner).to.be.undefined;\r",
									"    })\r",
									"} else {\r",
									"    pm.test(\"generalPractitioner has been mapped correctly\", function () {\r",
									"        console.log(\"expected generalPractitionerValue = \" + (pm.variables.get(\"\")));\r",
									"        console.log(\"returned generalPractitionerValue = \" + (JSON.stringify(response.entry[0].resource.generalPractitioner)));\r",
									"        var generalPractitionerValueExists = (pm.variables.get(\"generalPractitionerValue\"));\r",
									"        if (!generalPractitionerValueExists) {\r",
									"            console.log(\"if generalPractitionerValue doesnt exist then there should be no generalPractice returned = \" + response.entry[0].resource.generalPractitioner);\r",
									"            pm.expect(JSON.stringify(response.entry[0].resource.generalPractitioner)).to.eql(undefined);\r",
									"        }\r",
									"        else if (generalPractitionerValueExists) {\r",
									"            pm.expect(response.entry[0].resource.generalPractitioner[0].identifier.value).to.eql((pm.variables.get(\"generalPractitionerValue\")));\r",
									"            pm.expect(response.entry[0].resource.generalPractitioner[0].identifier.system).to.eql(\"https://fhir.nhs.uk/Id/ods-organization-code\");\r",
									"            pm.expect(response.entry[0].resource.generalPractitioner[0].type).to.eql(\"Organization\");\r",
									"            pm.expect(response.entry[0].resource.generalPractitioner[0].identifier.period.start).to.eql((pm.variables.get(\"generalPractitionerPeriodStart\")));\r",
									"            pm.expect(response.entry[0].resource.generalPractitioner[0].identifier.period.end).to.eql((pm.variables.get(\"generalPractitionerPeriodEnd\")));\r",
									"        }\r",
									"        pm.variables.unset(\"generalPractitionerValue\");\r",
									"        pm.variables.unset(\"generalPractitionerPeriodStart\");\r",
									"        pm.variables.unset(\"generalPractitionerPeriodEnd\");\r",
									"\r",
									"    });\r",
									"}\r",
									"\r",
									"/*extention items*/\r",
									"\r",
									"/*DeathNotification Items*/\r",
									"\r",
									"/*DeathNotification ValueDateTime mapping function*/\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test(\"DeathNotification is not displayed for a Sensitive patient\", () => {\r",
									"        pm.expect(response.entry[0].resource.extension).to.equal(undefined);\r",
									"    });\r",
									"} else {\r",
									"    pm.test(\"DeathNotification has been mapped correctly\", function () {\r",
									"        if (pm.variables.get(\"deathNotificationValueDateTime\") !== \"\") {\r",
									"            pm.expect((response.entry[0].resource.extension[0].extension[1].valueDateTime).substring(0, 10)).to.eql((pm.variables.get(\"deathNotificationValueDateTime\")));\r",
									"            pm.expect(response.entry[0].resource.extension[0].extension[0].url).to.eql(\"deathNotificationStatus\");\r",
									"            pm.expect(response.entry[0].resource.extension[0].extension[0].valueCodeableConcept.coding[0].code).to.eql(\"1\");\r",
									"            pm.expect(response.entry[0].resource.extension[0].extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\");\r",
									"            pm.expect(response.entry[0].resource.extension[0].extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\");\r",
									"            pm.expect(response.entry[0].resource.extension[0].extension[0].valueCodeableConcept.coding[0].version).to.eql(\"1.0.0\");\r",
									"            pm.expect(response.entry[0].resource.extension[0].extension[1].url).to.eql(\"systemEffectiveDate\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"deathNotificationValueDateTime\") === \"\") {\r",
									"            pm.expect(JSON.stringify(response.entry[0].resource.extension)).to.eql(undefined);\r",
									"        }\r",
									"    });\r",
									"}\r",
									"\r",
									"pm.test(\"meta security object has been mapped correctly\", () => {\r",
									"    if (pm.variables.get('security.code')) {\r",
									"        pm.expect(response.entry[0].resource.meta.security[0].code).to.equal(pm.variables.get('security.code'));\r",
									"        pm.expect(response.entry[0].resource.meta.security[0].display).to.equal('restricted');\r",
									"        pm.expect(response.entry[0].resource.meta.security[0].system).to.equal('https://www.hl7.org/fhir/valueset-security-labels.html');\r",
									"    } else {\r",
									"        pm.expect(response.entry[0].resource.meta.security[0].code).to.equal('U');\r",
									"        pm.expect(response.entry[0].resource.meta.security[0].display).to.equal('unrestricted');\r",
									"        pm.expect(response.entry[0].resource.meta.security[0].system).to.equal('https://www.hl7.org/fhir/valueset-security-labels.html');\r",
									"    }\r",
									"    \r",
									"    pm.variables.unset('security.code');\r",
									"});\r",
									"\r",
									"};\r",
									"\r",
									"pm.globals.set(\"checkSearchMappings\", checkSearchMappings.toString());\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "relatedPersonMappings",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "501fc2e7-56d8-4d4f-8ebb-d5d7c0465769",
								"exec": [
									"var relatedPersonMappings = () => {\r",
									"\r",
									"/*Check name start date has been populated properly*/\r",
									"pm.test(\"Name 'startdate' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].period.start).to.eql(pm.variables.get(\"relatedPersonPeriodStart\"));\r",
									"});\r",
									"\r",
									"/*Check given has been populated properly*/\r",
									"pm.test(\"Name 'given' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].given).to.eql(pm.variables.get(\"relatedPersonGiven\"));\r",
									"});\r",
									"\r",
									"/*Check family has been populated properly*/\r",
									"pm.test(\"Name 'family' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].family).to.eql(pm.variables.get(\"relatedPersonFamily\"));\r",
									"});\r",
									"\r",
									"/*Check prefix has been populated properly*/\r",
									"pm.test(\"Name 'prefix' has been mapped correctly\", function () {\r",
									"    if (!pm.variables.get(\"relatedPersonPrefix\")) {\r",
									"            pm.expect(response.entry[0].resource.name[0].prefix).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"            pm.expect(response.entry[0].resource.name[0].prefix[0]).to.eql(pm.variables.get(\"relatedPersonPrefix\"));\r",
									"    }\r",
									"});\r",
									"\r",
									"/*Check suffix has been populated properly*/\r",
									"pm.test(\"Name 'suffix' has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"relatedPersonSuffix\")  === undefined ) {\r",
									"        pm.expect(response.entry[0].resource.name[0].suffix).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        pm.expect(response.entry[0].resource.name[0].suffix).to.eql(pm.variables.get(\"relatedPersonSuffix\"));\r",
									"    }\r",
									"});\r",
									"\r",
									"/*Check name use has been populated properly*/\r",
									"pm.test(\"Name 'use' has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.name[0].use).to.eql(\"usual\");\r",
									"});\r",
									"\r",
									"/*Check Patient use has been populated properly*/\r",
									"pm.test(\"Patient has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.patient.type).to.eql(\"Patient\");\r",
									"   \r",
									"   if (pm.variables.get(\"relatedPersonPatientID\")) {\r",
									"      pm.expect(response.entry[0].resource.patient.reference).to.eql(\"https://api.service.nhs.uk/Patient/\" + pm.variables.get(\"relatedPersonPatientID\"));\r",
									"      pm.expect(response.entry[0].resource.patient.identifier.system).to.eql(\"https://api.service.nhs.uk\");\r",
									"      pm.expect(response.entry[0].resource.patient.identifier.value).to.eql(pm.variables.get(\"relatedPersonPatientID\"));\r",
									"   }\r",
									"   else {\r",
									"      pm.expect(response.entry[0].resource.patient.reference).to.eql(undefined);\r",
									"      pm.expect(response.entry[0].resource.patient.identifier).to.eql(undefined);\r",
									"   }\r",
									"});\r",
									"\r",
									"/*Check Period Start has been populated properly*/\r",
									"pm.test(\"Period Start has been mapped correctly\", function () {\r",
									"   pm.expect(response.entry[0].resource.period.start).to.eql(pm.variables.get(\"relatedPersonPeriodStart\"));\r",
									"});\r",
									"\r",
									"/*Check Period End has been populated properly*/\r",
									"pm.test(\"Period End has been mapped correctly\", function () {\r",
									"    if (!pm.variables.get(\"relatedPersonPeriodEnd\")){\r",
									"        pm.expect(response.entry[0].resource.period.end).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        pm.expect(response.entry[0].resource.period.end).to.eql(pm.variables.get(\"relatedPersonPeriodEnd\"));\r",
									"    }\r",
									"});\r",
									"\r",
									" \r",
									"/*Check Relationship has been populated properly*/\r",
									"pm.test(\"Relationship has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"relatedPersonRelationshipType\") == \"brother\") {\r",
									"            pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"BRO\");\r",
									"            pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"brother\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"child\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"CHILD\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"child\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"partner\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"DOMPART\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"domestic partner\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"relative\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"FAMMEMB\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"family member\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"father\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"FTH\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"father\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"mother\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"MTH\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"mother\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"next of kin\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"N\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"Next-of-Kin\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipType\") == \"parent\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].code).to.eql(\"PRN\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[0].display).to.eql(\"parent\");\r",
									"    }\r",
									"    else pm.expect.fail(\"relationshipType not been mapped correctly\");\r",
									"    \r",
									"    pm.expect(response.entry[0].resource.relationship[0].coding[0].system).to.eql(\"http://hl7.org/fhir/ValueSet/relatedperson-relationshiptype\");\r",
									"    \r",
									"    if (pm.variables.get(\"relatedPersonRelationshipClass\")  == \"Agent\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[1].code).to.eql(\"Agent\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[1].display).to.eql(\"Agent of patient\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipClass\")  == \"Guardian\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[1].code).to.eql(\"Guardian\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[1].display).to.eql(\"Guardian of patient\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonRelationshipClass\")  == \"Personal relationship\") {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[1].code).to.eql(\"Personal\");\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[1].display).to.eql(\"Personal relationship with the patient\");\r",
									"    }\r",
									"    else pm.expect.fail(\"relationshipClass not been mapped correctly\");\r",
									"    \r",
									"    pm.expect(response.entry[0].resource.relationship[0].coding[1].system).to.eql(\"https://fhir.nhs.uk/R4/CodeSystem/UKCore-AdditionalRelatedPersonRole\");\r",
									"    \r",
									"    if  (pm.variables.get(\"relatedPersonRelationshipNOKDisplay\")) {\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[2].code).to.eql(pm.variables.get(\"relatedPersonRelationshipNOKCode\"));\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[2].display).to.eql(pm.variables.get(\"relatedPersonRelationshipNOKDisplay\"));\r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[2].system).to.eql(\"http://hl7.org/fhir/ValueSet/relatedperson-relationshiptype\");\r",
									"    }\r",
									"   else \r",
									"        pm.expect(response.entry[0].resource.relationship[0].coding[2]).to.eql(undefined);\r",
									"});\r",
									"\r",
									"/*Check resourceType has been populated properly*/\r",
									"pm.test(\"Resource Type has been mapped correctly\", function () {\r",
									"    pm.expect(response.entry[0].resource.resourceType).to.eql(\"RelatedPerson\");\r",
									"});\r",
									"\r",
									"/*Check Telecom has been populated properly*/\r",
									"pm.test(\"Telecom Use has been mapped correctly\", function () {\r",
									"    pm.expect(response.entry[0].resource.telecom[0].period.start).to.eql(pm.variables.get(\"relatedPersontelecomPeriodStart\"));\r",
									"    \r",
									"    if (pm.variables.get(\"relatedPersontelecomUse\") == \"home\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"home\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomUse\") == \"temporary\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"temp\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomUse\") == \"work\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"work\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomUse\") == \"answering machine\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"home\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomUse\") == \"emergency\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"home\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomUse\") == \"mobile\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"mobile\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomUse\") == \"pager\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].use).to.eql(\"mobile\");\r",
									"    }\r",
									"    else pm.expect.fail(\"telecom Use has not been mapped correctly\");\r",
									"});\r",
									"\r",
									"pm.test(\"Telecom System has been mapped correctly\", function () {    \r",
									"    if (pm.variables.get(\"relatedPersontelecomType\") == \"telephone\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"phone\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomType\") == \"fax\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"fax\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomType\") == \"textphone\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"pager\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersontelecomType\") == \"email\") {\r",
									"        pm.expect(response.entry[0].resource.telecom[0].system).to.eql(\"email\");\r",
									"    }\r",
									"    else pm.expect.fail(\"telecom Type has not been mapped correctly\");\r",
									"});\r",
									"\r",
									"//Check Address Related items\r",
									"pm.test(\"Address has been mapped correctly\", function () {\r",
									"      \r",
									"      if (pm.variables.get(\"relatedPersonAddressLine\")) {\r",
									"          pm.expect(JSON.stringify(response.entry[0].resource.address[0].line)).to.eql(pm.variables.get(\"relatedPersonAddressLine\"));\r",
									"          pm.expect(response.entry[0].resource.address[0].period.start).to.eql(pm.variables.get(\"relatedPersonPeriodStart\"));\r",
									"          pm.expect(response.entry[0].resource.address[0].postalCode).to.eql(pm.variables.get(\"relatedPersonPostalCode\"));\r",
									"          pm.expect(response.entry[0].resource.address[0].use).to.eql(\"home\");\r",
									"      }\r",
									"      else \r",
									"          pm.expect(response.entry[0].resource.address).to.eql(undefined);\r",
									"    });\r",
									"\r",
									"//Check CorrespondenceIndicator Related items\r",
									"pm.test(\"CorrespondenceIndicator has been mapped correctly\", function () {\r",
									"    var CorrespondenseIndicator = getCorrespondenseIndicator();\r",
									"    \r",
									"    if ((pm.variables.get(\"relatedPersonCorrespondenceIndicator\") == \"no\") || (pm.variables.get(\"relatedPersonCorrespondenceIndicator\") === undefined)) {\r",
									"        pm.expect(CorrespondenseIndicator).to.eql(undefined);\r",
									"    }\r",
									"    else if (pm.variables.get(\"relatedPersonCorrespondenceIndicator\") == \"yes\") {\r",
									"        pm.expect(CorrespondenseIndicator.url).to.eql(\"https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-CopyCorrespondenceIndicator\");\r",
									"        pm.expect(CorrespondenseIndicator.valueBoolean).to.eql(true);\r",
									"    }\r",
									"   else pm.expect.fail(\"Correspondence Indicator has not been mapped correctly\");\r",
									"});\r",
									"\r",
									"//Check Contact Preference \r",
									"pm.test(\"Contact Preferred Method has been mapped correctly\", function () {\r",
									"    var contactPreference = getContactPreference();\r",
									"    \r",
									"    if (contactPreference) {\r",
									"        pm.expect(contactPreference.url).to.eql(\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\");\r",
									"        pm.expect(contactPreference.extension[0].url).to.eql(\"PreferredContactMethod\");\r",
									"        \r",
									"        if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"email\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"4\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"E-mail\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"letter\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"1\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Letter\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"minicom\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"5\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Minicom (Textphone)\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"not telephone contact\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"8\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"No Telephone contact\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"sign language\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"7\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Sign Language\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"telephone\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"3\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Telephone\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"telephone via proxy\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"6\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Telephone contact via proxy\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredContactMethod\") == \"visit\") {\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].code).to.eql(\"2\");\r",
									"            pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Visit\");\r",
									"        }\r",
									"        else pm.expect.fail(\"preferred contact method has not been mapped correctly\");\r",
									"\r",
									"        pm.expect(contactPreference.extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.nhs.uk/R4/ValueSet/UKCore-PreferredContactMethod\");\r",
									"    }\r",
									"});\r",
									"\r",
									"pm.test(\"Contact Preferred Time has been mapped correctly\", function () {\r",
									"    var PreferredContactTimes = getContactPreferredTimes();\r",
									"    \r",
									"    if (pm.variables.get(\"relatedPersonPreferredContactTime\")) {\r",
									"        pm.expect(PreferredContactTimes.url).to.eql(\"PreferredContactTimes\");\r",
									"        pm.expect(PreferredContactTimes.valueString).to.eql(pm.variables.get(\"relatedPersonPreferredContactTime\"));\r",
									"    }\r",
									"    else if (!pm.variables.get(\"relatedPersonPreferredContactTime\")) {\r",
									"        pm.expect(PreferredContactTimes).to.eql(undefined)\r",
									"    }\r",
									"});\r",
									"\r",
									"pm.test(\"Contact Preferred Format has been mapped correctly\", function () {\r",
									"    var ContactPreferredCommsFormat = getContactPreferredCommsFormat();\r",
									"\r",
									"    if (pm.variables.get(\"relatedPersonPreferredWrittenCommsFormat\")) {\r",
									"        pm.expect(ContactPreferredCommsFormat.url).to.eql(\"PreferredWrittenCommunicationFormat\");\r",
									"        pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-PreferredWrittenCommunicationFormat\");\r",
									"        \r",
									"        if (pm.variables.get(\"relatedPersonPreferredWrittenCommsFormat\") == \"Large print\") {\r",
									"            pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].code).to.eql(\"11\");\r",
									"            pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].display).to.eql(\"Large print\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredWrittenCommsFormat\") == \"Braille\") {\r",
									"            pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].code).to.eql(\"12\");\r",
									"            pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].display).to.eql(\"Braille\");\r",
									"        }\r",
									"        else if (pm.variables.get(\"relatedPersonPreferredWrittenCommsFormat\") == \"Audio tape\") {\r",
									"            pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].code).to.eql(\"13\");\r",
									"            pm.expect(ContactPreferredCommsFormat.valueCodeableConcept.coding[0].display).to.eql(\"Audio tape\");\r",
									"        }\r",
									"        else pm.expect.fail(\"preferred contact format has not been mapped correctly\");\r",
									"    }\r",
									"    else if (!pm.variables.get(\"relatedPersonPreferredWrittenCommsFormat\")) {\r",
									"        pm.expect(ContactPreferredCommsFormat).to.eql(undefined)\r",
									"    }\r",
									"}); \r",
									"\r",
									"//Check language Related items\r",
									"pm.test(\"language Extention has been mapped correctly\", function () {\r",
									"    var languageExtension = getLanguageExtention(response.entry[0].resource.extension);\r",
									"    if (!pm.variables.get(\"relatedPersonLanguage\")) {\r",
									"        pm.expect(languageExtension).to.eql(undefined);\r",
									"    }\r",
									"    \r",
									"    else if (pm.variables.get(\"relatedPersonLanguage\")) {\r",
									"        pm.expect(languageExtension.extension[0].url).to.eql(\"language\");\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\");\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].version).to.eql(\"1.0.0\");\r",
									"        pm.expect(languageExtension.extension[1].url).to.eql(\"interpreterRequired\");\r",
									"        pm.expect(languageExtension.extension[1].valueBoolean).to.eql(pm.variables.get(\"relatedPersonInterpreter\"));\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].code).to.eql(pm.variables.get(\"relatedPersonLanguage\"));\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].display).to.eql(pm.variables.get(\"relatedPersonLanguageDisplay\"));\r",
									"    }\r",
									"\r",
									"});\r",
									"\r",
									"pm.test(\"Rank Extention has been mapped correctly\", function () {\r",
									"    var ContactRankExtension = getContactRankExtension(response.entry[0].resource.extension);\r",
									"\r",
									"    \r",
									"    if (!(pm.variables.get(\"relatedPersonRank1\"))) {\r",
									"        pm.expect(ContactRankExtension).to.eql(undefined);\r",
									"    }\r",
									"    \r",
									"    else if (pm.variables.get(\"relatedPersonRank\")) {\r",
									"        pm.expect(ContactRankExtension.url).to.eql(\"https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-ContactRank\");\r",
									"        pm.expect(ContactRankExtension.valuePositiveInt).to.eql(pm.variables.get(\"relatedPersonRank1\"));\r",
									"    }\r",
									"    \r",
									"});\r",
									"\r",
									"function getContactRankExtension(extensions) {\r",
									"    \r",
									"    if (response.entry[0].resource.extension) {\r",
									"        for (let extensions of response.entry[0].resource.extension) {\r",
									"            try {\r",
									"    \t\t\tif (extensions.url == \"https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-ContactRank\") {\r",
									"    \t\t\t\treturn extensions;\r",
									"    \t\t\t}\r",
									"            } catch(err) {\r",
									"                }\r",
									"        }\r",
									"    }\r",
									"}\r",
									"\r",
									"function getCorrespondenseIndicator(extensions) {\r",
									"    \r",
									"    if (response.entry[0].resource.extension) {\r",
									"        for (let extensions of response.entry[0].resource.extension) {\r",
									"            try {\r",
									"        \t\tif (extensions.url == \"https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-CopyCorrespondenceIndicator\") {\r",
									"        \t\t\treturn extensions;\r",
									"        \t\t}\r",
									"            } catch(err) {\r",
									"                }\r",
									"        }\r",
									"    }\r",
									"}\r",
									"\r",
									"\r",
									"function getLanguageExtention(extensions) {\r",
									"    \r",
									"    if (response.entry[0].resource.extension) {\r",
									"        for (let extensions of response.entry[0].resource.extension) {\r",
									"            try {\r",
									"                    for (let e of extensions.extension) {\r",
									"                        if (e.url == \"language\") {\r",
									"                        return extensions;\r",
									"                        }       \r",
									"                     }\r",
									"                } catch(err) {\r",
									"                    }\r",
									"        }\r",
									"    }\r",
									"}\r",
									"\r",
									"function getContactPreference(extensions) {\r",
									"    \r",
									"    if (response.entry[0].resource.extension) {\r",
									"        for (let extensions of response.entry[0].resource.extension) {\r",
									"            try {\r",
									"    \t\t\tif (extensions.url == \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-ContactPreference\") {\r",
									"    \t\t\t\treturn extensions;\r",
									"    \t\t\t}\r",
									"            } catch(err) {\r",
									"                }\r",
									"        }\r",
									"    }\r",
									"}\r",
									"\r",
									"function getContactPreferredTimes(extensions) {\r",
									"    \r",
									"    if (response.entry[0].resource.extension) {\r",
									"        for (let extensions of response.entry[0].resource.extension) {\r",
									"            try {\r",
									"                    for (let e of extensions.extension) {\r",
									"                        if (e.url == \"PreferredContactTimes\") {\r",
									"                        return e;\r",
									"                        }       \r",
									"                     }\r",
									"                } catch(err) {\r",
									"                    }\r",
									"            }\r",
									"    }\r",
									"}\r",
									"\r",
									"function getContactPreferredCommsFormat(extensions) {\r",
									"    \r",
									"    if (response.entry[0].resource.extension) {\r",
									"        for (let extensions of response.entry[0].resource.extension) {\r",
									"            try {\r",
									"                    for (let e of extensions.extension) {\r",
									"                        if (e.url == \"PreferredWrittenCommunicationFormat\") {\r",
									"                        return e;\r",
									"                        }       \r",
									"                     }\r",
									"                } catch(err) {\r",
									"                    }\r",
									"        }\r",
									"    }\r",
									"}\r",
									"pm.variables.unset(\"relatedPersonPrefix\");\r",
									"pm.variables.unset(\"relatedPersonSuffix\");\r",
									"pm.variables.unset(\"relatedPersonLanguage\");\r",
									"pm.variables.unset(\"relatedPersonPreferredContactTime\");\r",
									"pm.variables.unset(\"relatedPersonLanguageDisplay\");    \r",
									"pm.variables.unset(\"relatedPersonInterpreter\");   \r",
									"pm.variables.unset(\"relatedPersonRelationshipNOKCode\");\r",
									"pm.variables.unset(\"relatedPersonRelationshipNOKDisplay\");\r",
									"pm.variables.unset(\"relatedPersonRelationshipType\");\r",
									"pm.variables.unset(\"relatedPersonAddressLine\");\r",
									"pm.variables.unset(\"relatedPersonPreferredWrittenCommsFormat\");\r",
									"pm.variables.unset(\"relatedPersonPatientID\");\r",
									"\r",
									"};\r",
									"\r",
									"\r",
									"pm.globals.set(\"relatedPersonMappings\", relatedPersonMappings.toString());\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "createPatient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "d36b12c4-e1e7-4239-a035-5fcae1a3814a",
								"exec": [
									"/*CreatePatient Function*/",
									"",
									"var createPatient = () => {",
									"",
									"        /*create a random firstname*/",
									"        let given = pm.variables.replaceIn(\"{{$randomFirstName}}\");",
									"        pm.variables.set(\"given\", given);",
									"        console.log(\"Random 'Given' name created is: \" + pm.variables.get(\"given\"));",
									"",
									"        /*create a random lastname*/",
									"        let family = pm.variables.replaceIn(\"{{$randomLastName}}\");",
									"        pm.variables.set(\"family\", family);",
									"        console.log(\"Random 'family' name created is: \" + pm.variables.get(\"family\"));",
									"",
									"        /*create a random houseNumber*/",
									"        let addressHouseNumber = pm.variables.replaceIn(\"{{$randomInt}}\");",
									"        pm.variables.set(\"addressHouseNumber\", addressHouseNumber);",
									"        console.log(\"Random 'houseNumber' created is: \" + pm.variables.get(\"addressHouseNumber\"));",
									"",
									"        /*create a random Street*/",
									"        let addressStreet = pm.variables.replaceIn(\"{{$randomStreetName}}\");",
									"        pm.variables.set(\"addressStreet\", addressStreet);",
									"        console.log(\"Random 'addressStreet' created is: \" + pm.variables.get(\"addressStreet\"));",
									"",
									"        /*create a random District*/",
									"        let addressDistrict = (pm.variables.replaceIn(\"{{$randomWord}}\")) + \" District\";",
									"        pm.variables.set(\"addressDistrict\", addressDistrict);",
									"        console.log(\"Random 'addressDistrict' created is: \" + pm.variables.get(\"addressDistrict\"));",
									"",
									"        /*create a random City*/",
									"        let addressCity = pm.variables.replaceIn(\"{{$randomCity}}\");",
									"        pm.variables.set(\"addressCity\", addressCity);",
									"        console.log(\"Random 'addressCity' created is: \" + pm.variables.get(\"addressCity\"));",
									"",
									"        /*create a random County*/",
									"        let addressCounty = (pm.variables.replaceIn(\"{{$randomWord}}\")) + \" County\";",
									"        pm.variables.set(\"addressCounty\", addressCounty);",
									"        console.log(\"Random 'addressCounty' created is: \" + pm.variables.get(\"addressCounty\"));",
									"",
									"        /*create a random postCode*/",
									"        pm.variables.set(\"postCode\", \"PD12\" + _.random(1, 9) + \"PD\");",
									"        console.log(\"Random 'postCode' created is: \" + pm.variables.get(\"postCode\"));",
									"",
									"        /*create a random gender*/",
									"        pm.variables.set(\"gender\", _.random(1, 2));",
									"        console.log(\"Random 'gender' created is: \" + pm.variables.get(\"gender\"));",
									"",
									"        /*create a random birthDate*/",
									"        var moment = require('moment');",
									"        let randomYears = _.random(10, 50);",
									"        pm.variables.set(\"birthTime\", moment().subtract(randomYears, 'years').format(\"YYYYMMDD\"));",
									"        pm.variables.set(\"birthDate\", moment().subtract(randomYears, 'years').format(\"YYYY-MM-DD\"));",
									"        console.log(\"Random 'birthTime' created is: \" + pm.variables.get(\"birthTime\"));",
									"        console.log(\"Random 'birthDate' created is: \" + pm.variables.get(\"birthDate\"));",
									"      ",
									"};",
									"pm.globals.set(\"createPatient\", createPatient.toString());",
									"createPatient();",
									"",
									"",
									"",
									"",
									"",
									"",
									"",
									"",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "42813cc8-9356-444d-a194-b8df6f14fb16",
								"exec": [
									"eval(pm.globals.get(\"createPatient\"))();"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						},
						"description": "This function creates a patient made up of randomised variables, consiting of: \n\n- given name\n- family name\n- address lines (5 lines in total)\n- postcode\n- gender\n- birthdate\n\nit can be used to create a Patient using the Personal Demographics service - HL7 V3 API"
					},
					"response": []
				},
				{
					"name": "FHIR Error Reponse Validator",
					"event": [
						{
							"listen": "test",
							"script": {
								"id": "3bc72cbe-cf65-48b4-9262-4391e0ae068e",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"id": "6535d5b4-345c-4cfe-ac52-d83e25f48bba",
								"exec": [
									"// Error Message Validation: Provides tests to assert against FHIR error response",
									"",
									"pm.globals.set('errorMessage', function errorMessage() {",
									"    let response = pm.response.json();",
									"    let message = {};",
									"",
									"    message.assertCodeIs = (code) => {",
									"        pm.test(\"Returns the code \" + code, () => {",
									"            pm.expect(response.issue[0].details.coding[0].code).to.eql(code);",
									"        });",
									"    }",
									"",
									"    message.assertDisplayIs = (display) => {",
									"        pm.test(\"Returns the display message \" + display, () => {",
									"            pm.expect(response.issue[0].details.coding[0].display).to.eql(display);",
									"        });",
									"    }",
									"",
									"    message.assertSeverityIs = (severity) => {",
									"        pm.test(\"Returns the severity \" + severity, () => {",
									"            pm.expect(response.issue[0].severity).to.eql(severity);",
									"        });",
									"    }",
									"    ",
									"",
									"    message.assertSystemIs = (system) => {",
									"        pm.test(\"Returns the system message \" + system, () => {",
									"            pm.expect(response.issue[0].details.coding[0].system).to.eql(system);",
									"        });",
									"    }",
									"",
									"    return message;",
									"} + '; errorMessage();');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						},
						"description": "# Function: FHIR Error Response Validator\n___\n### Description\nThis function provides the capability to assert aspects of the generic FHIR based error response matches expectation.\n \n##### Example FHIR Error Response\n```\n{\n    \"issue\": [\n        {\n            \"code\": \"invariant\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"EXTRA_VALUE\",\n                        \"display\": \"Extra value - Additional properties are not allowed ('invalidHeader', 'anotherInvalidHeader' were unexpected)\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": \"1\"\n                    }\n                ]\n            },\n            \"severity\": \"error\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}\n```\n\n### Usage\nUse eval to evaluate the function, which is stored as the global variable _errorMessage_\n```\neval(pm.globals.get(\"errorMessage\"));\n```\nCall the various different internal 'methods' to assert against key parts of the error message\n```\nerrorMessage().assertCodeIs(\"EXTRA_VALUE\");\nerrorMessage().assertDisplayIs(\"Extra value - Additional properties are not allowed ('invalidHeader', 'anotherInvalidHeader' were unexpected)\");\nerrorMessage().assertSeverityIs(\"error\");\nerrorMessage().assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");\n```\n\n### Output\n- PASS Returns the code EXTRA_VALUE\n- PASS Returns the display message Extra value - Additional properties are not allowed ('invalidHeader', 'anotherInvalidHeader' were unexpected)\n- PASS Returns the severity error\n- PASS Returns the system message https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode"
					},
					"response": []
				},
				{
					"name": "Patient Validator",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "2d5af984-f71d-4953-9f2c-c007d65f34ac",
								"exec": [
									"// Patient Utility: Provides key patient response related functions",
									"pm.globals.set('patient', function patient() {",
									"    let response = pm.response.json();",
									"    let calls = {};",
									"",
									"    calls.getScores = () => {",
									"        var scores = [];",
									"        for (i = 0; i < response.entry.length; i++) {",
									"            scores.push(response.entry[i].search.score);",
									"        }",
									"",
									"        return scores;",
									"    }",
									"",
									"    calls.getTotalNumberOfPatients = () => {",
									"        let response = JSON.parse(responseBody);",
									"        return response.total;",
									"    };",
									"    ",
									"    calls.containsPatientWithNhsNumber = function(nhsNumber) {",
									"        for (i = 0; i < response.entry.length; i++) {",
									"            if(response.entry[i].resource.id === nhsNumber) {",
									"                return true;",
									"            }",
									"        }",
									"",
									"        return false;",
									"    };",
									"    ",
									"    calls.getScoreByNhsNumber = function(resp, nhsNumber) {",
									"        console.log(\"HERE: \" + resp);",
									"        for (i = 0; i < resp.entry.length; i++) {",
									"            if (resp.entry[i].resource.id === nhsNumber) {",
									"                return resp.entry[i].search.score;",
									"            }",
									"        }",
									"",
									"        return null;",
									"    };",
									"",
									"    return calls;",
									"} + '; patient();');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "Response Assertions",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "f2302f45-e7a8-47db-ad8d-34d262b42798",
								"exec": [
									"// Assert utility: Tests for key aspects of the response",
									"pm.globals.set(\"assertThatUtil\", function assertThatUtil() {",
									"    let response = pm.response.json();",
									"    let util = {};",
									"",
									"    util.statusCodeIs = (code) => {",
									"        pm.test(\"Returns status code \" + code, () => {                    ",
									"            pm.response.to.have.status(code);            ",
									"        });",
									"",
									"    };",
									"",
									"    util.responseContainsHeader = (headerName, headerValue) => {",
									"        pm.test(\"Response contains header \" + headerName + \" with value \" + headerValue, () =>{",
									"            pm.response.to.have.header(headerName);",
									"            pm.expect(postman.getResponseHeader(headerName)).to.equal(headerValue);",
									"        });",
									"    };",
									"",
									"    return util;",
									"} + '; assertThatUtil();');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "checkRetrieveMappings",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "cb0e158b-eaaa-4b28-b9db-e3cd8db716b6",
								"exec": [
									"var checkRetrieveMappings = () => {\r",
									"\r",
									"/*Resource Type mapping function*/\r",
									"pm.test(\"Resource Type has been mapped correctly\", function () {\r",
									"    pm.expect(response.resourceType).to.eql(\"Patient\");\r",
									"    }\r",
									");\r",
									"\r",
									"/*Patient id mapping function*/\r",
									"pm.test(\"Patient 'Id' has been mapped correctly\", function () {\r",
									"    pm.expect(response.id).to.eql(pm.variables.get(\"patientId\"));\r",
									"    }\r",
									");\r",
									"\r",
									"/*Identifier Value mapping function*/\r",
									"pm.test(\"Identifier has been mapped correctly\", function () {\r",
									"    pm.expect(response.identifier[0].extension[0].url).to.eql(\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSNumberVerificationStatus\");\r",
									"    pm.expect(response.identifier[0].extension[0].valueCodeableConcept.coding[0].code).to.eql(\"01\");\r",
									"    pm.expect(response.identifier[0].extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Number present and verified\");\r",
									"    pm.expect(response.identifier[0].extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-NHSNumberVerificationStatus\");\r",
									"    pm.expect(response.identifier[0].value).to.eql(pm.variables.get(\"patientId\"));\r",
									"    \r",
									"});\r",
									"\r",
									"/*Check name use has been populated properly*/\r",
									"pm.test(\"Name 'type' has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"nameType\") == \"Usual name\") {\r",
									"            pm.expect(response.name[0].use).to.eql(\"usual\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == \"alias\") {\r",
									"            pm.expect(response.name[1].use).to.eql(\"temp\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == \"preferred\") {\r",
									"            pm.expect(response.name[1].use).to.eql(\"nickname\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"previous\")) {\r",
									"            pm.expect(response.name[1].use).to.eql(\"old\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"birth\")) {\r",
									"            pm.expect(response.name[1].use).to.eql(\"old\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"bachelor\")) {\r",
									"            pm.expect(response.name[1].use).to.eql(\"maiden\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"nameType\") == (\"maiden\")) {\r",
									"            pm.expect(response.name[1].use).to.eql(\"maiden\");\r",
									"    }\r",
									"    else pm.expect.fail(\"fail\");\r",
									"});\r",
									"\r",
									"\r",
									"/*Check name start date has been populated properly*/\r",
									"pm.test(\"Name 'startdate' has been mapped correctly\", function () {\r",
									"   pm.expect(response.name[0].period.start).to.eql(pm.variables.get(\"namePeriodStart\"));\r",
									"});\r",
									"\r",
									"/*Check given has been populated properly*/\r",
									"pm.test(\"Name 'given' has been mapped correctly\", function () {\r",
									"   pm.expect(response.name[0].given).to.eql(pm.variables.get(\"given\"));\r",
									"});\r",
									"\r",
									"/*Check family has been populated properly*/\r",
									"pm.test(\"Name 'family' has been mapped correctly\", function () {\r",
									"   pm.expect(response.name[0].family).to.eql(pm.variables.get(\"family\"));\r",
									"});\r",
									"\r",
									"/*Check prefix has been populated properly*/\r",
									"pm.test(\"Name 'prefix' has been mapped correctly\", function () {\r",
									"    if (!pm.variables.get(\"prefix\")) {\r",
									"            pm.expect(response.name[0].prefix).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"            pm.expect(response.name[0].prefix[0]).to.eql(pm.variables.get(\"prefix\"));\r",
									"    }\r",
									"    \r",
									"    pm.variables.unset(\"prefix\");\r",
									"});\r",
									"\r",
									"/*Check suffix has been populated properly*/\r",
									"pm.test(\"Name 'suffix' has been mapped correctly\", function () {\r",
									"    if (!pm.variables.get(\"suffix\")) {\r",
									"        pm.expect(response.name[0].suffix).to.equal(undefined);\r",
									"    }\r",
									"    else {\r",
									"        pm.expect(response.name[0].suffix).to.eql(pm.variables.get(\"suffix\"));\r",
									"    }\r",
									"});\r",
									"\r",
									"/*gender mapping function*/\r",
									"pm.test(\"Gender has been mapped correctly\", function () {\r",
									"    if (pm.variables.get(\"gender\") == \"female\") {\r",
									"            pm.expect(response.gender).to.eql(\"female\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"gender\") == \"male\") {\r",
									"            pm.expect(response.gender).to.eql(\"male\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"gender\") == \"not known\") {\r",
									"            pm.expect(response.gender).to.eql(\"unknown\");\r",
									"    }\r",
									"    else if (pm.variables.get(\"gender\") == \"not specified\") {\r",
									"            pm.expect(response.gender).to.eql(\"other\");\r",
									"    }\r",
									"    else pm.expect.fail(\"fail\");\r",
									"});\r",
									"\r",
									"/*Birthday mapping function*/\r",
									"pm.test(\"BirthDate has been mapped correctly\", function () {\r",
									"    pm.expect(response.birthDate).to.eql(pm.variables.get(\"birthdate\"));\r",
									"    }\r",
									");\r",
									"\r",
									"/*deceasedDateTime mapping function*/\r",
									"pm.test(\"deceasedDateTime has been mapped correctly\", function () {\r",
									"   let deceasedDateTimeExists = (pm.variables.get(\"deceasedDateTime\"));\r",
									"   if (!deceasedDateTimeExists) {\r",
									"       pm.expect(response.deceasedDateTime).to.eql(undefined);\r",
									"   }\r",
									"   else if (deceasedDateTimeExists) {\r",
									"    pm.expect((response.deceasedDateTime).substring(0,10)).to.eql((pm.variables.get(\"deceasedDateTime\")));\r",
									"    }\r",
									"    pm.variables.unset(\"deceasedDateTime\");\r",
									"});\r",
									"\r",
									"// Check Meta.Security object is displayed for Sensitive Patients\r",
									"pm.test(\"Security object has been mapped correctly\", () => {\r",
									"    let securityCode = pm.variables.get(\"securityCode\");\r",
									"\r",
									"    if (securityCode) {\r",
									"        pm.expect(response.meta.security[0].code).to.equal('R');\r",
									"        pm.expect(response.meta.security[0].display).to.equal('restricted');\r",
									"        pm.expect(response.meta.security[0].system).to.equal('https://www.hl7.org/fhir/valueset-security-labels.html');\r",
									"    } else {\r",
									"        pm.expect(response.meta.security[0].code).to.equal('U');\r",
									"        pm.expect(response.meta.security[0].display).to.equal('unrestricted');\r",
									"        pm.expect(response.meta.security[0].system).to.equal('https://www.hl7.org/fhir/valueset-security-labels.html');\r",
									"    }\r",
									"});\r",
									"\r",
									"// Check deathNotificationExtension\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test(\"deathNotificationStatus extension has been mapped correctly -  Only checked for a Sensitive Patient\", () => {\r",
									"        pm.expect(response.extension[0].extension[0].url).to.equal('deathNotificationStatus');\r",
									"        pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].code).to.equal('1', 'invalid code');\r",
									"        pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].display).to.equal(pm.variables.get(\"deathNotificationStatus.display\"));\r",
									"        pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].system).to.equal('https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus', 'invalid system');\r",
									"        pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].version).to.equal('1.0.0', 'invalid version');\r",
									"        pm.expect(response.extension[0].url).to.equal('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus', 'invalid extension.url');\r",
									"    });\r",
									"}\r",
									"\r",
									"/*Check Address Related items*/\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test(\"Address for a Sensitive patient is not returned\", () => {\r",
									"        pm.expect(response.address).to.be.undefined;\r",
									"    });\r",
									"} else {\r",
									"    pm.test(\"Address has been mapped correctly\", function () {\r",
									"        let expectedValue;\r",
									"        switch (pm.variables.get(\"addressType\")) {\r",
									"            case 'usual':\r",
									"                expectedValue = 'home';\r",
									"                break;\r",
									"            case 'work':\r",
									"                expectedValue = 'work';\r",
									"                break;\r",
									"            case 'correspondence':\r",
									"                expectedValue = 'billing';\r",
									"                break;\r",
									"            case 'temporary':\r",
									"                expectedValue = 'temp';\r",
									"                break;\r",
									"            default:\r",
									"                pm.expect.fail(\"addressType mapped incorrectly\");\r",
									"        }\r",
									"\r",
									"        pm.expect(response.address[0].use).to.eql(expectedValue, \"invalid addressType\");\r",
									"        pm.expect(JSON.stringify(response.address[0].line)).to.eql(pm.variables.get(\"addressLine\"), \"invalud addressLine\");\r",
									"        pm.expect(response.address[0].period.start).to.eql(pm.variables.get(\"addressPeriodStart\"), \"invalid addressPeriodStart\");\r",
									"        pm.expect(response.address[0].postalCode).to.eql(pm.variables.get(\"postalCode\"), \"invalid postalCode\");\r",
									"\r",
									"        let addressPeriodEnd = pm.variables.get(\"addressPeriodEnd\") === undefined ? undefined : pm.variables.get(\"addressPeriodEnd\");\r",
									"        pm.expect(response.address[0].period.end).to.eql(addressPeriodEnd, \"invalid addressPeriodEnd\");\r",
									"\r",
									"        if (response.address[0].extension !== undefined) {\r",
									"            let paf = response.address[0].extension[0].extension[0];\r",
									"\r",
									"            pm.test(\"Address PAF Key extension has been mapped correctly\", () => {\r",
									"                pm.expect(paf.url).to.equal('type', 'invalid url');\r",
									"                pm.expect(paf.valueCoding.code).to.equal('PAF', 'invalud valueCoding.code');\r",
									"                pm.expect(paf.valueCoding.system).to.equal('https://fhir.hl7.org.uk/CodeSystem/UKCore-AddressKeyType', 'invalid valueCoding.system');\r",
									"                pm.expect(response.address[0].extension[0].url).to.equal('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-AddressKey', 'invalid extension.url');\r",
									"            })\r",
									"        }\r",
									"    });\r",
									"\r",
									"    pm.variables.unset(\"addressPeriodEnd\");\r",
									"}\r",
									"\r",
									"/*telecom mapping function*/\r",
									"if (pm.variables.get(\"s-flagged\")) {\r",
									"    pm.test(\"Telecom for a Sensitive patient is not returned\", () => {\r",
									"        pm.expect(response.telecom).to.be.undefined;\r",
									"    });\r",
									"} else {\r",
									"    pm.test(\"Telecom has been mapped correctly\", function () {\r",
									"        let telecomType;\r",
									"        if (pm.variables.get(\"telecomType\")) {\r",
									"            switch (pm.variables.get(\"telecomType\").toLowerCase()) {\r",
									"                case 'telephone':\r",
									"                    telecomType = \"phone\";\r",
									"                    break;\r",
									"                case 'fax':\r",
									"                case 'email':\r",
									"                    telecomType = pm.variables.get(\"telecomType\");\r",
									"                    break;\r",
									"                case 'textphone':\r",
									"                    telecomType = \"pager\";\r",
									"                    break;\r",
									"                default:\r",
									"                    pm.expect.fail(\"telecomType mapping failure\");\r",
									"                    break;\r",
									"            }\r",
									"            pm.expect(response.telecom[0].system).to.eql(telecomType, \"invalid telecomType\");\r",
									"\r",
									"            let telecomUse;\r",
									"            switch (pm.variables.get(\"telecomUse\").toLowerCase()) {\r",
									"                case 'home':\r",
									"                case 'answering machine':\r",
									"                case 'emergency':\r",
									"                    telecomUse = \"home\";\r",
									"                    break;\r",
									"                case 'work':\r",
									"                case 'mobile':\r",
									"                    telecomUse = pm.variables.get(\"telecomUse\");\r",
									"                    break;\r",
									"                case 'pager':\r",
									"                    telecomUse = \"mobile\";\r",
									"                    break;\r",
									"                case 'temporary':\r",
									"                    telecomUse = \"temp\";\r",
									"                    break;\r",
									"            }\r",
									"\r",
									"            pm.expect(response.telecom[0].use).to.eql(telecomUse, \"invalid telecomUse\");\r",
									"            pm.expect(response.telecom[0].period.start).to.eql((pm.variables.get(\"telecomPeriodStart\")));\r",
									"            pm.expect(response.telecom[0].value).to.eql((pm.variables.get(\"telecomValue\")));\r",
									"        }\r",
									"        else {\r",
									"            pm.expect(response.telecom).to.eql(undefined);\r",
									"        }\r",
									"    })\r",
									"\r",
									"    pm.variables.unset(\"telecomType\");\r",
									"    pm.variables.unset(\"telecomUse\");\r",
									"};\r",
									"\r",
									"\r",
									"/*generalPractitioner mapping function*/\r",
									"pm.test(\"GeneralPractitioner has been mapped correctly\", () => {\r",
									"    if (pm.variables.get(\"s-flagged\") || !pm.variables.get(\"generalPractitionerValue\")) {\r",
									"        console.log(\"this is a sensitive patient or the generalPractitionerValue has not been set therefore generalPractice should not be returned\");\r",
									"        pm.expect(response.generalPractitioner).to.be.undefined;\r",
									"    } else {\r",
									"        console.log(\"generalPractitionerValue has been set for the patient so generalPractitionerValue should be returned\");\r",
									"        pm.expect(response.generalPractitioner[0].identifier.value).to.eql((pm.variables.get(\"generalPractitionerValue\")));\r",
									"        pm.expect(response.generalPractitioner[0].identifier.system).to.eql(\"https://fhir.nhs.uk/Id/ods-organization-code\");\r",
									"        pm.expect(response.generalPractitioner[0].type).to.eql(\"Organization\");\r",
									"        pm.expect(response.generalPractitioner[0].identifier.period.start).to.eql((pm.variables.get(\"generalPractitionerPeriodStart\")));\r",
									"        pm.expect(response.generalPractitioner[0].identifier.period.end).to.eql((pm.variables.get(\"generalPractitionerPeriodEnd\")));\r",
									"    }\r",
									"\r",
									"    pm.variables.unset(\"generalPractitionerValue\");\r",
									"    pm.variables.unset(\"generalPractitionerPeriodStart\");\r",
									"    pm.variables.unset(\"generalPractitionerPeriodEnd\");\r",
									"\r",
									"});\r",
									"\r",
									"/*nominatedPharmacy mapping function*/\r",
									"pm.test(\"nominatedPharmacy has been mapped correctly\", function () {\r",
									"    let nominatedPharmacyExists = (pm.variables.get(\"nominatedPharmacy\"));\r",
									"    let nominatedPharmacyExtension = response.extension === undefined ? undefined : getNominatedPharmacy(response.extension);\r",
									"\r",
									"    if (!nominatedPharmacyExists) {\r",
									"        pm.expect(nominatedPharmacyExtension).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        console.log(\"nominatedPharmacy has been set for the patient so nominatedPharmacy should be returned\");\r",
									"        pm.expect(nominatedPharmacyExtension.url).to.eql(\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\");\r",
									"        pm.expect(nominatedPharmacyExtension.valueReference.identifier.period.start).to.eql(pm.variables.get(\"nominatedPharmacyPeriodStart\"));\r",
									"        pm.expect(nominatedPharmacyExtension.valueReference.identifier.period.end).to.eql(pm.variables.get(\"nominatedPharmacyPeriodEnd\"));\r",
									"        pm.expect(nominatedPharmacyExtension.valueReference.identifier.value).to.eql(pm.variables.get(\"nominatedPharmacy\"));\r",
									"        pm.expect(nominatedPharmacyExtension.valueReference.identifier.system).to.eql(\"https://fhir.nhs.uk/Id/ods-organization-code\",\"invalid system\");\r",
									"    }\r",
									"\r",
									"    pm.variables.unset(\"nominatedPharmacy\");\r",
									"    pm.variables.unset(\"nominatedPharmacyPeriodStart\");\r",
									"    pm.variables.unset(\"nominatedPharmacyPeriodEnd\");\r",
									"});\r",
									"\r",
									"\r",
									"/*dispensingDoctor mapping function*/\r",
									"pm.test(\"dispensingDoctor has been mapped correctly\", function () {\r",
									"    let dispensingDoctorExtension = response.extension === undefined ? undefined : getDispensingDoctor(response.extension);\r",
									"    let dispensingDoctorExists = pm.variables.get(\"dispensingDoctor\");\r",
									"\r",
									"    if (!dispensingDoctorExists) {\r",
									"        pm.expect(dispensingDoctorExtension).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        console.log(\"dispensingDoctor has been set for the patient so dispensingDoctor should be returned\");\r",
									"        pm.expect(dispensingDoctorExtension.url).to.eql(\"https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-DispensingDoctor\");\r",
									"        pm.expect(dispensingDoctorExtension.valueReference.identifier.period.start).to.eql(pm.variables.get(\"dispensingDoctorPeriodStart\"));\r",
									"        pm.expect(dispensingDoctorExtension.valueReference.identifier.value).to.eql(pm.variables.get(\"dispensingDoctor\"));\r",
									"        pm.expect(dispensingDoctorExtension.valueReference.identifier.system).to.eql(\"https://fhir.nhs.uk/Id/ods-organization-code\");\r",
									"    }\r",
									"    pm.variables.unset(\"dispensingDoctor\");\r",
									"    pm.variables.unset(\"dispensingDoctorPeriodStart\");\r",
									"});\r",
									"\r",
									"/*medicalApplianceSupplier mapping function*/\r",
									"pm.test(\"medicalApplianceSupplier has been mapped correctly\", function () {\r",
									"    let medicalApplianceSupplierExtension = response.extension === undefined ? undefined : getMedicalApplianceSupplier(response.extension);\r",
									"    let medicalApplianceSupplierExists = pm.variables.get(\"medicalApplianceSupplier\");\r",
									"\r",
									"    if (!medicalApplianceSupplierExists) {\r",
									"        pm.expect(medicalApplianceSupplierExtension).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        console.log(\"medicalApplianceSupplier has been set for the patient so medicalApplianceSupplier should be returned\");\r",
									"        pm.expect(medicalApplianceSupplierExtension.url).to.eql(\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\");\r",
									"        pm.expect(medicalApplianceSupplierExtension.valueReference.identifier.period.start).to.eql(pm.variables.get(\"medicalApplianceSupplierPeriodStart\"));\r",
									"        pm.expect(medicalApplianceSupplierExtension.valueReference.identifier.value).to.eql(pm.variables.get(\"medicalApplianceSupplier\"));\r",
									"        pm.expect(medicalApplianceSupplierExtension.valueReference.identifier.system).to.eql(\"https://fhir.nhs.uk/Id/ods-organization-code\");\r",
									"    }\r",
									"    pm.variables.unset(\"medicalApplianceSupplier\");\r",
									"    pm.variables.unset(\"medicalApplianceSupplierPeriodStart\");\r",
									"});\r",
									"\r",
									"\r",
									"pm.test(\"language Extention has been mapped correctly\", () => {\r",
									"    let languageExtension = response.extension === undefined ? undefined : getLanguageExtention(response.extension);\r",
									"    let language = pm.variables.get(\"language\");\r",
									"\r",
									"    if (!language) {\r",
									"        pm.expect(languageExtension).to.eql(undefined);\r",
									"    }\r",
									"    else {\r",
									"        pm.expect(languageExtension.extension[0].url).to.eql(\"language\");\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].code).to.eql(pm.variables.get(\"language\"));\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].display).to.eql(pm.variables.get(\"languageDisplay\"));\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-HumanLanguage\");\r",
									"        pm.expect(languageExtension.extension[0].valueCodeableConcept.coding[0].version).to.eql(\"1.0.0\");\r",
									"        pm.expect(languageExtension.extension[1].url).to.eql(\"interpreterRequired\");\r",
									"        pm.expect(languageExtension.extension[1].valueBoolean).to.eql(pm.variables.get(\"interpreter\"));\r",
									"        pm.expect(languageExtension.url).to.equal('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NHSCommunication', 'invalid url');\r",
									"    }\r",
									"\r",
									"    pm.variables.unset(\"language\");\r",
									"    pm.variables.unset(\"languageDisplay\");\r",
									"    pm.variables.unset(\"interpreter\");\r",
									"\r",
									"});\r",
									"\r",
									"function getLanguageExtention(extensions) {\r",
									"    for (let extensions of response.extension) {\r",
									"        try {\r",
									"                for (let e of extensions.extension) {\r",
									"                    if (e.url == \"language\") {\r",
									"                    console.log(e);\r",
									"                    return extensions;\r",
									"                    }       \r",
									"                 }\r",
									"            } catch(err) {\r",
									"                }\r",
									"        }\r",
									"}\r",
									"\r",
									"\r",
									"function getDispensingDoctor(extensions) {\r",
									"\tfor (let extensions of response.extension) {\r",
									"\t\t\t\ttry {\r",
									"\t\t\t\t\tif (extensions.url == \"https://fhir.nhs.uk/R4/StructureDefinition/Extension-UKCore-DispensingDoctor\") {\r",
									"\t\t\t\t\t\tconsole.log(\"dispensingDoctorExists\");\r",
									"\t\t\t\t\t\treturn extensions;\r",
									"\t\t\t\t\t}\r",
									"\t\t\t\t} catch(err) {\r",
									"\t\t\t\t}\r",
									"\t\t\t}\r",
									"}\r",
									"\r",
									"function getNominatedPharmacy(extensions) {\r",
									"\tfor (let extensions of response.extension) {\r",
									"\t\t\t\ttry {\r",
									"\t\t\t\t\tif (extensions.url == \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-NominatedPharmacy\") {\r",
									"\t\t\t\t\t\tconsole.log(\"nominatedPharmacyExists\");\r",
									"\t\t\t\t\t\treturn extensions;\r",
									"\t\t\t\t\t}\r",
									"\t\t\t\t} catch(err) {\r",
									"\t\t\t\t}\r",
									"\t\t\t}\r",
									"}\r",
									"\r",
									"function getMedicalApplianceSupplier(extensions) {\r",
									"\tfor (let extensions of response.extension) {\r",
									"\t    console.log(extensions)\r",
									"\t\t\t\ttry {\r",
									"\t\t\t\t\tif (extensions.url == \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicalApplianceSupplier\") {\r",
									"\t\t\t\t\t\tconsole.log(\"medicalApplianceSupplierExists\");\r",
									"\t\t\t\t\t\treturn extensions;\r",
									"\t\t\t\t\t}\r",
									"\t\t\t\t} catch(err) {\r",
									"\t\t\t\t}\r",
									"\t\t\t}\r",
									"}\r",
									"\r",
									"\r",
									"};       \r",
									"\r",
									"pm.variables.set(\"s-flagged\",false);\r",
									"pm.globals.set(\"checkRetrieveMappings\", checkRetrieveMappings.toString());"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "BuildAndSendHL7Patient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "970581a7-47f5-43f8-86b1-3c96a75fb938",
								"exec": [
									"/*This function builds a HL7 Patient message using randomised: familyName, postCode & DOB\r",
									"=========================================================================================*/\r",
									"\r",
									"var BuildHL7Patient = () => {\r",
									"    /*create a random guid for messageid*/\r",
									"    let messageGUID = pm.variables.replaceIn('{{$randomUUID}}')\r",
									"    pm.variables.set(\"HL7messageGUID\", messageGUID);\r",
									"\r",
									"    /*create a random guid for rootid*/\r",
									"    let rootGUID = pm.variables.replaceIn('{{$randomUUID}}')\r",
									"    pm.variables.set(\"HL7rootGUID\", rootGUID);\r",
									"\r",
									"    /*create a random lastname*/\r",
									"    let family = pm.variables.replaceIn(\"{{$randomLastName}}\");\r",
									"    pm.variables.set(\"family\", family);\r",
									"    console.log(pm.variables.get(\"family\"))\r",
									"\r",
									"    /*create a random postCode*/\r",
									"    pm.variables.set(\"postCode\", \"HL12\" + \" \" + _.random(1, 9) + \"HL\");\r",
									"    console.log(pm.variables.get(\"postCode\"))\r",
									"\r",
									"    /*create a random birthDate*/\r",
									"    var moment = require('moment');\r",
									"    let randomYears = _.random(10, 50);\r",
									"    pm.variables.set(\"birthTime\", moment().subtract(randomYears, 'years').format(\"YYYYMMDD\"));\r",
									"    pm.variables.set(\"birthDate\", moment().subtract(randomYears, 'years').format(\"YYYY-MM-DD\"));\r",
									"    console.log(pm.variables.get(\"birthDate\"))\r",
									"\r",
									"    pm.globals.set(\"HL7PatientMessage\", '----=_MIME-Boundary' + '\\n' + 'Content-Id: <8e68e6bb-2044-44f1-9427-271bccdad97a>' + '\\n' + 'Content-Type: text/xml' + '\\n' + 'Content-Transfer-Encoding: 8bit' + '\\n\\n' + '<?xml version=\"1.0\" encoding=\"UTF-8\"?><SOAP:Envelope xmlns:xsi=\"http://www.w3c.org/2001/XML-Schema-Instance\" xmlns:SOAP=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:eb=\"http://www.oasis-open.org/committees/ebxml-msg/schema/msg-header-2_0.xsd\" xmlns:hl7ebxml=\"urn:hl7-org:transport/ebxml/DSTUv1.0\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><SOAP:Header><eb:MessageHeader SOAP:mustUnderstand=\"1\" eb:version=\"2.0\"><eb:From><eb:PartyId eb:type=\"urn:nhs:names:partyType:ocs+serviceInstance\">RHM-812580</eb:PartyId></eb:From><eb:To><eb:PartyId eb:type=\"urn:nhs:names:partyType:ocs+serviceInstance\">YES-0000806</eb:PartyId></eb:To><eb:CPAId>S20002A000236</eb:CPAId><eb:ConversationId>' + pm.variables.get(\"HL7messageGUID\") + '</eb:ConversationId><eb:Service>urn:nhs:names:services:pds</eb:Service><eb:Action>PRPA_IN000200UK03</eb:Action><eb:MessageData><eb:MessageId>' + pm.variables.get(\"HL7messageGUID\") + '</eb:MessageId><eb:Timestamp>2020-05-12T08:23:49</eb:Timestamp></eb:MessageData><eb:DuplicateElimination/></eb:MessageHeader><eb:AckRequested eb:version=\"2.0\" SOAP:mustUnderstand=\"1\" SOAP:actor=\"urn:oasis:names:tc:ebxml-msg:actor:toPartyMSH\" eb:signed=\"false\"/><eb:SyncReply eb:version=\"2.0\" SOAP:mustUnderstand=\"1\" SOAP:actor=\"http://schemas.xmlsoap.org/soap/actor/next\"/></SOAP:Header><SOAP:Body><eb:Manifest eb:version=\"2.0\"><eb:Reference xlink:href=\"cid:31321d7e-d449-40f2-8362-6598c5b3ffae\"><eb:Schema eb:location=\"http://www.nhsia.nhs.uk/schemas/HL7-Message.xsd\" eb:version=\"1.0\"/><eb:Description xml:lang=\"en\">HL7 payload</eb:Description><hl7ebxml:Payload style=\"HL7\" encoding=\"XML\" version=\"3.0\"/></eb:Reference></eb:Manifest></SOAP:Body></SOAP:Envelope>' + '\\n\\n' + '----=_MIME-Boundary' + '\\n' + 'Content-Id: <31321d7e-d449-40f2-8362-6598c5b3ffae>' + '\\n' + 'Content-Type: application/xml; charset=UTF-8' + '\\n' + 'Content-Transfer-Encoding: 8bit' + '\\n\\n' + '<?xml version=\"1.0\" encoding=\"UTF-8\"?><PRPA_IN000200UK03 xmlns=\"urn:hl7-org:v3\"><id root=\"' + pm.variables.get(\"HL7rootGUID\") + '\"/><creationTime value=\"20200512082349\"/><versionCode code=\"V3NPfIT4.2.00\"/><interactionId extension=\"PRPA_IN000200UK03\" root=\"2.16.840.1.113883.2.1.3.2.4.12\"/><processingCode code=\"P\"/><processingModeCode code=\"T\"/><acceptAckCode code=\"NE\"/><communicationFunctionRcv><device classCode=\"DEV\" determinerCode=\"INSTANCE\"><id extension=\"928942012545\" root=\"1.2.826.0.1285.0.2.0.107\"/></device></communicationFunctionRcv><communicationFunctionSnd><device classCode=\"DEV\" determinerCode=\"INSTANCE\"><id extension=\"230705069519\" root=\"1.2.826.0.1285.0.2.0.107\"/></device></communicationFunctionSnd><ControlActEvent classCode=\"CACT\" moodCode=\"EVN\"><author1 typeCode=\"AUT\"><AgentSystemSDS classCode=\"AGNT\"><agentSystemSDS classCode=\"DEV\" determinerCode=\"INSTANCE\"><id extension=\"230705069519\" root=\"1.2.826.0.1285.0.2.0.107\"/></agentSystemSDS></AgentSystemSDS></author1><subject>\t\t\t<PdsRegistrationRequest classCode=\"REG\" moodCode=\"RQO\"><author typeCode=\"AUT\"><registeringAuthority classCode=\"ASSIGNED\"><code code=\"c\" codeSystem=\"2.16.840.1.113883.2.1.3.2.4.16.20\" /><id root=\"1.2.826.0.1285.0.2.1.54\" extension=\"TEST\" /></registeringAuthority></author><subject typeCode=\"SBJ\"><patientRole classCode=\"PAT\"><addr use=\"H\"><streetAddressLine>testing</streetAddressLine><streetAddressLine>testing</streetAddressLine><streetAddressLine>testing</streetAddressLine><streetAddressLine>testing</streetAddressLine><streetAddressLine>testing</streetAddressLine><postalCode>' + pm.variables.get(\"postCode\") + '</postalCode></addr><patientPerson classCode=\"PSN\" determinerCode=\"INSTANCE\"><administrativeGenderCode code=\"2\" /><birthTime value=\"' + pm.variables.get(\"birthTime\") + '\" /><name use=\"L\"><given>testing</given><family>' + pm.variables.get(\"family\") + '</family></name><languageCommunication><languageCode code=\"hy\" /><preferenceInd value=\"true\" /><proficiencyLevelCode code=\"0\" codeSystem=\"2.16.840.1.113883.2.1.3.2.4.16.39\" /></languageCommunication></patientPerson><subjectOf5 typeCode=\"SBJ\"><previousNhsContact classCode=\"OBS\" moodCode=\"EVN\"><code code=\"17\" codeSystem=\"2.16.840.1.113883.2.1.3.2.4.17.35\" /><value code=\"0\" codeSystem=\"2.16.840.1.113883.2.1.3.2.4.17.38\" /></previousNhsContact></subjectOf5></patientRole></subject></PdsRegistrationRequest></subject></ControlActEvent></PRPA_IN000200UK03>' + '\\n\\n' + '----=_MIME-Boundary--')\r",
									"\r",
									"};\r",
									"pm.globals.set(\"BuildHL7Patient\", BuildHL7Patient.toString());\r",
									"\r",
									"/*This function Sends a HL7 Create Patient Request (using the HL7PatientMessage global variable as the message body), and checks for a 202 response\r",
									"===================================================================================================================================================*/\r",
									"\r",
									"var SendHL7Patient = () => {\r",
									"    var Header = require('postman-collection').Header;\r",
									"\r",
									"    /*set message headers*/\r",
									"    let contentType = new Header({\r",
									"        key: 'Content-Type',\r",
									"        value: 'multipart/related; boundary=\"--=_MIME-Boundary\"; type=\"text/xml\"; start=\"<ebXMLHeader@spine.nhs.uk(Opens in new tab)(Opens in new tab)(Opens in new tab)>\"'\r",
									"    });\r",
									"    let SOAPAction = 'urn:nhs:names:services:pds/PRPA_IN000200UK03'\r",
									"\r",
									"    /*set message body*/\r",
									"    var xmlBody = pm.globals.get(\"HL7PatientMessage\")\r",
									"\r",
									"    /*send request with pre-defined headers and body*/\r",
									"    pm.sendRequest({\r",
									"        url: 'https://10.239.9.7/reliablemessaging/reliablerequest',\r",
									"        method: 'POST',\r",
									"        header: { contentType, SOAPAction },\r",
									"        body: xmlBody\r",
									"    }, function (err, response) {\r",
									"        pm.test(\"Check HL7 Create Patient returns Status code 202 \", () => {\r",
									"            pm.expect(response.code).to.equal(202);\r",
									"        });\r",
									"    })\r",
									"};\r",
									"pm.globals.set(\"SendHL7Patient\", SendHL7Patient.toString());"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "fc8b11ec-5b0a-4e4a-813c-1fd12ae4877d",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "{{nhsd-asid-header}}",
								"type": "text",
								"value": "{{from_asid}}"
							},
							{
								"key": "{{nhsd-session-urid-header}}",
								"type": "text",
								"value": "{{role_id}}"
							},
							{
								"key": "{{nhsd-identity-uuid-header}}",
								"type": "text",
								"value": "{{user_id}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "",
							"options": {
								"raw": {}
							}
						},
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						},
						"description": "Testing the correct url is returned on an error response"
					},
					"response": []
				},
				{
					"name": "PDS Search & Retrieve",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "e1daaa52-ce12-4c54-912b-c87e0611888c",
								"exec": [
									"/*This function Sends a PDS Search request to obbtain the Patient nhs Id & patient record version Id\r",
									"====================================================================================================*/\r",
									"\r",
									"var SendPDSSearch = () => {\r",
									"    setTimeout(function () {\r",
									"        var Header = require('postman-collection').Header;\r",
									"        let asidHeader = pm.variables.get(\"asidHeader\");\r",
									"        let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");\r",
									"        let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");\r",
									"        let authorization = pm.environment.get(\"authorizationHeader\");\r",
									"\r",
									"        pm.sendRequest({\r",
									"            url: pm.environment.get(\"environment\") + \"/Patient?family=\" + pm.variables.get(\"family\") + \"&gender=female&birthdate=\" + pm.variables.get(\"birthDate\"),\r",
									"            method: 'GET',\r",
									"            header: { authorization, asidHeader, sessionURIDHeader, identityUUIDHeader }\r",
									"        }, function (err, response) {\r",
									"            pm.test(\"Check PDS Search returns Status code 200 \", () => {\r",
									"                pm.expect(response.code).to.equal(200);\r",
									"            });\r",
									"            pm.globals.set(\"nhsID\", response.json().entry[0].resource.id);\r",
									"            pm.globals.set(\"metaVersionId\", 'W/\"' + response.json().entry[0].resource.meta.versionId + '\"')\r",
									"            pm.globals.set(\"versionId\", parseInt(response.json().entry[0].resource.meta.versionId));\r",
									"            console.log(\"meta version id of Patient is: \" + pm.globals.get(\"metaVersionId\"))\r",
									"            console.log(\"nhs id of Patient is: \" + pm.globals.get(\"nhsID\"))\r",
									"        });\r",
									"    }, 3000);\r",
									"}\r",
									"\r",
									"pm.globals.set(\"SendPDSSearch\", SendPDSSearch.toString());\r",
									"\r",
									"\r",
									"/*Send a PDS Retrieve request to obbtain the Patient patient record version Id.\r",
									"=============================================================================*/\r",
									"\r",
									"var SendPDSRetrieve = () => {\r",
									"    setTimeout(function () {\r",
									"        var Header = require('postman-collection').Header;\r",
									"        let asidHeader = pm.variables.get(\"asidHeader\");\r",
									"        let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");\r",
									"        let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");\r",
									"        let authorization = pm.environment.get(\"authorizationHeader\");\r",
									"\r",
									"        pm.sendRequest({\r",
									"            url: pm.environment.get(\"environment\") + \"/Patient/\" + pm.globals.get(\"nhsID\"),\r",
									"            method: 'GET',\r",
									"            header: { authorization, asidHeader, sessionURIDHeader, identityUUIDHeader }\r",
									"\r",
									"        }, function (err, response) {\r",
									"            pm.test(\"Check PDS Retrieve returns Status code 200 \", () => {\r",
									"                pm.expect(response.code).to.equal(200);\r",
									"            });\r",
									"            pm.globals.set(\"metaVersionId\", response.headers.get('Etag'));\r",
									"            pm.variables.set(\"versionId\", parseInt(response.json().meta.versionId));\r",
									"            console.log(\"Patient record version is: \" + pm.variables.get(\"versionId\"));\r",
									"            console.log(\"Patient record version is: \" + pm.globals.get(\"metaVersionId\"));\r",
									"\r",
									"        })\r",
									"    }, 7000);\r",
									"};\r",
									"pm.globals.set(\"SendPDSRetrieve\", SendPDSRetrieve.toString());\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "BuildAndSendHL7RetreivePatient",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "b93306f4-da08-4af3-a293-72d8fe14f24c",
								"exec": [
									"/*This function builds and sends a HL7 Retrieve request and saves the response to a global variable: \"HL7RetrieveResponse\" for the purposes of asserting the payload\r",
									"====================================================================================================================================================================*/\r",
									"\r",
									"var SendHL7RetrievePatientMessage = () => {\r",
									"    setTimeout(function () {\r",
									"        pm.globals.set(\"HL7RetrievePatientMessage\", '<SOAP-ENV:Envelope xmlns:SOAP-ENV=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:wsa=\"http://schemas.xmlsoap.org/ws/2004/08/addressing\" xmlns:hl7=\"urn:hl7-org:v3\"><SOAP-ENV:Header><wsa:MessageID>uuid:82CC8716-71B7-44F3-B885-B18DD08B31AE</wsa:MessageID><wsa:Action>urn:nhs:names:services:pdsquery/QUPA_IN000008UK05</wsa:Action><wsa:To>https://10.239.9.7/sync-service</wsa:To><wsa:From><wsa:Address>10.210.164.11</wsa:Address></wsa:From><hl7:communicationFunctionRcv><hl7:device><hl7:id root=\"1.2.826.0.1285.0.2.0.107\" extension=\"928942012545\"/></hl7:device></hl7:communicationFunctionRcv><hl7:communicationFunctionSnd><hl7:device><hl7:id root=\"1.2.826.0.1285.0.2.0.107\" extension=\"230705069519\"/></hl7:device></hl7:communicationFunctionSnd><wsa:ReplyTo><wsa:Address>10.210.164.11</wsa:Address></wsa:ReplyTo></SOAP-ENV:Header><SOAP-ENV:Body><QUPA_IN000008UK05 xmlns=\"urn:hl7-org:v3\"><id root=\"D3C68B29-9533-45D6-837C-3375CFFE07D1\"/><creationTime value=\"20200511140552\"/><versionCode code=\"V3NPfIT4.2.00\"/><interactionId extension=\"QUPA_IN000008UK05\" root=\"2.16.840.1.113883.2.1.3.2.4.12\"/><processingCode code=\"P\"/><processingModeCode code=\"T\"/><acceptAckCode code=\"NE\"/><communicationFunctionRcv><device classCode=\"DEV\" determinerCode=\"INSTANCE\"><id extension=\"928942012545\" root=\"1.2.826.0.1285.0.2.0.107\"/></device></communicationFunctionRcv><communicationFunctionSnd><device classCode=\"DEV\" determinerCode=\"INSTANCE\"><id extension=\"230705069519\" root=\"1.2.826.0.1285.0.2.0.107\"/></device></communicationFunctionSnd><ControlActEvent classCode=\"CACT\" moodCode=\"EVN\"><author1 typeCode=\"AUT\"><AgentSystemSDS classCode=\"AGNT\"><agentSystemSDS classCode=\"DEV\" determinerCode=\"INSTANCE\"><id extension=\"230705069519\" root=\"1.2.826.0.1285.0.2.0.107\"/></agentSystemSDS></AgentSystemSDS></author1><query><historicDataIndicator><semanticsText>HistoricDataIndicator</semanticsText><value code=\"0\" codeSystem=\"2.16.840.1.113883.2.1.3.2.4.17.36\"/></historicDataIndicator><person.id><semanticsText>Person.id</semanticsText><value root=\"2.16.840.1.113883.2.1.4.1\" extension=\"' + pm.globals.get(\"nhsID\") + '\"/></person.id><retrievalItem><semanticsText>person.fullDemographics</semanticsText></retrievalItem></query></ControlActEvent></QUPA_IN000008UK05></SOAP-ENV:Body></SOAP-ENV:Envelope>')\r",
									"\r",
									"        var Header = require('postman-collection').Header;\r",
									"\r",
									"        /*set message headers*/\r",
									"        let contentType = new Header({\r",
									"            key: 'Content-Type',\r",
									"            value: 'application/xml'\r",
									"        });\r",
									"        let SOAPAction = 'urn:nhs:names:services:pdsquery/QUPA_IN000008UK05'\r",
									"\r",
									"        /*set message body*/\r",
									"        var xmlBody = pm.globals.get(\"HL7RetrievePatientMessage\")\r",
									"\r",
									"        /*send request with pre-defined headers and body*/\r",
									"\r",
									"        pm.sendRequest({\r",
									"            url: 'https://10.239.9.7/reliablemessaging/reliablerequest',\r",
									"            method: 'POST',\r",
									"            header: { contentType, SOAPAction },\r",
									"            body: xmlBody\r",
									"        }, function (err, response) {\r",
									"            pm.test(\"Check HL7 Retrieve Patient returns Status code 200 \", () => {\r",
									"                pm.expect(response.code).to.equal(200);\r",
									"            });\r",
									"            var response = xml2Json(response.text());\r",
									"            pm.globals.set(\"HL7RetrieveResponse\", response)\r",
									"            console.log(pm.globals.get(\"HL7RetrieveResponse\"))\r",
									"        })\r",
									"    }, 1000);\r",
									"};\r",
									"pm.globals.set(\"SendHL7RetrievePatientMessage\", SendHL7RetrievePatientMessage.toString());\r",
									"\r",
									"\r",
									""
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"id": "c5eed767-9b7d-4c57-a8a8-b3619d98b1cd",
								"exec": [
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "SOAPAction",
								"type": "text",
								"value": "urn:nhs:names:services:pdsquery/QUPA_IN000008UK05"
							}
						],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "BuildMeAPatch",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "8e9569e6-e8c2-49c1-aed6-e26d4bfe0802",
								"exec": [
									"/* this function builds patches for the purposes of using in PDS Update patch requests when needed.  Each patch gets saved to its own global variable\r",
									"=====================================================================================================================================================*/\r",
									"\r",
									"var BuildMeAPatch = () => {\r",
									"\r",
									"    let deathNotification = '{ \"patches\": [\t{ \"op\": \"add\", \"path\": \"/deceasedDateTime\", \"value\": \"2020-01-01\" }, { \"op\": \"add\", \"path\": \"/extension/-\", \"value\": { \"extension\": [ { \"url\": \"deathNotificationStatus\", \"valueCodeableConcept\": { \"coding\": [ { \"code\": \"1\", \"display\": \"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\", \"system\": \"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\", \"version\": \"1.0.0\" } ] } }, { \"url\": \"systemEffectiveDate\", \"valueDateTime\": \"2020-02-27T16:14:58+00:00\" } ], \"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\" } } ] }'\r",
									"\r",
									"    pm.globals.set(\"deathNotification\", deathNotification.toString());\r",
									"}\r",
									"pm.globals.set(\"BuildMeAPatch\", BuildMeAPatch.toString());\r",
									"BuildMeAPatch();\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "CreateMeAPatchRequest",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "05dc4b30-3660-4673-8448-63c0f079416d",
								"exec": [
									"/* This function creates Patch requests to be used as pm.send requests for the purposes of pre-requisites.  THIS IS NOT YET COMPLETE\r",
									"====================================================================================================================================*/\r",
									"\r",
									"/*\r",
									"var CreateMeAPatchRequest = () => {\r",
									"\r",
									"    let deathNotificationPatch = 'setTimeout(function () { var Header = require(\"postman-collection\").Header; let asidHeader = pm.environment.get(\"asidHeader\"); let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\"); let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\"); let contentType = new Header({ key: 'Content-Type', value: 'application / json - patch + json' }); let ifMatch = new Header({ key: 'If - Match', value: pm.globals.get(\"metaVersionId\") }); let deathNotification = pm.globals.get(\"deathNotification\"); pm.sendRequest({ url: pm.environment.get(\"environment\") + ' / Patient / ' + pm.globals.get(\"nhsID\"), method: 'PATCH', header: { asidHeader, sessionURIDHeader, identityUUIDHeader, contentType, ifMatch }, body: deathNotification }, function (err, response) { pm.test(\"Returns Status code 200\", function () { pm.expect(response.code).to.equal(200); }); pm.globals.set(\"metaVersionId\", response.headers.get('Etag')); pm.variables.set(\"versionId\", parseInt(response.json().meta.versionId)); console.log(\"Patient record version is: \" + pm.variables.get(\"versionId\")); console.log(\"Patient record version is: \" + pm.globals.get(\"metaVersionId\")); }); }, 9000);'\r",
									"}\r",
									"*/"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "HL7RetrieveResponseChecks",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "12c991aa-834e-4908-8209-00a00d9fe33e",
								"exec": [
									"/*HL7 Retrieve Response Checks: Provides tests to assert against HL7 Retrieve responses\r",
									"=======================================================================================*/\r",
									"\r",
									"pm.globals.set('HL7ResponseValidator', function HL7ResponseValidator() {\r",
									"\r",
									"    let response = pm.globals.get(\"HL7RetrieveResponse\");\r",
									"    let message = {};\r",
									"    \r",
									"    /*check the DoB has been populated correcty*/\r",
									"    message.assertHL7DateOfBirthIs = (DOB) => {\r",
									"        pm.test(\"Check HL7 Response Date of Birth = \" + DOB, () => {\r",
									"            pm.expect(response[\"SOAP-ENV:Envelope\"][\"SOAP-ENV:Body\"].retrievalQueryResponse.QUPA_IN000009UK06.ControlActEvent.subject.PDSResponse.subject.patientRole.patientPerson[\"COCT_MT000210UK01.PartBirthTime\"].partPerson.birthTime.$.value).to.eql(DOB);\r",
									"        });\r",
									"    }\r",
									"\r",
									"\r",
									"    /*check the DoD has been populated correcty*/\r",
									"    message.assertHL7DateOfDeathIs = (DOD) => {\r",
									"        pm.test(\"Check HL7 Response Date of Death = \" + DOD, () => {\r",
									"            pm.expect(response[\"SOAP-ENV:Envelope\"][\"SOAP-ENV:Body\"].retrievalQueryResponse.QUPA_IN000009UK06.ControlActEvent.subject.PDSResponse.subject.patientRole.patientPerson[\"COCT_MT000211UK01.PartDeceasedTime\"].partPerson.deceasedTime.$.value).to.eql(DOD);\r",
									"        });\r",
									"    }\r",
									"\r",
									"    /*check the Death Notification Date has been populated correcty*/\r",
									"    message.assertHL7DeathNotificationDateIs = (DND) => {\r",
									"        pm.test(\"Check HL7 Response Death Death Notification Date = \" + DND, () => {\r",
									"            pm.expect(response[\"SOAP-ENV:Envelope\"][\"SOAP-ENV:Body\"].retrievalQueryResponse.QUPA_IN000009UK06.ControlActEvent.subject.PDSResponse.subject.patientRole.patientPerson[\"COCT_MT000211UK01.PartDeceasedTime\"].subjectOf.notificationTime.value.$.value).to.eql(DND)\r",
									"        });\r",
									"    }\r",
									"\r",
									"    /*check the Death Notification has been populated correcty*/\r",
									"    message.assertHL7DeathNotificationIs = (DN) => {\r",
									"        pm.test(\"Check HL7 Response Death Notification  = \" + DN, () => {\r",
									"            pm.expect(response[\"SOAP-ENV:Envelope\"][\"SOAP-ENV:Body\"].retrievalQueryResponse.QUPA_IN000009UK06.ControlActEvent.subject.PDSResponse.subject.patientRole.subjectOf2.deathNotification.code.$.code).to.eql(DN)\r",
									"        });\r",
									"    }\r",
									"    return message;\r",
									"\r",
									"} + '; HL7ResponseValidator();');"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PDSUpdateResponseChecks",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"id": "047bde26-6ed7-4ec8-8a33-e58785fcdc71",
								"exec": [
									"/*HL7 Retrieve Response Checks: Provides tests to assert against HL7 Retrieve responses\r",
									"=======================================================================================*/\r",
									"\r",
									"pm.globals.set('PDSUpdateResponseValidator', function PDSUpdateResponseValidator() {\r",
									"\r",
									"    var response = pm.response.json();\r",
									"    let message = {};\r",
									"\r",
									"    /*check the DoB has been populated correcty*/\r",
									"    message.assertDateOfBirthHasBeenUpdated = (DOB) => {\r",
									"        pm.test(\"PDS Update Response Date of Birth = \" + DOB, () => {\r",
									"            pm.expect(response.birthDate).to.eql(DOB);\r",
									"        });\r",
									"    }\r",
									"\r",
									"    /*check the DoD has been populated correcty*/\r",
									"    message.assertDateOfDeathHasBeenUpdated = (DOD) => {\r",
									"        pm.test(\"PDS Update Response Date of Death = \" + DOD, () => {\r",
									"            pm.expect(response.deceasedDateTime.substr(0, 10)).to.eql(DOD);\r",
									"        });\r",
									"    }\r",
									"\r",
									"    /*check the Death Notification has been populated correcty*/\r",
									"    message.assertDeathNotificationHasBeenUpdated = () => {\r",
									"        pm.test(\"PDS Update Death Notification has been updated\", () => {\r",
									"            pm.expect(response.extension[0].url).to.eql(\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\");\r",
									"            pm.expect(response.extension[0].extension[0].url).to.eql(\"deathNotificationStatus\");\r",
									"            pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].code).to.eql(\"1\");\r",
									"            pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].display).to.eql(\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\");\r",
									"            pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].system).to.eql(\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\");\r",
									"            pm.expect(response.extension[0].extension[0].valueCodeableConcept.coding[0].version).to.eql(\"1.0.0\");\r",
									"            pm.expect(response.extension[0].extension[1].url).to.eql(\"systemEffectiveDate\");\r",
									"            pm.expect(response.extension[0].extension[1].valueDateTime.substr(0, 10)).to.eql(pm.globals.get(\"deathNotificationDateAndTime\").substr(0, 10));\r",
									"        });\r",
									"    }\r",
									"\r",
									"    /*check the Meta Version Id has been populated correcty*/\r",
									"    message.assertVersionIdHasBeenUpdated = () => {\r",
									"        pm.test(\"PDS Update VersionId has been updated\", () => {\r",
									"            let versionId = pm.globals.get(\"versionId\") + 1;\r",
									"            pm.expect(response.meta.versionId).to.eql(JSON.stringify(versionId));\r",
									"        });\r",
									"    }\r",
									"\r",
									"    return message;\r",
									"\r",
									"} + '; PDSUpdateResponseValidator();');\r",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{environment}}",
							"host": [
								"{{environment}}"
							]
						}
					},
					"response": []
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Patient",
			"item": [
				{
					"name": "Search",
					"item": [
						{
							"name": "Simple Search",
							"item": [
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 1",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Mapping\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2010-01-01\");",
													"",
													"",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Dame\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
													"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
													"pm.variables.set(\"patientId\", \"5900009068\");",
													"pm.variables.set(\"metaVersionId\", \"15\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
													"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
													"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Dame\" = PDS Fhir \"Dame\"\n* suffix\n* nameUse - specifically Spine nameType \"Usual name\" = PDS Fhir nameUse \"usual\"\n* namePeriodStart\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - specifically Spine addressType \"usual\" = PDS Fhir addresUse \"home\"\n* postCode\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\n* telecomUse - specifically Spine telecomUse \"home\" = PDS Fhir telecomUse \"home\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 2",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Alias\");",
													"pm.variables.set(\"gender\", \"male\");",
													"pm.variables.set(\"birthdate\", \"1990-10-10\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Dr\");",
													"pm.variables.set(\"nameType\", \"alias\");",
													"pm.variables.set(\"addressType\", \"work\");",
													"pm.variables.set(\"telecomType\", \"fax\");",
													"pm.variables.set(\"telecomUse\", \"work\");",
													"pm.variables.set(\"given\", [\"John\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"bt Global services\",\"1 sovereign Street\",\"leeds\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-28\");",
													"pm.variables.set(\"postalCode\", \"LS14BT\");",
													"pm.variables.set(\"patientId\", \"5900007820\");",
													"pm.variables.set(\"metaVersionId\", \"21\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-26\");",
													"pm.variables.set(\"telecomValue\", \"2342424234\");",
													"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
													"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
													"pm.variables.set(\"generalPractitionerPeriodEnd\", \"2020-04-29\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f45d509a-3d7a-48a5-8bd2-8c8cced401eb",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Dr\" = PDS Fhir \"Dr\"\n* suffix\n* nameUse - specifically Spine nameType \"alias\" = PDS Fhir nameUse \"nickname\"\n* namePeriodStart\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\n* postCode\n* telecomSystem - specifically Spine telecomType \"fax\" = PDS Fhir telecomSystem \"fax\"\n* telecomUse - specifically Spine telecomUse \"work\" = PDS Fhir telecomUse \"work\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 3",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Unknown\");",
													"pm.variables.set(\"genderQ\", \"unknown\");",
													"pm.variables.set(\"gender\", \"not known\");",
													"pm.variables.set(\"birthdate\", \"2001-02-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Lady\");",
													"pm.variables.set(\"nameType\", \"preferred\");",
													"pm.variables.set(\"addressType\", \"home\");",
													"pm.variables.set(\"telecomType\", \"textphone\");",
													"pm.variables.set(\"telecomUse\", \"pager\");",
													"pm.variables.set(\"given\", [\"person\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-02-26\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"13 westwood\",\"bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-26\");",
													"pm.variables.set(\"postalCode\", undefined);",
													"pm.variables.set(\"patientId\", \"5900007073\");",
													"pm.variables.set(\"metaVersionId\", \"4\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-26\");",
													"pm.variables.set(\"telecomValue\", \"0900000000\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "e0f9db16-d23e-465e-a016-a9b7e91581de",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{genderQ}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{genderQ}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Lady\" = PDS Fhir \"Lady\"\n* suffix\n* nameUse - specifically Spine nameType \"preferred\" = PDS Fhir nameUse \"usual\"\n* namePeriodStart\n* gender - specifically Spine gender \"not known\" = PDS Fhir nameUse \"unknown\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\n* postCode\n* telecomSystem - specifically Spine telecomType \"textphone\" = PDS Fhir telecomSystem \"pager\"\n* telecomUse - specifically Spine telecomUse \"pager\" = PDS Fhir telecomUse \"mobile\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 4",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"previous\");",
													"pm.variables.set(\"genderQ\", \"other\");",
													"pm.variables.set(\"gender\", \"not specified\");",
													"pm.variables.set(\"birthdate\", \"2008-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Lord\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"home\");",
													"pm.variables.set(\"telecomType\", \"email\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"given\", [\"someone\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-02-26\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"15 westwood ave\",\"eccleshill\",\"Bradford\",\"west yorkshire\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-04-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
													"pm.variables.set(\"patientId\", \"5900019241\");",
													"pm.variables.set(\"metaVersionId\", \"3\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-26\");",
													"pm.variables.set(\"telecomValue\", \"a.nhs@nhs.com\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{genderQ}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{genderQ}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Lord\" = PDS Fhir \"Lord\"\n* suffix\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\n* namePeriodStart\n* gender - specifically Spine gender \"not specified\" = PDS Fhir nameUse \"other\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\n* postCode\n* telecomSystem - specifically Spine telecomType \"email\" = PDS Fhir telecomSystem \"email\"\n* telecomUse - specifically Spine telecomUse \"home\" = PDS Fhir telecomUse \"home\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 5",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"temporary\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2004-03-01\");",
													"",
													"",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Miss\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"home\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"mobile\");",
													"pm.variables.set(\"given\", [\"ned\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"13 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
													"pm.variables.set(\"patientId\", \"5900008290\");",
													"pm.variables.set(\"metaVersionId\", \"3\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"telecomValue\", \"09000000000\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Miss\" = PDS Fhir \"Miss\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"mobile\" = PDS Fhir telecomUse \"mobile\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 6",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Mister\");",
													"pm.variables.set(\"gender\", \"male\");",
													"pm.variables.set(\"birthdate\", \"2009-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Mr\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"home\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"temporary\");",
													"",
													"pm.variables.set(\"given\", [\"Any\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"17 Westwood Avenue\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
													"pm.variables.set(\"patientId\", \"5900005798\");",
													"pm.variables.set(\"metaVersionId\", \"3\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"telecomValue\", \"0900000000\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Mr\" = PDS Fhir \"Mr\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"male\" = PDS Fhir nameUse \"male\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"temporary\" = PDS Fhir telecomUse \"temp\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 7",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Answermachine\");",
													"pm.variables.set(\"genderQ\", \"unknown\");",
													"pm.variables.set(\"gender\", \"not known\");",
													"pm.variables.set(\"birthdate\", \"2007-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Mrs\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"home\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"Answering Machine\");",
													"",
													"pm.variables.set(\"given\", [\"another\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"27 Westwood Avenue\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
													"pm.variables.set(\"patientId\", \"5900000605\");",
													"pm.variables.set(\"metaVersionId\", \"5\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"telecomValue\", \"09234567\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{genderQ}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{genderQ}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Mr\" = PDS Fhir \"Mr\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"not known\" = PDS Fhir nameUse \"unknown\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"Answering Machine\" = PDS Fhir telecomUse \"home\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - Minimum Criteria - Gender, DOB & Family 8",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "c3e2221d-db2e-4e98-a510-b18b78820f52",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Emergency\");",
													"pm.variables.set(\"genderQ\", \"other\");",
													"pm.variables.set(\"gender\", \"not specified\");",
													"pm.variables.set(\"birthdate\", \"2004-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"home\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"Emergency\");",
													"",
													"pm.variables.set(\"given\", [\"Emma\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"91 Westwood Avenue\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
													"pm.variables.set(\"patientId\", \"5900013863\");",
													"pm.variables.set(\"metaVersionId\", \"2\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
													"pm.variables.set(\"telecomValue\", \"0900000001\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{genderQ}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{genderQ}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Mr\" = PDS Fhir \"Mr\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"not specified\" = PDS Fhir nameUse \"other\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"Emergency\" = PDS Fhir telecomUse \"home\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								},
								{
									"name": "Simple Search - With Optional Criteria - Gender, DOB,  Family & DOD",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Mapping\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2010-01-01\");",
													"pm.variables.set(\"death-date\", \"2010-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Dame\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
													"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
													"pm.variables.set(\"patientId\", \"5900009068\");",
													"pm.variables.set(\"metaVersionId\", \"15\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
													"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
													"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&death-date={{deceasedDateTime}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "death-date",
													"value": "{{deceasedDateTime}}"
												}
											]
										},
										"description": "Testing the correct url is returned on an error response"
									},
									"response": []
								},
								{
									"name": "Simple Search - With Optional Criteria - Gender, DOB,  Family, DOD & Given",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Mapping\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2010-01-01\");",
													"pm.variables.set(\"death-date\", \"2010-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Dame\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
													"pm.variables.set(\"givenS\", \"Search\");",
													"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
													"pm.variables.set(\"patientId\", \"5900009068\");",
													"pm.variables.set(\"metaVersionId\", \"15\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
													"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
													"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&death-date={{deceasedDateTime}}&given={{givenS}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "death-date",
													"value": "{{deceasedDateTime}}"
												},
												{
													"key": "given",
													"value": "{{givenS}}"
												}
											]
										},
										"description": "Testing the correct url is returned on an error response"
									},
									"response": []
								},
								{
									"name": "Simple Search - With Optional Criteria - Gender, DOB,  Family & Given",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"family\", \"Mapping\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2010-01-01\");",
													"pm.variables.set(\"death-date\", \"2010-01-01\");",
													"",
													"//5900009068",
													"/*set variables for checking mapping*/",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Dame\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
													"pm.variables.set(\"givenS\", \"Search\");",
													"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
													"pm.variables.set(\"patientId\", \"5900009068\");",
													"pm.variables.set(\"metaVersionId\", \"15\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
													"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
													"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&given={{givenS}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "given",
													"value": "{{givenS}}"
												}
											]
										},
										"description": "Testing the correct url is returned on an error response"
									},
									"response": []
								},
								{
									"name": "Simple Search - Postcode Matching",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "4552d254-c7f0-4b1c-a65b-d01c8e24d4d4",
												"exec": [
													"pm.variables.set(\"testData\", testData = [",
													"    {",
													"        test: 'No Postcode',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01'",
													"    },",
													"    {",
													"        test: 'Correct Postcode',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&address-postcode=P1 3PP'",
													"    },",
													"    {",
													"        test: 'Incorrect Postcode',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&address-postcode=P1 3P2'",
													"    },",
													"    {",
													"        test: 'Correct Postcode & GP',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&address-postcode=P1 3PP&general-practitioner=Y00007'",
													"    },",
													"    {",
													"        test: 'Incorrect Postcode & Correct GP',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&address-postcode=P1 3P1&general-practitioner=Y00007'",
													"    },",
													"]);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "aaefc235-7030-4d0a-9a0f-3a7ff0b2605d",
												"exec": [
													"let testScenarios = pm.variables.get('testData');",
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"testScenarios.forEach(scenario => {",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + scenario.query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, res) {",
													"        pm.expect(res.code).to.equal(200, 'invalid status code returned');",
													"",
													"",
													"        if (scenario.test.includes('Incorrect')) {",
													"            pm.test(scenario.test + \" Returns 0 Patients\", () => {",
													"                pm.expect(res.json().total).to.equal(0);",
													"                pm.expect(res.json().entry).to.be.undefined;",
													"            })",
													"",
													"        } else {",
													"            pm.test(scenario.test + \" Returns Patient 5900006433\", () => {",
													"                pm.expect(res.json().entry[0].resource.id).to.equal('5900006433');",
													"            })",
													"        }",
													"    });",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}",
											"host": [
												"{{environment}}"
											]
										},
										"description": "NHS Number: 5900006433\n\n\nValidate that simple search takes into account address-postcode, when performing a search so that;\n- Simple search which includes postcode where all query parameters match a patient then the Patients record is returned\n- Simple search which includes postcode where all query parameters apart from postcode matches a patient record then No Patient is returned\n- Simple search which includes general-practitioner and postcode where all query parameters match a patient then the Patients record is returned\n- Simple search which includes general-practitioner and postcode where all query parameters apart from postcode matches a patient record then No Patient is returned"
									},
									"response": []
								},
								{
									"name": "Simple Search - GP Matching",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "433b9bd4-0883-45d9-b341-100a0743f72d",
												"exec": [
													"pm.variables.set(\"testData\", testData = [",
													"    {",
													"        test: 'No GP',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01'",
													"    },",
													"    {",
													"        test: 'Correct GP',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&general-practitioner=Y00007'",
													"    },",
													"    {",
													"        test: 'Incorrect GP',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&general-practitioner=Y00001'",
													"    },",
													"    {",
													"        test: 'Incorrect GP & correct Postcode',",
													"        query: '/Patient?family=muck&gender=female&birthdate=2000-01-01&address-postcode=P1 3PP&general-practitioner=Y00001'",
													"    },",
													"]);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "85318ac7-e861-4866-8260-898d9b9f34e7",
												"exec": [
													"let testScenarios = pm.variables.get('testData');",
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"testScenarios.forEach(scenario => {",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + scenario.query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, res) {",
													"        pm.expect(res.code).to.equal(200, 'invalid status code returned');",
													"",
													"",
													"        if (scenario.test.includes('Incorrect')) {",
													"            pm.test(scenario.test + \" Returns 0 Patients\", () => {",
													"                pm.expect(res.json().total).to.equal(0);",
													"                pm.expect(res.json().entry).to.be.undefined;",
													"            })",
													"",
													"        } else {",
													"            pm.test(scenario.test + \" Returns Patient 5900006433\", () => {",
													"                pm.expect(res.json().entry[0].resource.id).to.equal('5900006433');",
													"            })",
													"        }",
													"    });",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}",
											"host": [
												"{{environment}}"
											]
										},
										"description": "NHS Number: 5900006433\n\nValidate that simple search takes into account general-practitioner, when performing a search so that;  \n- Simple search which includes general-practitioner where all query parameters match a patient then the Patients record is returned\n- Simple search which includes general-practitioner where all query parameters apart from postcode matches a patient record then No Patient is returned\n- Simple search which includes general-practitioner and postcode where all query parameters apart from general-practitioner matches a patient record then No Patient is returned"
									},
									"response": []
								},
								{
									"name": "Simple Search - Sensitive Patient",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"pm.variables.set(\"s-flagged\", true);",
													"",
													"pm.variables.set(\"family\", \"Middleton\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2000-01-01\");",
													"",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"pm.variables.set(\"prefix\", \"Baroness\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"pm.variables.set(\"given\", [\"Cynthia\",\"Cindy\"]);",
													"pm.variables.set(\"suffix\", [\"Brnss\"]);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-31\");",
													"pm.variables.set(\"patientId\", \"5900018512\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"deceasedDateTime\", \"2009-05-01\");",
													"pm.variables.set(\"security.code\", \"R\");"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"pm.variables.set(\"s-flagged\", false);",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "general-practitioner",
													"value": "Y0001",
													"disabled": true
												}
											]
										},
										"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Dame\" = PDS Fhir \"Dame\"\n* suffix\n* nameUse - specifically Spine nameType \"Usual name\" = PDS Fhir nameUse \"usual\"\n* namePeriodStart\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - specifically Spine addressType \"usual\" = PDS Fhir addresUse \"home\"\n* postCode\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\n* telecomUse - specifically Spine telecomUse \"home\" = PDS Fhir telecomUse \"home\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient"
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Historic Search",
							"item": [
								{
									"name": "Historic Search - search with wildcarded Historic family name",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"historicFamily\", \"Po\\*\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2009-02-01\");",
													"",
													"/*set variables for checking mapping*/",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"family\", \"Name\");",
													"pm.variables.set(\"given\", [\"Current\"]);",
													"pm.variables.set(\"suffix\",  undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NK\");",
													"pm.variables.set(\"patientId\", \"5900015505\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"",
													"/*check that the Search score < 1*/",
													"pm.test(\"Search score is returned as < 1\", function () {",
													"    pm.expect(response.entry[0].search.score).to.be.below(1);",
													"    }",
													");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{historicFamily}}&gender={{gender}}&birthdate={{birthdate}}&_history=true",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{historicFamily}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "_history",
													"value": "true"
												}
											]
										},
										"description": "- Historic search using a wildcarded historic 'family' name will return the patient with current name.\n- Search score shall always result in < 1 as wildcards have been used."
									},
									"response": []
								},
								{
									"name": "Historic Search - search with wildcarded Historic given name",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"historicGiven\", \"Hi\\*\");",
													"pm.variables.set(\"family\", \"Name*\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2009-02-01\");",
													"",
													"/*set variables for checking mapping*/",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"family\", \"Name\");",
													"pm.variables.set(\"given\", [\"Current\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NK\");",
													"pm.variables.set(\"patientId\", \"5900015505\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"/*check that the Search score < 1*/",
													"pm.test(\"Search score is returned as < 1\", function () {",
													"    pm.expect(response.entry[0].search.score).to.be.below(1);",
													"    }",
													");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?given={{historicGiven}}&gender={{gender}}&birthdate={{birthdate}}&_history=true&family={{family}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "given",
													"value": "{{historicGiven}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "_history",
													"value": "true"
												},
												{
													"key": "family",
													"value": "{{family}}"
												}
											]
										},
										"description": "- Historic search using a wildcarded historic 'given' name will return the patient with current 'family' name.\n- Search score shall always result in < 1 as wildcards have been used."
									},
									"response": []
								},
								{
									"name": "Historic Search - search with wildcarded Historic given and historic name",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"historicGiven\", \"Hi\\*\");",
													"pm.variables.set(\"historicFamily\", \"Po\\*\");",
													"pm.variables.set(\"family\", \"Name*\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2009-02-01\");",
													"",
													"/*set variables for checking mapping*/",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"family\", \"Name\");",
													"pm.variables.set(\"given\", [\"Current\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NK\");",
													"pm.variables.set(\"patientId\", \"5900015505\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"/*check that the Search score < 1*/",
													"pm.test(\"Search score is returned as < 1\", function () {",
													"    pm.expect(response.entry[0].search.score).to.be.below(1);",
													"    }",
													");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?given={{historicGiven}}&gender={{gender}}&birthdate={{birthdate}}&_history=true&family={{historicFamily}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "given",
													"value": "{{historicGiven}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "_history",
													"value": "true"
												},
												{
													"key": "family",
													"value": "{{historicFamily}}"
												}
											]
										},
										"description": "- Historic search using a wildcarded historic 'given' and 'family' name will return the patient with current 'family' name.\n- Search score shall always result in < 1 as wildcards have been used."
									},
									"response": []
								},
								{
									"name": "Historic Search - search with non wildarded Historic family name",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"historicFamily\", \"Postcode\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2009-02-01\");",
													"",
													"/*set variables for checking mapping*/",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"family\", \"Name\");",
													"pm.variables.set(\"given\", [\"Current\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NK\");",
													"pm.variables.set(\"patientId\", \"5900015505\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"/*check that the Search score = 1*/",
													"pm.test(\"Search score is returned as = 1\", function () {",
													"    pm.expect(response.entry[0].search.score).to.be.eql(1);",
													"    }",
													");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{historicFamily}}&gender={{gender}}&birthdate={{birthdate}}&_history=true",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{historicFamily}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "_history",
													"value": "true"
												}
											]
										},
										"description": "- Historic search using a non wildcarded historic 'family' name will return the patient with current 'family' name.\n- Search score shall 1 as we should get an exact match."
									},
									"response": []
								},
								{
									"name": "Historic Search - search with non wildarded Historic given name",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"historicGiven\", \"Historic\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2009-02-01\");",
													"",
													"/*set variables for checking mapping*/",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"family\", \"Name\");",
													"pm.variables.set(\"given\", [\"Current\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NK\");",
													"pm.variables.set(\"patientId\", \"5900015505\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"/*check that the Search score < 1*/",
													"pm.test(\"Search score is returned as < 1\", function () {",
													"    pm.expect(response.entry[0].search.score).to.be.below(1);",
													"    }",
													");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&_history=true&given={{historicGiven}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "{{family}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "_history",
													"value": "true"
												},
												{
													"key": "given",
													"value": "{{historicGiven}}"
												}
											]
										},
										"description": "- Historic search using a non wildcarded historic 'given' name will return the patient with current name.\n- Search score shall 1 as we should get an exact match."
									},
									"response": []
								},
								{
									"name": "Historic Search - search with non wildcarded Historic given and family name",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"/*set variables for test*/",
													"",
													"pm.variables.set(\"historicGiven\", \"Historic\");",
													"pm.variables.set(\"historicFamily\", \"Postcode\");",
													"pm.variables.set(\"family\", \"Name*\");",
													"pm.variables.set(\"gender\", \"female\");",
													"pm.variables.set(\"birthdate\", \"2009-02-01\");",
													"",
													"/*set variables for checking mapping*/",
													"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
													"",
													"pm.variables.set(\"prefix\", \"Ms\");",
													"pm.variables.set(\"nameType\", \"Usual name\");",
													"pm.variables.set(\"addressType\", \"usual\");",
													"pm.variables.set(\"telecomType\", \"telephone\");",
													"pm.variables.set(\"telecomUse\", \"home\");",
													"",
													"pm.variables.set(\"family\", \"Name\");",
													"pm.variables.set(\"given\", [\"Current\"]);",
													"pm.variables.set(\"suffix\", undefined);",
													"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"addressLine\",JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\"]));",
													"pm.variables.set(\"addressPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"postalCode\", \"BD2 2NK\");",
													"pm.variables.set(\"patientId\", \"5900015505\");",
													"pm.variables.set(\"metaVersionId\", \"7\");",
													"pm.variables.set(\"resourceType\", \"Patient\");",
													"pm.variables.set(\"telecomPeriodStart\", \"2020-03-02\");",
													"pm.variables.set(\"telecomValue\", \"07900000000\");",
													"pm.variables.set(\"deceasedDateTime\", \"\");",
													"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"var response = pm.response.json();",
													"",
													"// Apply Common Mapping Tests",
													"//======================================",
													"eval(pm.globals.get(\"checkSearchMappings\"))();",
													"",
													"/*check that the Search score = 1*/",
													"pm.test(\"Search score is returned as = 1\", function () {",
													"    pm.expect(response.entry[0].search.score).to.be.eql(1);",
													"    }",
													");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?given={{historicGiven}}&gender={{gender}}&birthdate={{birthdate}}&_history=true&family={{historicFamily}}",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "given",
													"value": "{{historicGiven}}"
												},
												{
													"key": "gender",
													"value": "{{gender}}"
												},
												{
													"key": "birthdate",
													"value": "{{birthdate}}"
												},
												{
													"key": "_history",
													"value": "true"
												},
												{
													"key": "family",
													"value": "{{historicFamily}}"
												}
											]
										},
										"description": "- Historic search using a non wildcarded historic 'given' name will return the patient with current name.\n- Search score shall 1 as we should get an exact match."
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Advanced Search",
							"item": [
								{
									"name": "date range tests",
									"item": [
										{
											"name": "DOD Range tests",
											"item": [
												{
													"name": "Date of Birth Date Range check - DOD between 2 dates",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"dateOfDeathRange\", \"ge2014-01-01&death-date=le2015-04-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"/*set variables for checking mapping*/",
																	"",
																	"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
																	"",
																	"pm.variables.set(\"prefix\", \"Dame\");",
																	"pm.variables.set(\"nameType\", \"Usual name\");",
																	"pm.variables.set(\"addressType\", \"usual\");",
																	"pm.variables.set(\"telecomType\", \"telephone\");",
																	"pm.variables.set(\"telecomUse\", \"home\");",
																	"",
																	"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
																	"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
																	"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
																	"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
																	"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
																	"pm.variables.set(\"patientId\", \"5900009068\");",
																	"pm.variables.set(\"metaVersionId\", \"15\");",
																	"pm.variables.set(\"resourceType\", \"Patient\");",
																	"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"telecomValue\", \"07900000000\");",
																	"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
																	"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
																	"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
																	"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"// Apply Common Mapping Tests",
																	"//======================================",
																	"eval(pm.globals.get(\"checkSearchMappings\"))();"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&death-date={{dateOfDeathRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdate}}"
																},
																{
																	"key": "death-date",
																	"value": "{{dateOfDeathRange}}"
																}
															]
														},
														"description": "Where a DOD falls between 2 date ranges, the Patient is found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOD equals upper date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"dateOfDeathRange\", \"ge2014-01-01&death-date=le2015-03-02\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"/*set variables for checking mapping*/",
																	"",
																	"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
																	"",
																	"pm.variables.set(\"prefix\", \"Dame\");",
																	"pm.variables.set(\"nameType\", \"Usual name\");",
																	"pm.variables.set(\"addressType\", \"usual\");",
																	"pm.variables.set(\"telecomType\", \"telephone\");",
																	"pm.variables.set(\"telecomUse\", \"home\");",
																	"",
																	"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
																	"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
																	"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
																	"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
																	"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
																	"pm.variables.set(\"patientId\", \"5900009068\");",
																	"pm.variables.set(\"metaVersionId\", \"15\");",
																	"pm.variables.set(\"resourceType\", \"Patient\");",
																	"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"telecomValue\", \"07900000000\");",
																	"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
																	"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
																	"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
																	"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"// Apply Common Mapping Tests",
																	"//======================================",
																	"eval(pm.globals.get(\"checkSearchMappings\"))();"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&death-date={{dateOfDeathRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdate}}"
																},
																{
																	"key": "death-date",
																	"value": "{{dateOfDeathRange}}"
																}
															]
														},
														"description": "Where a DOB equals the upper date of a date range, the Patient is found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOD equals lower date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"dateOfDeathRange\", \"ge2015-03-02&death-date=le2015-04-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"/*set variables for checking mapping*/",
																	"",
																	"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
																	"",
																	"pm.variables.set(\"prefix\", \"Dame\");",
																	"pm.variables.set(\"nameType\", \"Usual name\");",
																	"pm.variables.set(\"addressType\", \"usual\");",
																	"pm.variables.set(\"telecomType\", \"telephone\");",
																	"pm.variables.set(\"telecomUse\", \"home\");",
																	"",
																	"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
																	"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
																	"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
																	"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
																	"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
																	"pm.variables.set(\"patientId\", \"5900009068\");",
																	"pm.variables.set(\"metaVersionId\", \"15\");",
																	"pm.variables.set(\"resourceType\", \"Patient\");",
																	"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"telecomValue\", \"07900000000\");",
																	"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
																	"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
																	"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
																	"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"// Apply Common Mapping Tests",
																	"//======================================",
																	"eval(pm.globals.get(\"checkSearchMappings\"))();"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&death-date={{dateOfDeathRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdate}}"
																},
																{
																	"key": "death-date",
																	"value": "{{dateOfDeathRange}}"
																}
															]
														},
														"description": "Where a DOB equals the lower date of a date range, the Patient is found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOD below lower date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"dateOfDeathRange\", \"ge2015-03-03&death-date=le2015-04-01\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2009-01-01&birthdate=le2011-01-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"pm.test(\"Check that no Patient returned\", function () {",
																	"    pm.response.to.have.status(200);",
																	"    pm.expect(response.entry).to.eql(undefined);",
																	"    pm.expect(response.resourceType).to.eql(\"Bundle\");",
																	"    pm.expect(response.total).to.eql(0);",
																	"    pm.expect(response.type).to.eql(\"searchset\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}&death-date={{dateOfDeathRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																},
																{
																	"key": "death-date",
																	"value": "{{dateOfDeathRange}}"
																}
															]
														},
														"description": "Where a DOB is below the lower date of DOB date range, the Patient should not be found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOD above upper date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"dateOfDeathRange\", \"ge2014-01-01&death-date=le2015-03-01\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2009-01-01&birthdate=le2011-01-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"pm.test(\"Check that no Patient returned\", function () {",
																	"    pm.response.to.have.status(200);",
																	"    pm.expect(response.entry).to.eql(undefined);",
																	"    pm.expect(response.resourceType).to.eql(\"Bundle\");",
																	"    pm.expect(response.total).to.eql(0);",
																	"    pm.expect(response.type).to.eql(\"searchset\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}&death-date={{dateOfDeathRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																},
																{
																	"key": "death-date",
																	"value": "{{dateOfDeathRange}}"
																}
															]
														},
														"description": "Where a DOB is above the upper date of DOB date range, the Patient should not be found"
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "DOB Range tests",
											"item": [
												{
													"name": "Date of Birth Date Range check - DOB between 2 dates",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2009-01-01&birthdate=le2011-01-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"/*set variables for checking mapping*/",
																	"",
																	"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
																	"",
																	"pm.variables.set(\"prefix\", \"Dame\");",
																	"pm.variables.set(\"nameType\", \"Usual name\");",
																	"pm.variables.set(\"addressType\", \"usual\");",
																	"pm.variables.set(\"telecomType\", \"telephone\");",
																	"pm.variables.set(\"telecomUse\", \"home\");",
																	"",
																	"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
																	"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
																	"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
																	"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
																	"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
																	"pm.variables.set(\"patientId\", \"5900009068\");",
																	"pm.variables.set(\"metaVersionId\", \"15\");",
																	"pm.variables.set(\"resourceType\", \"Patient\");",
																	"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"telecomValue\", \"07900000000\");",
																	"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
																	"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
																	"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
																	"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"// Apply Common Mapping Tests",
																	"//======================================",
																	"eval(pm.globals.get(\"checkSearchMappings\"))();"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																}
															]
														},
														"description": "Where a DOB falls between 2 date ranges, the Patient is found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOB equals lower date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2010-01-01&birthdate=le2011-01-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"/*set variables for checking mapping*/",
																	"",
																	"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
																	"",
																	"pm.variables.set(\"prefix\", \"Dame\");",
																	"pm.variables.set(\"nameType\", \"Usual name\");",
																	"pm.variables.set(\"addressType\", \"usual\");",
																	"pm.variables.set(\"telecomType\", \"telephone\");",
																	"pm.variables.set(\"telecomUse\", \"home\");",
																	"",
																	"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
																	"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
																	"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
																	"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
																	"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
																	"pm.variables.set(\"patientId\", \"5900009068\");",
																	"pm.variables.set(\"metaVersionId\", \"15\");",
																	"pm.variables.set(\"resourceType\", \"Patient\");",
																	"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"telecomValue\", \"07900000000\");",
																	"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
																	"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
																	"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
																	"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"// Apply Common Mapping Tests",
																	"//======================================",
																	"eval(pm.globals.get(\"checkSearchMappings\"))();"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																}
															]
														},
														"description": "Where a DOB equals the lower date of a date range, the Patient is found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOB equals upper date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2009-01-01&birthdate=le2010-01-01\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"/*set variables for checking mapping*/",
																	"",
																	"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
																	"",
																	"pm.variables.set(\"prefix\", \"Dame\");",
																	"pm.variables.set(\"nameType\", \"Usual name\");",
																	"pm.variables.set(\"addressType\", \"usual\");",
																	"pm.variables.set(\"telecomType\", \"telephone\");",
																	"pm.variables.set(\"telecomUse\", \"home\");",
																	"",
																	"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
																	"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
																	"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
																	"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
																	"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
																	"pm.variables.set(\"patientId\", \"5900009068\");",
																	"pm.variables.set(\"metaVersionId\", \"15\");",
																	"pm.variables.set(\"resourceType\", \"Patient\");",
																	"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
																	"pm.variables.set(\"telecomValue\", \"07900000000\");",
																	"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
																	"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
																	"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
																	"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"// Apply Common Mapping Tests",
																	"//======================================",
																	"eval(pm.globals.get(\"checkSearchMappings\"))();"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																}
															]
														},
														"description": "Where a DOB equals the upper date of a date range, the Patient is found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOB below lower date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2010-01-02&birthdate=le2011-01-02\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"pm.test(\"Check that no Patient returned\", function () {",
																	"    pm.response.to.have.status(200);",
																	"    pm.expect(response.entry).to.eql(undefined);",
																	"    pm.expect(response.resourceType).to.eql(\"Bundle\");",
																	"    pm.expect(response.total).to.eql(0);",
																	"    pm.expect(response.type).to.eql(\"searchset\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																}
															]
														},
														"description": "Where a DOB is below the lower date of DOB date range, the Patient should not be found"
													},
													"response": []
												},
												{
													"name": "Date of Birth Date Range check - DOB above upper date",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
																"exec": [
																	"/*set variables for test*/",
																	"",
																	"pm.variables.set(\"family\", \"Mapping\");",
																	"pm.variables.set(\"gender\", \"female\");",
																	"pm.variables.set(\"birthdateRange\", \"ge2009-01-01&birthdate=le2009-12-31\");",
																	"pm.variables.set(\"birthdate\", \"2010-01-01\");",
																	"",
																	"//5900009068",
																	"",
																	""
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
																"exec": [
																	"var response = pm.response.json();",
																	"",
																	"pm.test(\"Check that no Patient returned\", function () {",
																	"    pm.response.to.have.status(200);",
																	"    pm.expect(response.entry).to.eql(undefined);",
																	"    pm.expect(response.resourceType).to.eql(\"Bundle\");",
																	"    pm.expect(response.total).to.eql(0);",
																	"    pm.expect(response.type).to.eql(\"searchset\");",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdateRange}}",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "family",
																	"value": "{{family}}"
																},
																{
																	"key": "gender",
																	"value": "{{gender}}"
																},
																{
																	"key": "birthdate",
																	"value": "{{birthdateRange}}"
																}
															]
														},
														"description": "Where a DOB is above the upper date of DOB date range, the Patient should not be found"
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "exact-match",
									"item": [
										{
											"name": "All patients are returned when search query matches many patients all with a score of 1",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"var response = JSON.parse(responseBody);",
															"const util = eval(globals.patient);",
															"",
															"",
															"pm.test(\"Returns status code 200 OK\", () => {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Returns multiple patients\", () => {",
															"    pm.expect(util.getTotalNumberOfPatients()).to.be.above(1);",
															"})",
															"",
															"pm.test(\"Returns all patients with a score of 1\", () => {",
															"    let scores = util.getScores();",
															"    scores.forEach(score => {",
															"        pm.expect(score).to.equal(1);        ",
															"    });",
															"})"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_exact-match=true&birthdate=2020-02-11&family=length&gender=male",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_exact-match",
															"value": "true"
														},
														{
															"key": "birthdate",
															"value": "2020-02-11"
														},
														{
															"key": "family",
															"value": "length"
														},
														{
															"key": "gender",
															"value": "male"
														}
													]
												},
												"description": "Setting *exact_match* to true returns all patients from a search which matched multiple patients all with a score =1"
											},
											"response": []
										},
										{
											"name": "Only patients with a score of 1 are returned when search query matches many patients",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "02a77542-f342-44b5-9609-c9a77ebd7cfe",
														"exec": [
															"var response = JSON.parse(responseBody);",
															"const util = eval(globals.patient);",
															"",
															"pm.test(\"Returns status code 200 OK\", () => {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Returns 1 patient\", () => {",
															"    pm.expect(util.getTotalNumberOfPatients()).to.equal(1);",
															"})",
															"",
															"pm.test(\"Returns a patient with a score of 1\", () => {",
															"    let scores = util.getScores();",
															"    pm.expect(scores).to.have.lengthOf(1);",
															"    pm.expect(scores).to.be.an('array').that.includes(1);",
															"})",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_exact-match=true&birthdate=2015-12-15&family=Stephen&_fuzzy-match=true&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_exact-match",
															"value": "true"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												},
												"description": "Setting *exact_match* to true returns only those patients with a score of 1 from a search which matched multiple patients with scores >0 and <=1"
											},
											"response": []
										},
										{
											"name": "0 patients are returned when search query matches 0 patients with a score of 1",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "02a77542-f342-44b5-9609-c9a77ebd7cfe",
														"exec": [
															"var response = JSON.parse(responseBody);",
															"const util = eval(globals.patient);",
															"",
															"pm.test(\"Returns status code 200 OK\", () => {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Returns 0 patient\", () => {",
															"    pm.expect(util.getTotalNumberOfPatients()).to.equal(0);",
															"});",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_exact-match=true&birthdate=ge2020-02-11&family=len*&gender=male",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_exact-match",
															"value": "true"
														},
														{
															"key": "birthdate",
															"value": "ge2020-02-11"
														},
														{
															"key": "family",
															"value": "len*"
														},
														{
															"key": "gender",
															"value": "male"
														}
													]
												},
												"description": "Setting *exact_match* to true returns 0 patients from a search which matched multiple patients all with a score <1"
											},
											"response": [
												{
													"name": "0 patients returned respose",
													"originalRequest": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "200000000610"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "1234567890"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "1234567890"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?_exact-match=true&birthdate=ge2020-02-11&family=len*&gender=male",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "_exact-match",
																	"value": "true"
																},
																{
																	"key": "birthdate",
																	"value": "ge2020-02-11"
																},
																{
																	"key": "family",
																	"value": "len*"
																},
																{
																	"key": "gender",
																	"value": "male"
																}
															]
														}
													},
													"status": "OK",
													"code": 200,
													"_postman_previewlanguage": "json",
													"header": [
														{
															"key": "Server",
															"value": "nginx"
														},
														{
															"key": "Date",
															"value": "Thu, 27 Feb 2020 09:01:42 GMT"
														},
														{
															"key": "Content-Type",
															"value": "application/json"
														},
														{
															"key": "Content-Length",
															"value": "123"
														},
														{
															"key": "Connection",
															"value": "keep-alive"
														},
														{
															"key": "Etag",
															"value": "\"484cd9e73bb551f9156572bd7c3379a45d286549\""
														}
													],
													"cookie": [],
													"body": "{\n    \"entry\": [],\n    \"resourceType\": \"Bundle\",\n    \"timestamp\": 1582794102,\n    \"total\": 0,\n    \"type\": \"searchset\"\n}"
												}
											]
										},
										{
											"name": "Exact match as false returns all matched patients regardless of score",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"var response = JSON.parse(responseBody);",
															"const util = eval(globals.patient);",
															"var scores = util.getScores();    ",
															"",
															"pm.test(\"Returns status code 200 OK\", () => {",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test(\"Returns 3 patients in total\", () => {",
															"    pm.expect(util.getTotalNumberOfPatients()).to.equal(3);",
															"});",
															"",
															"pm.test(\"Returns a patient with a score of 1\", () => {",
															"    pm.expect(scores).to.be.an('array').that.includes(1);",
															"});",
															"",
															"pm.test(\"Returns a patient with a score < 1\", () => {",
															"    pm.expect(scores).to.be.an('array').that.includes(1);",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "1062c549-dccc-489f-a369-c16da00a1232",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?birthdate=2015-12-15&family=Stephen&_fuzzy-match=true&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												},
												"description": "Setting *exact_match* to false returns all patients from a search matching multiple patients with scores > 0 and <=1"
											},
											"response": []
										}
									],
									"description": "Every result includes a score from 0 to 1.\n\nScores less than 1 can happen when parameters supplied do not exactly match the values on the patient record. Results are sorted best-first. You can request to only return exact matches (score = 1) using the _exact-match parameter.",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "67f97a66-b476-4b07-a989-a8ec489882c4",
												"type": "text/javascript",
												"exec": [
													""
												]
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "49c982ec-16a1-4e94-9191-4ab47b83cd5b",
												"type": "text/javascript",
												"exec": [
													""
												]
											}
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "fuzzy-match",
									"item": [
										{
											"name": "Mismatching General Practitioner reduces match score against search without General Practitioner",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "fffa160e-e723-4537-8282-3831893f5852",
														"exec": [
															"const nhsNumber = '5900002365';",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + \"/Patient?_fuzzy-match=true&family=Stephen&birthdate=2015-12-15&given=Fuzzy\",",
															"    method: 'GET',",
															"    header: {",
															"        asidHeader,",
															"        sessionURIDHeader,",
															"        identityUUIDHeader",
															"    }",
															"}, function (err, res) {",
															"    console.log(\"Pre-request Request: \" + JSON.stringify(res.json()));",
															"    pm.expect(res.json().entry[0].resource.id).to.equal(nhsNumber);",
															"    let initialScore = res.json().entry[0].search.score;",
															"    pm.variables.set(\"nhsNumber\", nhsNumber);",
															"    pm.variables.set(\"initialScore\", initialScore);",
															"    console.log('NHS Number:' + nhsNumber + \" Score: \" + initialScore);",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "93e28be6-475d-48b0-891e-fb16474ff575",
														"exec": [
															"eval(pm.globals.get(\"patient\"));",
															"let response = pm.response.json();",
															"let newScore = response.entry[0].search.score;",
															"console.log(\"New score: \" + newScore);",
															"",
															"pm.test(\"Returns status code 200\", () => {",
															"    pm.response.to.have.status(200);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 5900002365\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('5900002365');",
															"});",
															"",
															"pm.test(\"Patient matching score has decreased\", () => {",
															"    pm.expect(pm.variables.get(\"initialScore\")).to.be.above(newScore);",
															"});",
															"",
															"pm.test(\"Patient matching score is a valid score\"), () => {",
															"    pm.expect(newScore).to.be.atLeast(0);",
															"    pm.expect(newScore).to.be.atMost(1);",
															"};"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=Stephen&birthdate=2015-12-15&given=Fuzzy&general-practitioner=A200",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														},
														{
															"key": "general-practitioner",
															"value": "A200"
														}
													]
												},
												"description": "Validates a mismatching General Practitioner reduces the amtch score against the same search without General Practitioner"
											},
											"response": []
										},
										{
											"name": "Fuzzy Search handles transposed family names",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "fffa160e-e723-4537-8282-3831893f5852",
														"exec": [
															"// Send request with _fuzzy-match=false to make sure no patients are returned",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + '/Patient?_fuzzy-match=false&family=James&birthdate=2000-01-01&given=David&gender=male',",
															"    method: 'GET',",
															"    header: {",
															"            'NHSD-ASID': pm.environment.get(\"from_asid\"),",
															"            'NHSD-Session-URID': pm.environment.get(\"role_id\"),",
															"            'NHSD-Identity-UUID': pm.environment.get(\"user_id\")",
															"    }",
															"}, function (err, res) {",
															"    pm.test('@Before: fuzzy-match set to false returns 0 patients', () => {",
															"        console.log('@Before Request: ' + JSON.stringify(res.json()));",
															"        pm.expect(res.json().total).to.equal(0);",
															"    });",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "93e28be6-475d-48b0-891e-fb16474ff575",
														"exec": [
															"var response = pm.response.json().entry[0];",
															"",
															"pm.test('@Ater: fuzzy-match set to true returns status code 200', () =>{",
															"    pm.response.to.have.status(200);",
															"});",
															"",
															"pm.test('Returns 1 patient', () => {",
															"    pm.expect(pm.response.json().total).to.equal(1);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 5900004171\", () =>{",
															"   pm.expect(response.resource.id).to.equal('5900004171');",
															"});",
															"",
															"pm.test(\"Returns patient with family name 'David'\", () => {",
															"    pm.expect(response.resource.name[0].family).to.equal(\"David\");",
															"});",
															"",
															"pm.test(\"Returns patient with given name 'James'\", () => {",
															"    pm.expect(response.resource.name[0].given).to.contain('James');",
															"});",
															"",
															"pm.test(\"Returns patient with birthdate=2000-01-01\", () =>{",
															"    pm.expect(response.resource.birthDate).to.equal('2000-01-01');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=David&gender=male",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "James"
														},
														{
															"key": "birthdate",
															"value": "2000-01-01"
														},
														{
															"key": "given",
															"value": "David"
														},
														{
															"key": "gender",
															"value": "male"
														}
													]
												},
												"description": "If no patients are matched, using fuzzy-match a check is performed for transposed names such as Adam Thomas and Thomas Adam (family and given names). This test asserts that when doing a fuzzy-match search, patients with transposed names are successfully matched"
											},
											"response": []
										},
										{
											"name": "Mismatching Date of Death reduces match score against same search without Date of Death",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "fffa160e-e723-4537-8282-3831893f5852",
														"exec": [
															"const nhsNumber = '5900002365';",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + \"/Patient?_fuzzy-match=true&family=Stephen&birthdate=2015-12-15&given=Fuzzy\",",
															"    method: 'GET',",
															"    header: {",
															"        asidHeader,",
															"        sessionURIDHeader,",
															"        identityUUIDHeader",
															"    }",
															"}, function (err, res) {",
															"    console.log(\"Pre-request Request: \" + JSON.stringify(res.json()));",
															"    pm.expect(res.json().entry[0].resource.id).to.equal(nhsNumber);",
															"    let initialScore = res.json().entry[0].search.score;",
															"    pm.variables.set(\"nhsNumber\", nhsNumber);",
															"    pm.variables.set(\"initialScore\", initialScore);",
															"    console.log('NHS Number:' + nhsNumber + \" Score: \" + initialScore);",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "93e28be6-475d-48b0-891e-fb16474ff575",
														"exec": [
															"eval(pm.globals.get(\"patient\"));",
															"let response = pm.response.json();",
															"let initialScore = pm.variables.get(\"initialScore\");",
															"let newScore = response.entry[0].search.score;",
															"console.log(\"New score: \" + newScore);",
															"",
															"",
															"pm.test(\"Returns status code 200\", () => {",
															"    pm.response.to.have.status(200);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 9691183994\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('9691183994');",
															"});",
															"",
															"pm.test(\"Patient matching score has decreased\", () => {",
															"    pm.expect(initialScore).to.be.above(newScore);",
															"});",
															"",
															"pm.test(\"Patient matching score is a valid score\"), () => {",
															"    pm.expect(newScore).to.be.atLeast(0);",
															"    pm.expect(newScore).to.be.atMost(1);",
															"};"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&death-date=2020-02-01&family=length&birthdate=2020-02-11&given=Selena",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "death-date",
															"value": "2020-02-01"
														},
														{
															"key": "family",
															"value": "length"
														},
														{
															"key": "birthdate",
															"value": "2020-02-11"
														},
														{
															"key": "given",
															"value": "Selena"
														}
													]
												},
												"description": "Validate that a fuzzy-search using a mismatching date of death reduces the match score against the same search without a date of death"
											},
											"response": []
										},
										{
											"name": "Fuzzy Search handles family name homophone",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "fffa160e-e723-4537-8282-3831893f5852",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "93e28be6-475d-48b0-891e-fb16474ff575",
														"exec": [
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
															"const patientUtil = eval(pm.globals.get(\"patient\"));",
															"var response = pm.response.json();",
															"",
															"assertThat.statusCodeIs(200);",
															"",
															"pm.test(\"Returns 3 patients\", () =>{",
															"    pm.expect(patientUtil.getTotalNumberOfPatients()).to.eql(3);",
															"});",
															"",
															"pm.test(\"Returns both patient Steven and Stephen\", () => {",
															"    let names = getFamilyNameOfAllPatients();",
															"    pm.expect(names).to.contain(\"Steven\");",
															"    pm.expect(names).to.contain(\"Stephen\");",
															"    ",
															"});",
															"",
															"",
															"",
															"// Retrieves the family name of all patients",
															"function getFamilyNameOfAllPatients() {",
															"    var names = [];",
															"",
															"    for(i = 0; i < response.entry.length; i++) {",
															"        names.push(response.entry[i].resource.name[0].family);",
															"    }",
															"",
															"    return names;",
															"};"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=Stephen&birthdate=2015-12-15&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												}
											},
											"response": []
										},
										{
											"name": "Fuzzy search  returns valid response when using minimum search plus non mandatory",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "6ccd7a09-442e-4580-b61b-456191dccf08",
														"exec": [
															"pm.variables.set('params', params = [",
															"   ",
															"    // Requests using just mandatory parameters required for a fuzzy search",
															"    { parameter: \"DOB, Family & Given\", query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=leng&given=Selena', expected: 200 },",
															"    { parameter: \"Gender, DOB, Family & PostCode\", query: '/Patient?_fuzzy-match=true&gender=male&birthdate=2020-02-11&family=leng&address-postcode=DN16 6BB', expected: 200 },",
															"    { parameter: \"Gender, DOB, Given & PostCode\", query: '/Patient?_fuzzy-match=true&gender=male&birthdate=2020-02-11&address-postcode=DN16&given=Selena', expected: 200 },",
															"",
															"    // Requests using bpth mandatory and extra valid parameters for a fuzzy search",
															"    { parameter: \"DOB, Family, Given & Postcode\", query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=len&address-postcode=DN16&given=Selena', expected: 200 },",
															"    { parameter: \"Gender, DOB, Family, PostCode & Given\", query: '/Patient?_fuzzy-match=true&gender=male&birthdate=2020-02-11&address-postcode=DN16&given=Selena&family=len', expected: 200 }",
															"]);"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "7027517e-3473-47d2-9a95-a7fe97876beb",
														"exec": [
															"var response = pm.response.json();",
															"",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"let params = pm.variables.get('params');",
															"",
															"",
															"params.forEach(p => {",
															"    pm.sendRequest({",
															"        url: pm.environment.get(\"environment\") + p.query,",
															"        method: 'GET',",
															"        header: {",
															"            asidHeader,",
															"            sessionURIDHeader,",
															"            identityUUIDHeader",
															"        }",
															"    }, function (err, res) {",
															"        console.log(\"Response for \" + p.parameter, res.json());",
															"",
															"        pm.test(\"Returns Status code \" + p.expected + \" for parameters \" + p.parameter, function () {",
															"            pm.expect(res.code).to.equal(p.expected);",
															"        });",
															"",
															"        if (p.expected === 400) {",
															"            pm.test(\"Returns INVALID_COMBINATION when using parameters \" + p.parameter, () => {",
															"                pm.expect(res.json().issue[0].details.coding[0].code).to.equal('FUZZY_CRITERIA_NOT_MET', 'invalid code');",
															"                pm.expect(res.json().issue[0].details.coding[0].display).to.equal('A fuzzy search was requested however the data given did not meet the fuzzy search criteria', 'invalid display message');",
															"                pm.expect(res.json().issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode', 'invalid system link');",
															"                pm.expect(res.json().issue[0].severity).to.equal('error', 'invalid severity');",
															"            });",
															"        }",
															"    });",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&birthdate=2015-12-15&given=FuzzyYYYYYY",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "FuzzyYYYYYY"
														}
													]
												},
												"description": "Validates search parameter combinations for a fuzzy search\n- Minimum parameters combinations return a 200 response\n-- given name, family name and date of birth\n-- family name, date of birth, gender and postcode\n-- given name date of birth, gender and postcode\n\n- Mandatory plus non-mandatory parameter combinations return a 200 response\n-- DOB, Family, Given & Postcode\n-- Gender, DOB, Family, PostCode & Given"
											},
											"response": []
										}
									],
									"description": "The search will perform phonetic matching on names using soundex, transpose names, and score the results. If the fields death-date or general-practitioner are provided they will be ignored in this search. This search is performed using a combination of parameters. If an invalid combination is supplied _INVALID_COMBINATION_ will be returned.\n\n- Matching common homophones, such as Smith and Smythe\n- Checking for transposed names, such as Adam Thomas and Thomas Adam\n- Phonetic matching using soundex\n\n",
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "result scoring",
									"item": [
										{
											"name": "Search matching criteria exactly returns Patient with score = 1",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"let response = pm.response.json();",
															"eval(pm.globals.get(\"assertThatUtil\"));",
															"eval(pm.globals.get(\"patient\"));",
															"",
															"assertThatUtil().statusCodeIs(200);",
															"",
															"pm.test(\"Returns 1 patient\", () =>{",
															"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(1);",
															"});",
															"",
															"pm.test(\"Returns patient with Nhs Number 5900016528\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('5900016528');",
															"})",
															"",
															"pm.test(\"Returns score which is a number\", () => {",
															"    pm.expect(response.entry[0].search.score).to.be.a('number');",
															"});",
															"",
															"pm.test(\"Returns patient with score = 1\", () => {",
															"    pm.expect(response.entry[0].search.score).to.equal(1);",
															"})"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?family=Toe&given=Mary&gender=male&birthdate=2001-10-10",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "family",
															"value": "Toe"
														},
														{
															"key": "given",
															"value": "Mary"
														},
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "2001-10-10"
														}
													]
												},
												"description": "Validate search which matches criteria exactly returns Patient with score of 1"
											},
											"response": []
										},
										{
											"name": "Simple Patient retrieval does not return a matched score",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"var response = pm.response.json();",
															"eval(pm.globals.get(\"assertThatUtil\"));",
															"eval(pm.globals.get(\"patient\"));",
															"",
															"assertThatUtil().statusCodeIs(200);",
															"",
															"pm.test(\"Returns patient without a scoring\", () =>{",
															"    pm.expect(response).to.not.have.property('search');",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient/5900016528",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														"5900016528"
													]
												},
												"description": "Validate a patient retrieve does not return a matched score"
											},
											"response": []
										},
										{
											"name": "Search matching multiple patients returns each patient with matching score between 0 and 1",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"var response = pm.response.json();",
															"eval(pm.globals.get(\"assertThatUtil\"));",
															"eval(pm.globals.get(\"patient\"));",
															"",
															"assertThatUtil().statusCodeIs(200);",
															"",
															"pm.test(\"Returns multiple patients\", () =>{",
															"    pm.expect(patient().getTotalNumberOfPatients()).to.be.above(1);",
															"})",
															"",
															"pm.test(\"Returns patients each with a score between 0 and 1\", () =>{",
															"    let scores = patient().getScores();",
															"    scores.forEach(score => {",
															"        var tmp = parseFloat(score)",
															"        pm.expect(tmp).to.be.at.least(0);",
															"        pm.expect(tmp).to.be.at.most(1);",
															"    });",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=ge2020-02-11&family=le*",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "ge2020-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														}
													]
												},
												"description": "For a wildcard based search which results in multiple patients being retured. Each patient is given a score.\n\nThis test is to validate that:\n- The score given to each patient is > 0 and < 1"
											},
											"response": []
										},
										{
											"name": "Matching score increases when being more specific with Search query parameters",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"var response = pm.response.json();",
															"let globalNhsNumber = response.entry[0].resource.id;",
															"let globalScore = response.entry[0].search.score;",
															"let highestScore = globalScore;",
															"",
															"let params = [",
															"    { parameter: \"Post Code\", query: '/Patient?gender=male&birthdate=2020-02-11&family=le*&address-postcode=DN16 3*'},",
															"    { parameter: \"Family Name\", query: '/Patient?gender=male&birthdate=2020-02-11&family=leng*&address-postcode=DN16*'},",
															"    { parameter: \"Given Name\", query: '/Patient?gender=male&birthdate=2020-02-11&family=le*&address-postcode=DN16*&given=Selena'},",
															"    { parameter: \"PostCode, Family and Given name\", query: '/Patient?gender=male&birthdate=2020-02-11&family=leng*&address-postcode=DN16 3*&given=Selena'}",
															"]",
															"",
															"params.forEach(p => {",
															"    pm.sendRequest({",
															"        url: pm.environment.get(\"environment\") + p.query,",
															"        method: 'GET',",
															"        header: {",
															"            'NHSD-ASID': pm.environment.get(\"from_asid\"),",
															"            'NHSD-Session-URID': pm.environment.get(\"role_id\"),",
															"            'NHSD-Identity-UUID': pm.environment.get(\"user_id\")",
															"        }",
															"    }, function (err, res) {",
															"        let newScore = res.json().entry[0].search.score;",
															"        ",
															"        pm.test(\"Matching score increases when being more specific with \" + p.parameter + \" query parameter(s)\", () => {",
															"            console.log(\"Response for \" + p.parameter + \": \" + JSON.stringify(res.json()));",
															"            pm.expect(globalNhsNumber).to.be.equal(res.json().entry[0].resource.id, 'not the same patient as nhs numbers are different');",
															"            pm.expect(globalScore).to.be.below(newScore);",
															"        });",
															"        ",
															"        if(p.parameter != 'PostCode, Family and Given name') {",
															"            highestScore = newScore > highestScore ? newScore : highestScore;",
															"        } else {",
															"            pm.test(\"Matching score is at it's highest when being more specific with multiple query parameters (PostCode, Family and Given name)\", () => {",
															"                pm.expect(newScore).to.be.above(highestScore);",
															"            })",
															"        }",
															"    });",
															"});"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "555cfeec-5c14-4d76-a330-a5d011ab8ee9",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=2020-02-11&family=le*&address-postcode=DN16*",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "2020-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														},
														{
															"key": "address-postcode",
															"value": "DN16*"
														}
													]
												},
												"description": "Validates that the returned patients score increases when being more specific with the following search query parameters\n- Post Code\n- Family Name\n- Given Name\n- Multiple (Post Code, Family name and Given name)"
											},
											"response": []
										},
										{
											"name": "Matching General Practitioner increases match score against the same search without General Practitioner",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"eval(pm.globals.get(\"patient\"));",
															"let response = pm.response.json();",
															"let newScore = response.entry[0].search.score;",
															"console.log(\"New score: \" + newScore);",
															"",
															"pm.test(\"Returns status code 200\", () => {",
															"    pm.response.to.have.status(200);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 9691184087\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('9691184087');",
															"});",
															"",
															"pm.test(\"Patient matching score has increased\", () => {",
															"    pm.expect(pm.variables.get(\"initialScore\")).to.be.below(newScore);",
															"});",
															"",
															"pm.test(\"Patient matching score is a valid score\"), () => {",
															"    pm.expect(newScore).to.be.atLeast(0);",
															"    pm.expect(newScore).to.be.atMost(1);",
															"};"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "555cfeec-5c14-4d76-a330-a5d011ab8ee9",
														"exec": [
															"const nhsNumber = '9691183994';",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + \"/Patient?gender=male&birthdate=2020-02-11&family=le*&address-postcode=DN16*\",",
															"    method: 'GET',",
															"    header: {",
															"        asidHeader,",
															"        sessionURIDHeader,",
															"        identityUUIDHeader",
															"    }",
															"}, function (err, res) {",
															"    console.log(\"Pre-request Request: \" + JSON.stringify(res.json()));",
															"    pm.expect(res.json().entry[0].resource.id).to.equal(nhsNumber);",
															"    let initialScore = res.json().entry[0].search.score;",
															"    pm.variables.set(\"nhsNumber\", nhsNumber);",
															"    pm.variables.set(\"initialScore\", initialScore);",
															"    console.log('NHS Number:' + nhsNumber + \" Score: \" + initialScore);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=2020-02-12&family=le*&address-postcode=DN16*&general-practitioner=A20047",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "2020-02-12"
														},
														{
															"key": "family",
															"value": "le*"
														},
														{
															"key": "address-postcode",
															"value": "DN16*"
														},
														{
															"key": "general-practitioner",
															"value": "A20047"
														}
													]
												},
												"description": "Performing an alphanumeric search using a matching general-practitioner increases the patient's matching score"
											},
											"response": []
										},
										{
											"name": "Matching Date of Death increases match score against the same search without Date of Death",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"eval(pm.globals.get(\"patient\"));",
															"let response = pm.response.json();",
															"let newScore = response.entry[0].search.score;",
															"console.log(\"New score: \" + newScore);",
															"",
															"pm.test(\"Returns status code 200\", () => {",
															"    pm.response.to.have.status(200);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 9691183994\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('9691183994');",
															"});",
															"",
															"pm.test(\"Patient matching score has increased\", () => {",
															"    ",
															"    pm.expect(pm.variables.get(\"initialScore\")).to.be.below(newScore);",
															"});",
															"",
															"pm.test(\"Patient matching score is a valid score\"), () => {",
															"    pm.expect(newScore).to.be.atLeast(0);",
															"    pm.expect(newScore).to.be.atMost(1);",
															"};"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "555cfeec-5c14-4d76-a330-a5d011ab8ee9",
														"exec": [
															"const nhsNumber = '9691183994';",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + \"/Patient?gender=male&birthdate=2020-02-11&family=le*&address-postcode=DN16*\",",
															"    method: 'GET',",
															"    header: {",
															"        asidHeader,",
															"        sessionURIDHeader,",
															"        identityUUIDHeader",
															"    }",
															"}, function (err, res) {",
															"    console.log(\"Pre-request Request: \" + JSON.stringify(res.json()));",
															"    pm.expect(res.json().entry[0].resource.id).to.equal(nhsNumber);",
															"    let initialScore = res.json().entry[0].search.score;",
															"    pm.variables.set(\"nhsNumber\", nhsNumber);",
															"    pm.variables.set(\"initialScore\", initialScore);",
															"    console.log('NHS Number:' + nhsNumber + \" Score: \" + initialScore);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=2020-02-11&family=le*&address-postcode=DN16*&death-date=2020-03-01",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "2020-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														},
														{
															"key": "address-postcode",
															"value": "DN16*"
														},
														{
															"key": "death-date",
															"value": "2020-03-01"
														}
													]
												},
												"description": "Performing an alphanumeric search using a matching death-date increases the patient's matching score"
											},
											"response": []
										},
										{
											"name": "Matching Date of Death does not affect match score if already 1",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"eval(pm.globals.get(\"patient\"));",
															"let response = pm.response.json();",
															"let newScore = response.entry[0].search.score;",
															"console.log(\"New score: \" + newScore);",
															"",
															"",
															"pm.test(\"Returns status code 200\", () => {",
															"    pm.response.to.have.status(200);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 9691183994\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('9691183994');",
															"});",
															"",
															"pm.test(\"Patient matching score has remained at 1\", () => {",
															"    ",
															"    pm.expect(pm.variables.get(\"initialScore\")).to.equal(newScore);",
															"});",
															"",
															"pm.test(\"Patient matching score is a valid score\"), () => {",
															"    pm.expect(newScore).to.be.atLeast(0);",
															"    pm.expect(newScore).to.be.atMost(1);",
															"};"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "555cfeec-5c14-4d76-a330-a5d011ab8ee9",
														"exec": [
															"const nhsNumber = '9691183994';",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + \"/Patient?gender=male&birthdate=2020-02-11&family=length&address-postcode=DN16 3BB\",",
															"    method: 'GET',",
															"    header: {",
															"        asidHeader,",
															"        sessionURIDHeader,",
															"        identityUUIDHeader",
															"    }",
															"}, function (err, res) {",
															"    console.log(\"Pre-request Request: \" + JSON.stringify(res.json()));",
															"    pm.expect(res.json().entry[0].resource.id).to.equal(nhsNumber, \"invalid patient data\");",
															"    let initialScore = res.json().entry[0].search.score;",
															"    pm.expect(initialScore).to.equal(1, \"invalid patient data\")",
															"    pm.variables.set(\"nhsNumber\", nhsNumber);",
															"    pm.variables.set(\"initialScore\", initialScore);",
															"    console.log('NHS Number:' + nhsNumber + \" Score: \" + initialScore);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=2020-02-11&family=length&address-postcode=DN16 3BB&death-date=2020-03-01",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "2020-02-11"
														},
														{
															"key": "family",
															"value": "length"
														},
														{
															"key": "address-postcode",
															"value": "DN16 3BB"
														},
														{
															"key": "death-date",
															"value": "2020-03-01"
														}
													]
												},
												"description": "Performing an alphanumeric search using the correct death-date does not affect the patient's matching score when it's already 1"
											},
											"response": []
										},
										{
											"name": "Matching General Practitioner does not affect match score if already 1",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"eval(pm.globals.get(\"patient\"));",
															"let response = pm.response.json();",
															"let newScore = response.entry[0].search.score;",
															"console.log(\"New score: \" + newScore);",
															"",
															"pm.test(\"Returns status code 200\", () => {",
															"    pm.response.to.have.status(200);",
															"})",
															"",
															"pm.test(\"Returns patient with NHS number 9691183986\", () => {",
															"    pm.expect(response.entry[0].resource.id).to.equal('9691183986');",
															"});",
															"",
															"pm.test(\"Patient matching score has increased\", () => {",
															"    pm.expect(pm.variables.get(\"initialScore\")).to.equal(newScore);",
															"});",
															"",
															"pm.test(\"Patient matching score is a valid score\"), () => {",
															"    pm.expect(newScore).to.be.atLeast(0);",
															"    pm.expect(newScore).to.be.atMost(1);",
															"};"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "555cfeec-5c14-4d76-a330-a5d011ab8ee9",
														"exec": [
															"const nhsNumber = '9691183986';",
															"let asidHeader = pm.environment.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
															"",
															"pm.sendRequest({",
															"    url: pm.environment.get(\"environment\") + \"/Patient?gender=male&birthdate=2020-02-12&family=length&address-postcode=DN18 5DG\",",
															"    method: 'GET',",
															"    header: {",
															"        asidHeader,",
															"        sessionURIDHeader,",
															"        identityUUIDHeader",
															"    }",
															"}, function (err, res) {",
															"    console.log(\"Pre-request Request: \" + JSON.stringify(res.json()));",
															"    pm.expect(res.json().entry[0].resource.id).to.equal(nhsNumber);",
															"    let initialScore = res.json().entry[0].search.score;",
															"    pm.variables.set(\"nhsNumber\", nhsNumber);",
															"    pm.variables.set(\"initialScore\", initialScore);",
															"    console.log('NHS Number:' + nhsNumber + \" Score: \" + initialScore);",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "88888"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=2020-02-12&family=length&address-postcode=DN18 5DG&general-practitioner=A20047",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "2020-02-12"
														},
														{
															"key": "family",
															"value": "length"
														},
														{
															"key": "address-postcode",
															"value": "DN18 5DG"
														},
														{
															"key": "_fuzzy-match",
															"value": "true",
															"disabled": true
														},
														{
															"key": "general-practitioner",
															"value": "A20047"
														}
													]
												},
												"description": "Performing an alphanumeric search using the correct general-practitioner does not affect the patient's matching score when it's already 1"
											},
											"response": []
										},
										{
											"name": "Fuzzy search returns multiple patients each with a matched score between 0 and 1",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "fffa160e-e723-4537-8282-3831893f5852",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "93e28be6-475d-48b0-891e-fb16474ff575",
														"exec": [
															"var response = pm.response.json();",
															"eval(pm.globals.get(\"assertThatUtil\"));",
															"eval(pm.globals.get(\"patient\"));",
															"",
															"let scores = patient().getScores();",
															"let numberOfPatients = patient().getTotalNumberOfPatients();",
															"",
															"assertThatUtil().statusCodeIs(200);",
															"",
															"pm.test(\"Returns multiple patients\", () => {",
															"    pm.expect(numberOfPatients).to.be.above(1);",
															"})",
															"",
															"pm.test(\"Each patient has a score\", () =>{",
															"    pm.expect(numberOfPatients).to.equal(scores.length)",
															"});",
															"",
															"pm.test(\"Each score is a number\", () => {",
															"   scores.forEach(score => {",
															"       pm.expect(score).to.be.a('number');",
															"   }) ",
															"});",
															"",
															"pm.test(\"Each score is between 0 and 1\", () => {",
															"    scores.forEach(score => {",
															"        var tmp = parseFloat(score)",
															"        pm.expect(tmp).to.be.above(0);",
															"        pm.expect(tmp).to.be.at.most(1);",
															"    });",
															"});"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=Stephen&birthdate=2015-12-15&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												},
												"description": "For a fuzzy-search based search which results in multiple patients being retured. Each patient is given a score.\n\nThis test is to validate that:\n- The score given to each patient is > 0 and < 1"
											},
											"response": []
										},
										{
											"name": "Search matching multiple patients returns each patient with matching score sorted by score best-first",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "fffa160e-e723-4537-8282-3831893f5852",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "93e28be6-475d-48b0-891e-fb16474ff575",
														"exec": [
															"var chai = require(\"chai\");",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
															"const patientUtil = eval(pm.globals.get(\"patient\"));",
															"var response = pm.response.json();",
															"",
															"assertThat.statusCodeIs(200);",
															"",
															"pm.test(\"Returns multiple patients\", () =>{",
															"    pm.expect(patientUtil.getTotalNumberOfPatients()).to.be.above(1);",
															"});",
															"",
															"pm.test(\"Returns result scoring sorted best-first\", () => {",
															"    let scores = patientUtil.getScores();",
															"    ",
															"    for (i = 1; i < scores.length; i++) {",
															"        let previous = parseFloat(scores[i-1]);",
															"        let current = parseFloat(scores[i]);",
															"        pm.expect(current).to.be.at.most(previous);        ",
															"      }",
															" });"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=Stephen&birthdate=2015-12-15&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												},
												"description": "For alphanumeric searching, every result includes a score from 0 to 1. \n\nThis test is to validate that\n- Results are sorted best-first i.e. 1 to 0"
											},
											"response": []
										}
									],
									"description": "Every matched patient in the results list includes a score to indicate how closely the patient matched the search parameters. A score of 1.0 indicates an exact match. A score of less than 1.0 indicates a partial match. The result list is sorted in descending score order - best match first.",
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "other tests",
									"item": [
										{
											"name": "Multiple Wildcards permitted - family",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
														"exec": [
															"/*set variables for test*/",
															"",
															"pm.variables.set(\"familyQ\", \"Ma\\*pi\\*g\");",
															"pm.variables.set(\"family\", \"Mapping\");",
															"pm.variables.set(\"gender\", \"female\");",
															"pm.variables.set(\"birthdate\", \"2010-01-01\");",
															"",
															"//5900009068",
															"/*set variables for checking mapping*/",
															"",
															"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
															"",
															"pm.variables.set(\"prefix\", \"Dame\");",
															"pm.variables.set(\"nameType\", \"Usual name\");",
															"pm.variables.set(\"addressType\", \"usual\");",
															"pm.variables.set(\"telecomType\", \"telephone\");",
															"pm.variables.set(\"telecomUse\", \"home\");",
															"",
															"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
															"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
															"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
															"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
															"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
															"pm.variables.set(\"patientId\", \"5900009068\");",
															"pm.variables.set(\"metaVersionId\", \"15\");",
															"pm.variables.set(\"resourceType\", \"Patient\");",
															"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"telecomValue\", \"07900000000\");",
															"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
															"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
															"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
															"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
														"exec": [
															"var response = pm.response.json();",
															"",
															"// Apply Common Mapping Tests",
															"//======================================",
															"eval(pm.globals.get(\"checkSearchMappings\"))();",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?family={{familyQ}}&gender={{gender}}&birthdate={{birthdate}}",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "family",
															"value": "{{familyQ}}"
														},
														{
															"key": "gender",
															"value": "{{gender}}"
														},
														{
															"key": "birthdate",
															"value": "{{birthdate}}"
														},
														{
															"key": "general-practitioner",
															"value": "Y0001",
															"disabled": true
														}
													]
												},
												"description": "Multiple wildcards are permitted in family name"
											},
											"response": []
										},
										{
											"name": "Multiple Wildcards permitted - given",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
														"exec": [
															"/*set variables for test*/",
															"",
															"pm.variables.set(\"family\", \"Mapping\");",
															"pm.variables.set(\"gender\", \"female\");",
															"pm.variables.set(\"birthdate\", \"2010-01-01\");",
															"pm.variables.set(\"givenQ\", \"Se\\*r\\*h\");",
															"",
															"//5900009068",
															"/*set variables for checking mapping*/",
															"",
															"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
															"",
															"pm.variables.set(\"prefix\", \"Dame\");",
															"pm.variables.set(\"nameType\", \"Usual name\");",
															"pm.variables.set(\"addressType\", \"usual\");",
															"pm.variables.set(\"telecomType\", \"telephone\");",
															"pm.variables.set(\"telecomUse\", \"home\");",
															"",
															"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
															"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
															"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
															"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
															"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
															"pm.variables.set(\"patientId\", \"5900009068\");",
															"pm.variables.set(\"metaVersionId\", \"15\");",
															"pm.variables.set(\"resourceType\", \"Patient\");",
															"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"telecomValue\", \"07900000000\");",
															"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
															"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
															"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
															"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
														"exec": [
															"var response = pm.response.json();",
															"",
															"// Apply Common Mapping Tests",
															"//======================================",
															"eval(pm.globals.get(\"checkSearchMappings\"))();",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&given={{givenQ}}",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "family",
															"value": "{{family}}"
														},
														{
															"key": "gender",
															"value": "{{gender}}"
														},
														{
															"key": "birthdate",
															"value": "{{birthdate}}"
														},
														{
															"key": "given",
															"value": "{{givenQ}}"
														}
													]
												},
												"description": "Multiple wildcards are permitted in given name"
											},
											"response": []
										},
										{
											"name": "Multiple Wildcards permitted - postCode",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
														"exec": [
															"/*set variables for test*/",
															"",
															"pm.variables.set(\"family\", \"Mapping\");",
															"pm.variables.set(\"gender\", \"female\");",
															"pm.variables.set(\"birthdate\", \"2010-01-01\");",
															"pm.variables.set(\"postalCodeQ\", \"BD\\* \\*LY\");",
															"",
															"//5900009068",
															"/*set variables for checking mapping*/",
															"",
															"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
															"",
															"pm.variables.set(\"prefix\", \"Dame\");",
															"pm.variables.set(\"nameType\", \"Usual name\");",
															"pm.variables.set(\"addressType\", \"usual\");",
															"pm.variables.set(\"telecomType\", \"telephone\");",
															"pm.variables.set(\"telecomUse\", \"home\");",
															"",
															"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
															"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
															"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
															"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
															"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
															"pm.variables.set(\"patientId\", \"5900009068\");",
															"pm.variables.set(\"metaVersionId\", \"15\");",
															"pm.variables.set(\"resourceType\", \"Patient\");",
															"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"telecomValue\", \"07900000000\");",
															"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
															"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
															"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
															"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
														"exec": [
															"var response = pm.response.json();",
															"",
															"// Apply Common Mapping Tests",
															"//======================================",
															"eval(pm.globals.get(\"checkSearchMappings\"))();",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?family={{family}}&gender={{gender}}&birthdate={{birthdate}}&address-postcode={{postalCodeQ}}",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "family",
															"value": "{{family}}"
														},
														{
															"key": "gender",
															"value": "{{gender}}"
														},
														{
															"key": "birthdate",
															"value": "{{birthdate}}"
														},
														{
															"key": "address-postcode",
															"value": "{{postalCodeQ}}"
														}
													]
												},
												"description": "Multiple wildcards are permitted in postCode"
											},
											"response": []
										},
										{
											"name": "Multiple Wildcards permitted - family, given & postCode",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
														"exec": [
															"/*set variables for test*/",
															"",
															"pm.variables.set(\"familyQ\", \"Ma\\*pi\\*g\");",
															"pm.variables.set(\"givenQ\", \"Se\\*r\\*h\");",
															"pm.variables.set(\"postalCodeQ\", \"BD\\* \\*LY\");",
															"pm.variables.set(\"family\", \"Mapping\");",
															"pm.variables.set(\"gender\", \"female\");",
															"pm.variables.set(\"birthdate\", \"2010-01-01\");",
															"",
															"//5900009068",
															"/*set variables for checking mapping*/",
															"",
															"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
															"",
															"pm.variables.set(\"prefix\", \"Dame\");",
															"pm.variables.set(\"nameType\", \"Usual name\");",
															"pm.variables.set(\"addressType\", \"usual\");",
															"pm.variables.set(\"telecomType\", \"telephone\");",
															"pm.variables.set(\"telecomUse\", \"home\");",
															"",
															"pm.variables.set(\"given\", [\"Search\",\"Again\"]);",
															"pm.variables.set(\"suffix\", [\"MBA\",\"PHD\"]);",
															"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
															"pm.variables.set(\"addressLine\",JSON.stringify([\"1\",\"westwood\",\"ecclechill\",\"bradfordian\"]));",
															"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
															"pm.variables.set(\"patientId\", \"5900009068\");",
															"pm.variables.set(\"metaVersionId\", \"15\");",
															"pm.variables.set(\"resourceType\", \"Patient\");",
															"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
															"pm.variables.set(\"telecomValue\", \"07900000000\");",
															"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
															"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
															"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
															"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
														"exec": [
															"var response = pm.response.json();",
															"",
															"// Apply Common Mapping Tests",
															"//======================================",
															"eval(pm.globals.get(\"checkSearchMappings\"))();",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?family={{familyQ}}&gender={{gender}}&birthdate={{birthdate}}&given={{givenQ}}&address-postcode={{postalCodeQ}}",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "family",
															"value": "{{familyQ}}"
														},
														{
															"key": "gender",
															"value": "{{gender}}"
														},
														{
															"key": "birthdate",
															"value": "{{birthdate}}"
														},
														{
															"key": "given",
															"value": "{{givenQ}}"
														},
														{
															"key": "address-postcode",
															"value": "{{postalCodeQ}}"
														}
													]
												},
												"description": "Multiple wildcards are permitted in family, given & postCode"
											},
											"response": []
										},
										{
											"name": "Search by Postcode ignores whitespacing",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
														"exec": [
															"let testScenarios = pm.variables.get('testData');",
															"let asidHeader = pm.variables.get(\"asidHeader\");",
															"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
															"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
															"",
															"testScenarios.forEach(scenario => {",
															"    scenario.tests.forEach(testScript => {",
															"        console.log(\"Test Script: \" + testScript.name);",
															"        ",
															"        testScript.tests.forEach(t => {",
															"            let patientDetails;    ",
															"            let needToSetValues = true;",
															"            console.log(\"Query Type: \" + t.searchType);",
															"            ",
															"            pm.sendRequest({",
															"                url: pm.environment.get(\"environment\") + t.query,",
															"                method: 'GET',",
															"                header: {",
															"                    asidHeader,",
															"                    sessionURIDHeader,",
															"                    identityUUIDHeader",
															"                }",
															"            }, function (err, res) {            ",
															"                if (needToSetValues) {",
															"                    patientDetails = getNhsNumberAndInitialScore(res.json());                ",
															"                    needToSetValues = false;",
															"                }",
															"                pm.expect(res.code).to.equal(200, 'invalid response returned');",
															"                validateScoreRemainsTheSame(testScript.name + \" - \" + t.searchType, res.json(), patientDetails);",
															"            });",
															"        })",
															"    });",
															"});",
															"",
															"",
															"",
															"function getNhsNumberAndInitialScore(response) {",
															"    return {",
															"        nhsNumber: response.entry[0].resource.id,",
															"        score: response.entry[0].search.score",
															"    };",
															"}",
															"",
															"function validateScoreRemainsTheSame(testName, response, patientDetails) {",
															"    let newScore = response.entry[0].search.score;",
															"    pm.test(testName + ' returns patient ' + patientDetails.nhsNumber + ' with matching score of ' + newScore, () => {",
															"        pm.expect(response.entry[0].resource.id).to.equal(patientDetails.nhsNumber, \"unexpected patient record returned\");",
															"        console.log(testName + ' NHS Number ' + patientDetails.nhsNumber + ' with Score: ' + newScore);",
															"        pm.expect(patientDetails.score).to.equal(newScore);",
															"    });",
															"}"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "555cfeec-5c14-4d76-a330-a5d011ab8ee9",
														"exec": [
															"let simple = [",
															"    {",
															"        name: \"Patient Postcode: DN16 3BB\",",
															"        tests: [",
															"            { searchType: 'Simple search with spaces', query: '/Patient?birthdate=2020-02-11&family=length&gender=male&address-postcode=DN16 3BB' },",
															"            { searchType: 'Simple search without spaces', query: '/Patient?birthdate=2020-02-11&family=length&gender=male&address-postcode=DN163BB'}",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: M32 8EX\",",
															"        tests: [",
															"            { searchType: 'Simple search with spaces', query: '/Patient?birthdate=2020-02-11&family=charles&gender=male&address-postcode=M32 8EX' },",
															"            { searchType: 'Simple search without spaces', query: '/Patient?birthdate=2020-02-11&family=charles&gender=male&address-postcode=M328EX' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: M328XX\",",
															"        tests: [",
															"            { searchType: 'Simple search with spaces', query: '/Patient?birthdate=2020-02-11&family=speaker&gender=male&address-postcode=M32 8XX' },",
															"            { searchType: 'Simple search without spaces', query: '/Patient?birthdate=2020-02-11&family=speaker&gender=male&address-postcode=M328XX' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: DN112EE\",",
															"        tests: [",
															"            { searchType: 'Simple search without spaces', query: '/Patient?birthdate=2020-02-11&family=Spacing&gender=female&address-postcode=DN112EE'},            ",
															"            { searchType: 'Simple search with spaces', query: '/Patient?birthdate=2020-02-11&family=Spacing&gender=female&address-postcode=DN11 2EE'},            ",
															"        ]",
															"    }",
															"];",
															"",
															"let algorithmic = [",
															"    {",
															"        name: \"Patient Postcode: DN16 3BB\",",
															"        tests: [",
															"            { searchType: 'Algorithmic search with spaces', query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=length&given=Selena&address-postcode=DN16 3BB' },",
															"            { searchType: 'Algorithmic search without spaces', query: '/Patient?_fuzzy-match=true&family=length&birthdate=2020-02-11&&given=Selena&address-postcode=DN163BB' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: M32 8EX\",",
															"        tests: [",
															"            { searchType: 'Algorithmic search with spaces', query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=Charles&given=Michael&address-postcode=M32 8EX' },",
															"            { searchType: 'Algorithmic search without spaces', query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=Charles&given=Michael&address-postcode=M328EX' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: M328XX\",",
															"        tests: [",
															"            { searchType: 'Algorithmic search with spaces', query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=speaker&given=bose&address-postcode=M32 8XX' },",
															"            { searchType: 'Algorithmic search without spaces', query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=speaker&given=bose&address-postcode=M328XX' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: DN112EE\",",
															"        tests: [",
															"            { searchType: 'Algorithmic search without spaces', query: '/Patient?_fuzzy-match=true&given=Test&birthdate=2020-02-11&family=Spacing&gender=female&address-postcode=DN112EE'},            ",
															"            { searchType: 'Algorithmic search with spaces', query: '/Patient?_fuzzy-match=true&given=Test&birthdate=2020-02-11&family=Spacing&gender=female&address-postcode=DN11 2EE'},            ",
															"        ]",
															"    }",
															"];",
															"",
															"let alphanumeric = [",
															"    {",
															"        name: \"Patient Postcode: DN16 3BB\",",
															"        tests: [",
															"            { searchType: 'Alphanumeric search with spaces', query: '/Patient?gender=male&birthdate=2020-02-11&family=leng*&address-postcode=DN16 3BB' },",
															"            { searchType: 'Alphanumeric search without spaces', query: '/Patient?gender=male&birthdate=2020-02-11&family=leng*&address-postcode=DN163BB' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: M32 8EX\",",
															"        tests: [",
															"            { searchType: 'Alphanumeric search with spaces', query: '/Patient?gender=male&birthdate=2020-02-11&family=charl*&address-postcode=M32 8EX' },",
															"            { searchType: 'Alphanumeric search without spaces', query: '/Patient?gender=male&birthdate=2020-02-11&family=charl*&address-postcode=M328EX' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: M32 8XX\",",
															"        tests: [",
															"            { searchType: 'Alphanumeric search without spaces', query: '/Patient?gender=male&birthdate=2020-02-11&family=speake*&address-postcode=M328XX' }",
															"        ]",
															"    },",
															"    {",
															"        name: \"Patient Postcode: DN112EE\",",
															"        tests: [",
															"            { searchType: 'Alphanumeric search without spaces', query: '/Patient?birthdate=2020-02-11&family=Spaci*&gender=female&address-postcode=DN112EE'},            ",
															"        ]",
															"    }",
															"];",
															"",
															"",
															"pm.variables.set('testData', testScenarios = [",
															"    { tests: simple },",
															"    { tests: alphanumeric },",
															"    { tests: algorithmic }",
															"]);"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}",
													"host": [
														"{{environment}}"
													]
												},
												"description": "Validates white spaces in postcodes do not affect Searching i.e. you can search for a patient with the;\n- postcode DN163BB using both DN163BB and DN16 3BB\n- postcode DN16 3BB using both DN16 3BB and DN163BB"
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Alphanumeric",
									"item": [
										{
											"name": "By General Practitioner",
											"item": [
												{
													"name": "Search using invalid General Practitioner returns INVALID_VALUE",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
																"exec": [
																	"eval(pm.globals.get(\"assertThatUtil\"));",
																	"eval(pm.globals.get(\"errorMessage\"));",
																	"",
																	"assertThatUtil().statusCodeIs(400);",
																	"errorMessage().assertCodeIs(\"INVALID_VALUE\");",
																	"errorMessage().assertDisplayIs(\"Invalid value - '.' in field 'general-practitioner'\");",
																	"errorMessage().assertSeverityIs(\"error\");",
																	"errorMessage().assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");",
																	"",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?gender=male&birthdate=2000-01-01&family=Practitioner&general-practitioner=.",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "_max-results",
																	"value": "50",
																	"disabled": true
																},
																{
																	"key": "gender",
																	"value": "male"
																},
																{
																	"key": "birthdate",
																	"value": "2000-01-01"
																},
																{
																	"key": "family",
																	"value": "Practitioner"
																},
																{
																	"key": "general-practitioner",
																	"value": "."
																}
															]
														},
														"description": "Validate searching for a patient using an invalid general-practitioner value such as `.` returns an INVALID_VALUE error response"
													},
													"response": []
												},
												{
													"name": "Search using  General Practitioner returns no Patient record when no match is found",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
																"exec": [
																	"eval(pm.globals.get(\"assertThatUtil\"));",
																	"eval(pm.globals.get(\"patient\"));",
																	"",
																	"assertThatUtil().statusCodeIs(200);",
																	"",
																	"pm.test(\"Returns 0 patients\", () =>{",
																	"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(0);",
																	"})"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?gender=male&family=Practitioner&general-practitioner=Y995894&birthdate=ge2000-01-01",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "gender",
																	"value": "male"
																},
																{
																	"key": "family",
																	"value": "Practitioner"
																},
																{
																	"key": "general-practitioner",
																	"value": "Y995894"
																},
																{
																	"key": "_max-results",
																	"value": "50",
																	"disabled": true
																},
																{
																	"key": "birthdate",
																	"value": "ge2000-01-01"
																}
															]
														},
														"description": "Validate no patient record is returned when performing a search using criteria including general-practitioner that does not match any patient."
													},
													"response": []
												},
												{
													"name": "Search using valid General Practitioner returns Patient record",
													"event": [
														{
															"listen": "test",
															"script": {
																"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
																"exec": [
																	"eval(pm.globals.get(\"assertThatUtil\"));",
																	"eval(pm.globals.get(\"patient\"));",
																	"",
																	"assertThatUtil().statusCodeIs(200);",
																	"",
																	"pm.test(\"Returns one patient\", () =>{",
																	"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(1);",
																	"})",
																	"",
																	"pm.test(\"Returns patient with NHS Number 5900014061\", () => {",
																	"    pm.expect(pm.response.json().entry[0].resource.id).to.equal('5900014061');",
																	"})"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}/Patient?gender=male&birthdate=2000-01-01&family=Practitioner&general-practitioner=Y00002",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient"
															],
															"query": [
																{
																	"key": "_max-results",
																	"value": "50",
																	"disabled": true
																},
																{
																	"key": "gender",
																	"value": "male"
																},
																{
																	"key": "birthdate",
																	"value": "2000-01-01"
																},
																{
																	"key": "family",
																	"value": "Practitioner"
																},
																{
																	"key": "general-practitioner",
																	"value": "Y00002"
																}
															]
														},
														"description": "Validate patients record is returned when searching by general-practitioner"
													},
													"response": []
												}
											],
											"description": "Patient should be searchable by GP Provider using the query parameter *general-practitioner*.\n",
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Sensitive Patient",
							"item": [
								{
									"name": "Search specifying GP of sensitive patient results in patient not being returned",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
												"exec": [
													"eval(pm.globals.get(\"patient\"));",
													"",
													"",
													"pm.test(\"Returns status code 200\", function () {",
													"    pm.response.to.have.status(200);",
													"});",
													"",
													"pm.test(\"Returns 0 patients\", () =>{",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(0);",
													"})"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "5a8c311c-bd46-4c7b-b3dc-a3098486c8c4",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient?gender=male&birthdate=2000-01-01&family=Ukraine',",
													"    method: 'GET',",
													"    header: {",
													"        asidHeader,",
													"        sessionURIDHeader,",
													"        identityUUIDHeader",
													"    }",
													"}, function (err, res) {               ",
													"    pm.expect(res.code).to.equal(200, 'invalid response returned');",
													"    pm.expect(res.json().entry[0].resource.id).to.equal('5900013553', 'Nhs number for Sensitive paitent not found');    ",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=male&birthdate=2000-01-01&family=Ukraine&general-practitioner=Y00007",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "family",
													"value": "Ukraine"
												},
												{
													"key": "general-practitioner",
													"value": "Y00007"
												},
												{
													"key": "_max-results",
													"value": "50",
													"disabled": true
												}
											]
										},
										"description": "**NHS Number: 5900013553**\n\n> GIVEN I perform a Search specifying general-practitioner  \nAND that matches one patient\nAND that patient is a Sensitive patient  \nWHEN I get the response  \nTHEN the sensitive patients record is not displayed "
									},
									"response": []
								},
								{
									"name": "Search specifying GP which matches multiple patients results in sensitive patient not being returned",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
												"exec": [
													"var response = pm.response.json();",
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 1 patient\", () =>{",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(1);",
													"})",
													"",
													"pm.test(\"Does not return patient 5900013553\", () => {",
													"    pm.expect(patient().containsPatientWithNhsNumber('5900013553')).to.be.false",
													"})"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "32e4c0d7-5d97-43da-b210-934154a02436",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient?birthdate=2000-01-01&family=Ukraine&gender=male',",
													"    method: 'GET',",
													"    header: {",
													"        asidHeader,",
													"        sessionURIDHeader,",
													"        identityUUIDHeader",
													"    }",
													"}, function (err, res) {               ",
													"    pm.expect(res.code).to.equal(200, 'invalid response returned');",
													"    pm.expect(res.json().entry[0].resource.id).to.equal('5900013553', 'Nhs number for Sensitive paitent not found');    ",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=male&birthdate=ge2000-01-01&family=Ukrain*&general-practitioner=Y00007",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2000-01-01"
												},
												{
													"key": "family",
													"value": "Ukrain*"
												},
												{
													"key": "general-practitioner",
													"value": "Y00007"
												}
											]
										},
										"description": "Sensitive Patient NHS Number: 5900013553\n\n\n\n> GIVEN I perform a Search specifying general-practitioner  \nAND that matches multiple patients  \nAND one of those patients is a Sensitive patient  \nWHEN I get the response  \nTHEN the sensitive patients record is not displayed"
									},
									"response": []
								},
								{
									"name": "Search specifying Postcode of sensitive patient results in patient not being returned",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "02a77542-f342-44b5-9609-c9a77ebd7cfe",
												"exec": [
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 0 patients\", () =>{",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(0);",
													"})"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "e1d16a93-1692-4692-997e-c5718c7e89bd",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient?birthdate=2000-01-01&family=Ukraine&gender=male',",
													"    method: 'GET',",
													"    header: {",
													"        asidHeader,",
													"        sessionURIDHeader,",
													"        identityUUIDHeader",
													"    }",
													"}, function (err, res) {               ",
													"    pm.expect(res.code).to.equal(200, 'invalid response returned');",
													"    pm.expect(res.json().entry[0].resource.id).to.equal('5900013553', 'Nhs number for Sensitive paitent not found');    ",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?birthdate=2000-01-01&family=Ukraine&gender=male&address-postcode=B4 3PP",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "family",
													"value": "Ukraine"
												},
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "address-postcode",
													"value": "B4 3PP"
												}
											]
										},
										"description": "**NHS Number: 5900013553**\n\n> GIVEN I perform a Search specifying address-postcode  \nAND that matches one patient\nAND that patient is a Sensitive patient  \nWHEN I get the response  \nTHEN the sensitive patients record is not displayed "
									},
									"response": []
								},
								{
									"name": "Search specifying Postcode which matches multiple patients results in sensitive patient not being returned",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
												"exec": [
													"var response = pm.response.json();",
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 1 patient\", () =>{",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(1);",
													"})",
													"",
													"pm.test(\"Does not return patient 5900013553\", () => {",
													"    pm.expect(patient().containsPatientWithNhsNumber('5900013553')).to.be.false",
													"})"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "c2feaaf3-ce38-4f1e-84f9-ab336a968a85",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient?birthdate=2000-01-01&family=Ukraine&gender=male',",
													"    method: 'GET',",
													"    header: {",
													"        asidHeader,",
													"        sessionURIDHeader,",
													"        identityUUIDHeader",
													"    }",
													"}, function (err, res) {               ",
													"    pm.expect(res.code).to.equal(200, 'invalid response returned');",
													"    pm.expect(res.json().entry[0].resource.id).to.equal('5900013553', 'Nhs number for Sensitive paitent not found');    ",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=male&birthdate=ge2000-01-01&family=Ukrain*&address-postcode=B4*",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2000-01-01"
												},
												{
													"key": "family",
													"value": "Ukrain*"
												},
												{
													"key": "address-postcode",
													"value": "B4*"
												}
											]
										},
										"description": "NHS Numbers: 5900013553, 5900005194\n\n> GIVEN I perform a Search specifying address-postcode  \nAND that matches multiple patients  \nAND one of those patients is a Sensitive patient  \nWHEN I get the response  \nTHEN the sensitive patients record is not displayed"
									},
									"response": []
								},
								{
									"name": "Search matching multiple patients including sensitive patient does not return sensitive details for sensitive patient",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "2fa4ad97-ff41-4e08-9c3d-cb842614c3c5",
												"exec": [
													"var response = pm.response.json();",
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 2 patients\", () => {",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(2);",
													"})",
													"",
													"pm.test(\"Returns sensitive patient\", () => {",
													"    pm.expect(response.entry[1].resource.id).to.equal('5900013553');",
													"});",
													"",
													"pm.test(\"Sensitive patients address is not displayed\", () => {",
													"    pm.expect(response.entry[1].resource.address).to.be.undefined;",
													"});",
													"",
													"pm.test(\"Sensitive patients telecome details are not displayed\", () => {",
													"    pm.expect(response.entry[1].resource.telecom).to.be.undefined;",
													"});",
													"",
													"pm.test(\"Sensitive patients GP details are not displayed\", () => {",
													"    pm.expect(response.entry[1].resource.generalPractitioner).to.be.undefined;",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=male&birthdate=ge2000-01-01&family=Ukrain*",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2000-01-01"
												},
												{
													"key": "family",
													"value": "Ukrain*"
												}
											]
										},
										"description": "Sensitive Patient NHS Number: 5900013553\n\n\n> GIVEN I perform a Search  \nAND that matches multiple patients  \nAND one of those patients is a Sensitive patient  \nWHEN I get the response  \nTHEN the following sensitive details are not returned for the sensitive patient (gp, death-notification extension, address and telecom)"
									},
									"response": []
								},
								{
									"name": "Search matching multiple patients including invalid patient does not return invalid patients record",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "2fa4ad97-ff41-4e08-9c3d-cb842614c3c5",
												"exec": [
													"var response = pm.response.json();",
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 1 patients\", () => {",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(1);",
													"})",
													"",
													"pm.test(\"Does not return invalid patient\", () => {",
													"    pm.expect(patient().containsPatientWithNhsNumber('5900006107')).to.be.false;",
													"});",
													"",
													"pm.test(\"Does return non-invalid patient\", () => {",
													"    pm.expect(patient().containsPatientWithNhsNumber('5900003876')).to.be.true;",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "560ca350-73e4-45a8-a92f-20114ad4154e",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient/5900006107',",
													"    method: 'GET',",
													"    header: {",
													"        asidHeader,",
													"        sessionURIDHeader,",
													"        identityUUIDHeader",
													"    }",
													"}, function (err, res) {               ",
													"    pm.expect(res.code).to.equal(404, 'invalid patient does not exist');",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=female&birthdate=ge2000-01-01&family=invalidated",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "female"
												},
												{
													"key": "birthdate",
													"value": "ge2000-01-01"
												},
												{
													"key": "family",
													"value": "invalidated"
												}
											]
										},
										"description": "Invalidated NHS Patient number : 5900006107\n\n> GIVEN I perform a Search  \nAND that matches multiple patients  \nAND one of those patients is a invalid patient  \nWHEN I get the response  \nTHEN the invalid patients record is not returned"
									},
									"response": []
								},
								{
									"name": "Search matching sensitive patient returns security object",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "2fa4ad97-ff41-4e08-9c3d-cb842614c3c5",
												"exec": [
													"var response = pm.response.json();",
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 1 patients\", () => {",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(1);",
													"})",
													"",
													"pm.test(\"Returns Sensitive patient\", () => {",
													"    pm.expect(patient().containsPatientWithNhsNumber('5900004430')).to.be.true;",
													"});",
													"",
													"pm.test(\"Returns Security object\", () => {",
													"    pm.expect(response.entry[0].resource.meta.security[0].code).to.equal('R', 'invalid code');",
													"    pm.expect(response.entry[0].resource.meta.security[0].display).to.equal('restricted', 'invalid display');",
													"    pm.expect(response.entry[0].resource.meta.security[0].system).to.equal('https://www.hl7.org/fhir/valueset-security-labels.html', 'invalid system');",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "560ca350-73e4-45a8-a92f-20114ad4154e",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient/5900006107',",
													"    method: 'GET',",
													"    header: {",
													"        asidHeader,",
													"        sessionURIDHeader,",
													"        identityUUIDHeader",
													"    }",
													"}, function (err, res) {               ",
													"    pm.expect(res.code).to.equal(404, 'invalid patient does not exist');",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=female&birthdate=2001-02-01&family=sensitive",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "female"
												},
												{
													"key": "birthdate",
													"value": "2001-02-01"
												},
												{
													"key": "family",
													"value": "sensitive"
												}
											]
										},
										"description": "> GIVEN I perform a Search\nAND that matches a Sensitive patient\nWHEN I get the response  \nTHEN the Patients record includes the meta.security array  \nAND the array includes the **R** *restricted level*"
									},
									"response": []
								},
								{
									"name": "Search matching invalid patient only, results in patients data not being returned",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "02a77542-f342-44b5-9609-c9a77ebd7cfe",
												"exec": [
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"",
													"pm.test(\"Returns 0 patients\", () =>{",
													"    pm.expect(patient().getTotalNumberOfPatients()).to.equal(0);",
													"})"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "e1d16a93-1692-4692-997e-c5718c7e89bd",
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}",
												"type": "text"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}",
												"type": "text"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?birthdate=2000-01-01&family=Invalidated&gender=female&given=Patient",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "family",
													"value": "Invalidated"
												},
												{
													"key": "gender",
													"value": "female"
												},
												{
													"key": "given",
													"value": "Patient"
												}
											]
										},
										"description": "**NHS Number: 5900006107**\n\n> GIVEN I perform a Search  \nAND that matches one patient\nAND that patient is a invalid patient  \nWHEN I get the response  \nTHEN the invalid patients details are not returned"
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Error Responses",
							"item": [
								{
									"name": "Search invalid ASID - ACCESS_DENIED",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "a8ad71bb-3ba9-4ca5-bff8-e2457f3013bc",
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "1519be88-03b3-4dfd-8618-af35beda47de",
												"exec": [
													"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"",
													"assertThat.statusCodeIs(401)",
													"error.assertCodeIs(\"ACCESS_DENIED\");",
													"error.assertDisplayIs(\"Access Denied - Unauthorised\");",
													"error.assertSeverityIs(\"error\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "123456789"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family=James&birthdate=2000-01-01&given=David&gender=male",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "James"
												},
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "given",
													"value": "David"
												},
												{
													"key": "gender",
													"value": "male"
												}
											]
										},
										"description": "where an invalid ASID is passed into the request Header ACCESS_DENIED is returned"
									},
									"response": []
								},
								{
									"name": "Search invalid query parameters - INVALID_VALUE / INVALID_SEARCH_DATA / ADDITIONAL_PROPERTIES",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.variables.get('testData').forEach(scenario => {",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + scenario.query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, response) {",
													"        pm.test(scenario.name + \": Returns Status code 400 \", () => {",
													"            pm.expect(response.code).to.equal(400);",
													"        });        ",
													"",
													"            pm.test(scenario.name + \": Returns correct FHIR error response\", () => {",
													"            pm.expect(response.json().issue[0].details.coding[0].code).to.eql(scenario.code, 'invalid code');",
													"            pm.expect(response.json().issue[0].details.coding[0].display).to.eql(scenario.display, 'invalid display');",
													"            pm.expect(response.json().issue[0].severity).to.eql(scenario.severity, 'invalid severity');",
													"            pm.expect(response.json().issue[0].details.coding[0].system).to.eql(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\", 'invalid system url');",
													"        });",
													"    });",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
												"exec": [
													"pm.variables.set('testData', data = [",
													"   { name: \"Invalid Max_results value - blank\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - '' in field '_max-results'\",",
													"      severity: \"error\",",
													"      query: '/Patient?_max-results=&gender=male&birthdate=ge2020-02-11&family=le*'},",
													"      ",
													"   { name: \"Invalid Max_results value - 51\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - 51 in field '_max-results'\",",
													"      severity: \"error\",",
													"      query: '/Patient?_max-results=51&gender=male&birthdate=ge2020-02-11&family=le*'},",
													"",
													"   { name: \"Invalid GP Practice format\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - '12*' in field 'general-practitioner'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=James&birthdate=2000-01-01&given=David&gender=male&general-practitioner=12\\*'},",
													"",
													"   { name: \"Invalid Date Of DOD format\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - '01-01-2000' in field 'death-date'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=James&death-date=01-01-2000&given=David&gender=male'},",
													"",
													"    { name: \"Invalid Date Of DOB format\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - '01-01-2000' in field 'birthdate'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=James&birthdate=01-01-2000&given=David&gender=male'},",
													"",
													"    { name: \"Special characters in query parameter values such as family\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'name.family'\",",
													"      severity: \"error\",",
													"      query: '/Patient?_fuzzy-match=true&family=%$James&birthdate=2000-01-01&given=David&gender=male'},",
													"",
													"    { name: \"Special characters in query parameter values such as given\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'name.given'\",",
													"      severity: \"error\",",
													"      query: '/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=%$David&gender=male'},",
													"      ",
													"    { name: \"Special characters in option based values such as gender\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - 'male$' in field 'gender'\",",
													"      severity: \"error\",",
													"      query: '/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=David&gender=male$'},",
													"      ",
													"    { name: \"Special characters in option based values such as postcode\", ",
													"      code: \"INVALID_VALUE\",",
													"      display: \"Invalid value - 'BD$ 2NB' in field 'address-postcode'\",",
													"      severity: \"error\",",
													"      query: '/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=David&gender=male&address-postcode=BD$ 2NB'},",
													"      ",
													"    { name: \"Special characters in new unsupported fields\", ",
													"      code: \"ADDITIONAL_PROPERTIES\", ",
													"      display: \"Invalid update with error - Additional properties are not allowed ('somethingnew' was unexpected)\",",
													"      severity: \"error\",",
													"      query: '/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=David&gender=male&somethingnew=fda'},",
													"      ",
													"]);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=David&gender=male$",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_fuzzy-match",
													"value": "true"
												},
												{
													"key": "family",
													"value": "James"
												},
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "given",
													"value": "David"
												},
												{
													"key": "gender",
													"value": "male$"
												}
											]
										},
										"description": "##### Scenarios Tested\n- Invalid characters in Max_results\n- Invalid characters in General Practitioner\n- Invalid DOB format\n- Invalid DOD format\n- Special characters in option based values such as gender\n- Special characters in option based values such as postcode\n- Special characters in query parameter values such as family\n- Special characters in new unsupported fields\n\n\n\n\n> GIVEN I have a Search query containing special/invalid characters  \nWHEN I perform a Search  \nTHEN I should get the correct FHIR based error response"
									},
									"response": []
								},
								{
									"name": "Security validation is performed before request validation when performing a Search",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
												"exec": [
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.variables.get('testData').forEach(scenario => {",
													"\tlet asidHeader = getAsidHeader(scenario.asid);",
													"\tpm.sendRequest({",
													"\t\turl: pm.environment.get(\"environment\") + '/Patient?' + scenario.query,",
													"\t\tmethod: 'GET',",
													"\t\theader: {",
													"\t\t\tasidHeader,",
													"\t\t\tsessionURIDHeader,",
													"\t\t\tidentityUUIDHeader",
													"\t\t}",
													"\t}, function (err, res) {",
													"\t\tpm.test(scenario.name + \" Returns Status code \" + scenario.expectedStatus, function () {",
													"\t\t\tpm.expect(res.code).to.equal(scenario.expectedStatus, 'invalid response returned');",
													"\t\t});",
													"",
													"\t\tif (scenario.expectedStatus == 400) {",
													"\t\t\tpm.test(scenario.name + \" Returns error code ADDITIONAL_PROPERTIES\", () => {",
													"\t\t\t\tpm.expect(res.json().issue[0].details.coding[0].code).to.equal('ADDITIONAL_PROPERTIES');",
													"\t\t\t});",
													"",
													"\t\t} else {",
													"\t\t\tpm.test(scenario.name + \" Returns error code ACCESS_DENIED\", () => {",
													"\t\t\t\tpm.expect(res.json().issue[0].details.coding[0].code).to.equal('ACCESS_DENIED');",
													"\t\t\t});",
													"\t\t}",
													"\t});",
													"",
													"});",
													"",
													"",
													"function getAsidHeader(type) {",
													"\tlet asid;",
													"\tswitch (type) {",
													"\t\tcase 'valid':",
													"\t\t\tasid = pm.environment.get(\"from_asid\");",
													"\t\t\tbreak;",
													"\t\tcase 'invalid':",
													"\t\t\tasid = '123456789';",
													"\t\t\tbreak;",
													"\t\tcase 'missing':",
													"\t\t\tasid = '';",
													"\t\t\tbreak;",
													"\t}",
													"\t",
													"\treturn {",
													"\t\tkey: pm.globals.get(\"nhsd-asid-header\"),",
													"\t\tvalue: asid",
													"\t}",
													"}"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
												"exec": [
													"pm.variables.set('testData', data = [",
													"    { name: \"Valid ASID and Invalid Search request\", asid: 'valid', query: 'faaaaamily=Smith&given=Jane&gender=female&birthdate=2010-10-22', expectedStatus: 400},",
													"\t{ name: \"Invalid ASID and Invalid Search request\", asid: 'invalid', query: 'family=Smith&givvvvven=Jane&gender=female&birthdate=2010-10-22', expectedStatus: 401},",
													"\t{ name: \"No ASID and Invalid Search request\", asid: 'missing', query: 'family=Smith&given=Jane&gender=female&birthhhhdate=2010-10-22', expectedStatus: 401},",
													"\t{ name: \"No ASID and Valid Search request\", asid: 'missing', query: 'family=Smith&given=Jane&gender=female&birthdate=2010-10-22', expectedStatus: 401}",
													"]);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}",
											"host": [
												"{{environment}}"
											]
										},
										"description": "Security checks should be performed first to prevent information leakage.\n\nValidates when sending requests which have both a invalid asid and search query parameter, validation is performed on the asid first, thus throwing a 401 Unauthorized instead of query param validation i.e. 400 Bad Request"
									},
									"response": []
								},
								{
									"name": "Search unrecognised query parameters - ADDITIONAL_PROPERTIES",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "ae75faaa-4f73-4912-b1a8-f673aad43a4c",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"eval(pm.globals.get(\"errorMessage\"));",
													"const query = '/Patient?gender=male&birthdate=1925-02-11&family=smith&address-postcode=DN153PP&given=john&death-date=2020-02-11&general-practitioner=V0007'",
													"",
													"let params = [",
													"    { parameter: \"family\", queryParam: 'faamily' },",
													"    { parameter: \"given\", queryParam: 'giveeen' },",
													"    { parameter: \"gender\", queryParam: 'gendr' },",
													"    { parameter: \"birthdate\", queryParam: 'birthdat' },",
													"    { parameter: \"death-date\", queryParam: 'deathdate' },",
													"    { parameter: \"address-postcode\", queryParam: 'address-PostCod' },",
													"    { parameter: \"general-practitioner\", queryParam: 'general-practiner' },            ",
													"]",
													"",
													"params.forEach(p => {",
													"    let query = getQuery(p.parameter, p.queryParam);",
													"    console.log(\"Request url: \" + query);",
													"",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, res) {",
													"        let response = res.json();",
													"        console.log(\"Response: \" + response);",
													"        ",
													"        pm.test('Returns valid error response when misspelling parameter ' + p.parameter, () => {",
													"            pm.expect(response.issue[0].details.coding[0].display).to.equal(getExpectedErrorMessage(p.queryParam));",
													"            pm.expect(response.issue[0].details.coding[0].code).to.equal('ADDITIONAL_PROPERTIES');",
													"            pm.expect(response.issue[0].severity).to.equal('error');",
													"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');",
													"            ",
													"        })",
													"    })",
													"});",
													"",
													"",
													"function getExpectedErrorMessage(param) {",
													"    return 'Invalid update with error - Additional properties are not allowed (\\'' + param + '\\' was unexpected)';",
													"}",
													"",
													"function getQuery(parameter, replaceWith) {",
													"    console.log('Replacing ' + parameter + ' with ' + replaceWith);",
													"    return query.replace(parameter, replaceWith);",
													"}"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=male&birthdate=ge2020-02-11&family=length",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2020-02-11"
												},
												{
													"key": "family",
													"value": "length"
												}
											]
										},
										"description": "Passing in unrecognised search query parameters returns an ADDITIONAL_PROPERTIES error message which highlights which values were unrecognized"
									},
									"response": [
										{
											"name": "EXTRA_VALUE error response",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_max-resultsA=50&gender=male&birthdate=ge2020-02-11&family=le*&_exact-matchB=false&_fuzzy-matchC=true",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_max-resultsA",
															"value": "50"
														},
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "ge2020-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														},
														{
															"key": "_exact-matchB",
															"value": "false"
														},
														{
															"key": "_fuzzy-matchC",
															"value": "true"
														}
													]
												}
											},
											"status": "Bad Request",
											"code": 400,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Thu, 27 Feb 2020 13:31:38 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "625"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"invariant\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"EXTRA_VALUE\",\n                        \"display\": \"Extra value - Additional properties are not allowed ('_exact-matchB', '_fuzzy-matchC', '_max-resultsA' were unexpected)\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": \"1\"\n                    }\n                ]\n            },\n            \"severity\": \"error\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										},
										{
											"name": "Unrecognised search query parameter returns EXTRA_VALUE error",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_max-results=50&gender=male&birthdate=ge2020-02-11&family=le*&_exact-match=false&_fuzzy-match=true&invalidHeader=true&anotherInvalidHeader=false",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_max-results",
															"value": "50"
														},
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "ge2020-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														},
														{
															"key": "_exact-match",
															"value": "false"
														},
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "invalidHeader",
															"value": "true"
														},
														{
															"key": "anotherInvalidHeader",
															"value": "false"
														}
													]
												}
											},
											"status": "Bad Request",
											"code": 400,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Thu, 27 Feb 2020 15:37:53 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "615"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"invariant\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"EXTRA_VALUE\",\n                        \"display\": \"Extra value - Additional properties are not allowed ('invalidHeader', 'anotherInvalidHeader' were unexpected)\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": \"1\"\n                    }\n                ]\n            },\n            \"severity\": \"error\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										}
									]
								},
								{
									"name": "Search query resulting in > max-results - TOO_MANY_MATCHES",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
												"exec": [
													"var response = pm.response.json();",
													"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"",
													"assertThat.statusCodeIs(200);",
													"error.assertCodeIs(\"TOO_MANY_MATCHES\");",
													"error.assertDisplayIs(\"Too Many Matches\");",
													"error.assertSeverityIs(\"information\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_max-results=40&gender=male&birthdate=ge2020-01-11&family=le*",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_max-results",
													"value": "40"
												},
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2020-01-11"
												},
												{
													"key": "family",
													"value": "le*"
												}
											]
										},
										"description": "Search query which matches more patients then the max-results value returns a *TOO_MANY_MATCHES* error"
									},
									"response": []
								},
								{
									"name": "Fuzzy Search 1 character family name - INVALID_SEARCH_DATA",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "fffa160e-e723-4537-8282-3831893f5852",
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "93e28be6-475d-48b0-891e-fb16474ff575",
												"exec": [
													"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"var response = pm.response.json();",
													"",
													"assertThat.statusCodeIs(400);",
													"error.assertCodeIs(\"INVALID_SEARCH_DATA\");",
													"error.assertDisplayIs(\"Invalid search data provided - 'A fuzzy search was requested however the data given did not meet the fuzzy search criteria'\");",
													"error.assertSeverityIs(\"error\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "200000000610"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "1234567890"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "1234567890"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_fuzzy-match=true&family=S*&birthdate=2015-12-15&given=Fuzzy",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_fuzzy-match",
													"value": "true"
												},
												{
													"key": "family",
													"value": "S*"
												},
												{
													"key": "birthdate",
													"value": "2015-12-15"
												},
												{
													"key": "given",
													"value": "Fuzzy"
												}
											]
										},
										"description": "Attempt a _fuzzy_match_ using a family name of 1 character returns _FUZZY_CRITERIA_NOT_MET error"
									},
									"response": [
										{
											"name": "FUZZY_CRITERIA_NOT_MET error message",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "200000000610"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "1234567890"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "1234567890"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=S*&birthdate=2015-12-15&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "S*"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												}
											},
											"status": "Bad Request",
											"code": 400,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Thu, 27 Feb 2020 15:59:27 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "605"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"invalid\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"FUZZY_CRITERIA_NOT_MET\",\n                        \"display\": \"A fuzzy search was requested however the data given did not meet the fuzzy search criteria\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": \"1\"\n                    }\n                ]\n            },\n            \"severity\": \"error\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										},
										{
											"name": "Fuzzy Search invalid search criteria",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "200000000610"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "1234567890"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "1234567890"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=true&family=S*&birthdate=2015-12-15&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "true"
														},
														{
															"key": "family",
															"value": "S*"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												}
											},
											"status": "Bad Request",
											"code": 400,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Thu, 27 Feb 2020 09:05:44 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "599"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"invalid\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"NO_SEARCHES_PERFORMED\",\n                        \"display\": \"No searches were performed as the search criteria did not meet the minimum requirements\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": 1\n                    }\n                ]\n            },\n            \"severity\": \"error\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										}
									]
								},
								{
									"name": "Fuzzy Search wildcarded family - INVALID_SEARCH_DATA",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "fffa160e-e723-4537-8282-3831893f5852",
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "93e28be6-475d-48b0-891e-fb16474ff575",
												"exec": [
													"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"",
													"assertThat.statusCodeIs(400)",
													"error.assertCodeIs(\"INVALID_SEARCH_DATA\");",
													"error.assertDisplayIs(\"Invalid search data provided - 'A fuzzy search was requested however the data given did not meet the fuzzy search criteria'\");",
													"error.assertSeverityIs(\"error\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_fuzzy-match=true&family=Ja\\*&birthdate=2000-01-01&given=David&gender=male",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_fuzzy-match",
													"value": "true"
												},
												{
													"key": "family",
													"value": "Ja\\*"
												},
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "given",
													"value": "David"
												},
												{
													"key": "gender",
													"value": "male"
												}
											]
										},
										"description": "Validates wildcards are not allowed when performing a fuzzy-search"
									},
									"response": []
								},
								{
									"name": "Fuzzy Search Invalid value in fuzzy_match parameter - INVALID_VALUE",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "fffa160e-e723-4537-8282-3831893f5852",
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "93e28be6-475d-48b0-891e-fb16474ff575",
												"exec": [
													"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"var response = pm.response.json();",
													"",
													"assertThat.statusCodeIs(400);",
													"",
													"error.assertCodeIs(\"INVALID_VALUE\");",
													"error.assertDisplayIs(\"Invalid value - 'test' in field '_fuzzy-match'\");",
													"error.assertSeverityIs(\"error\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_fuzzy-match=test&family=Stephen&birthdate=2015-12-15&given=Fuzzy",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_fuzzy-match",
													"value": "test"
												},
												{
													"key": "family",
													"value": "Stephen"
												},
												{
													"key": "birthdate",
													"value": "2015-12-15"
												},
												{
													"key": "given",
													"value": "Fuzzy"
												}
											]
										},
										"description": "Setting the _fuzzy-match_ value to `test` returns a *INVALID_VALUE* error message "
									},
									"response": [
										{
											"name": "fuzzy-match INVALID_VALUE response",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"value": "200000000610"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "1234567890"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "1234567890"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?_fuzzy-match=test&family=Stephen&birthdate=2015-12-15&given=Fuzzy",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_fuzzy-match",
															"value": "test"
														},
														{
															"key": "family",
															"value": "Stephen"
														},
														{
															"key": "birthdate",
															"value": "2015-12-15"
														},
														{
															"key": "given",
															"value": "Fuzzy"
														}
													]
												}
											},
											"status": "Bad Request",
											"code": 400,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Thu, 27 Feb 2020 09:10:09 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "548"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"value\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"INVALID_VALUE\",\n                        \"display\": \"Invalid value - 'test' in field '_fuzzy-match'\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": 1\n                    }\n                ]\n            },\n            \"severity\": \"error\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										}
									]
								},
								{
									"name": "Search Invalid Leading Wildcards - INVALID_SEARCH_DATA",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "422c870a-83c0-4429-af6b-8146a086a5b2",
												"exec": [
													"pm.variables.set('testData', data = [",
													"    { name: \"Invalid leading wildcards on given name\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'name.given'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=Mapping&gender=female&birthdate=2010-01-01&given=S\\*'},",
													"      ",
													"    { name: \"Invalid leading wildcards on given name\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'name.given'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=Mapping&gender=female&birthdate=2010-01-01&given=\\*earch'},",
													"",
													"    { name: \"Invalid leading wildcards on family name\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'name.family'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=\\*apping&gender=female&birthdate=2010-01-01&given=Search'},",
													"      ",
													"    { name: \"Invalid leading wildcards on family name\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'name.family'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=M\\*&gender=female&birthdate=2010-01-01&given=Search'},",
													"",
													"    { name: \"Invalid leading wildcards on address-postcode\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'address.postalCode'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=Mapping&gender=female&birthdate=2010-01-01&given=Search&address-postcode=L\\*'},",
													"",
													"    { name: \"Invalid leading wildcards on address-postcode\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'address.postalCode'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=Mapping&gender=female&birthdate=2010-01-01&given=Search&address-postcode=\\*2AA'},",
													"]);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "f7b3213c-4712-4604-bbf8-8d3cb038e756",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.variables.get('testData').forEach(scenario => {",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + scenario.query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, response) {",
													"        pm.test(scenario.name + \": Returns Status code 400 \", () => {",
													"            pm.expect(response.code).to.equal(400);",
													"        });        ",
													"",
													"            pm.test(scenario.name + \": Returns correct FHIR error response\", () => {",
													"            pm.expect(response.json().issue[0].details.coding[0].code).to.eql(scenario.code, 'invalid code');",
													"            pm.expect(response.json().issue[0].details.coding[0].display).to.eql(scenario.display, 'invalid display');",
													"            pm.expect(response.json().issue[0].severity).to.eql(scenario.severity, 'invalid severity');",
													"            pm.expect(response.json().issue[0].details.coding[0].system).to.eql(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\", 'invalid system url');",
													"        });",
													"    });",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family=Smith&gender=female&birthdate=2010-01-01&given=\\*ane",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "Smith"
												},
												{
													"key": "gender",
													"value": "female"
												},
												{
													"key": "birthdate",
													"value": "2010-01-01"
												},
												{
													"key": "given",
													"value": "\\*ane"
												}
											]
										},
										"description": "Invalid leading wildcards on given name, family name and postcode results in an error response"
									},
									"response": []
								},
								{
									"name": "Fuzzy search invalid combinations - INVALID_SEARCH_DATA",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "fffa160e-e723-4537-8282-3831893f5852",
												"exec": [
													"pm.variables.set('params', params = [",
													"   ",
													"    // Requests missing mandatory parameters required for a fuzzy search",
													"    { parameter: \"DOB & Family\", query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=le', expected: 400 },",
													"    { parameter: \"DOB, Family & PostCode\", query: '/Patient?_fuzzy-match=true&birthdate=2020-02-11&family=leng*&address-postcode=DN16*', expected: 400 },",
													"    { parameter: \"Gender, DOB & Given\", query: '/Patient?_fuzzy-match=true&gender=male&birthdate=2020-02-11&&given=Selena', expected: 400 },",
													"]);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "93e28be6-475d-48b0-891e-fb16474ff575",
												"exec": [
													"var response = pm.response.json();",
													"",
													"let asidHeader = pm.environment.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
													"let params = pm.variables.get('params');",
													"",
													"",
													"params.forEach(p => {",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + p.query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, res) {",
													"        console.log(\"Response for \" + p.parameter, res.json());",
													"",
													"        pm.test(\"Returns Status code \" + p.expected + \" for parameters \" + p.parameter, function () {",
													"            pm.expect(res.code).to.equal(p.expected);",
													"        });",
													"",
													"        if (p.expected === 400) {",
													"            pm.test(\"Returns INVALID_COMBINATION when using parameters \" + p.parameter, () => {",
													"                pm.expect(res.json().issue[0].details.coding[0].code).to.equal('INVALID_SEARCH_DATA', 'invalid code');",
													"                pm.expect(res.json().issue[0].details.coding[0].display).to.equal(\"Invalid search data provided - 'A fuzzy search was requested however the data given did not meet the fuzzy search criteria'\");",
													"                pm.expect(res.json().issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode', 'invalid system link');",
													"                pm.expect(res.json().issue[0].severity).to.equal('error', 'invalid severity');",
													"            });",
													"        }",
													"    });",
													"});"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_fuzzy-match=true&birthdate=2015-12-15&given=FuzzyYYYYYY",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_fuzzy-match",
													"value": "true"
												},
												{
													"key": "birthdate",
													"value": "2015-12-15"
												},
												{
													"key": "given",
													"value": "FuzzyYYYYYY"
												}
											]
										},
										"description": "Validates search parameter combinations for a fuzzy search\n\n- Invalid combinations return a 400 response\n-- DOB & Family\n-- DOB, Family & PostCode\n-- Gender, DOB & Given"
									},
									"response": []
								},
								{
									"name": "Search missing mandatory fields - INVALID_SEARCH_DATA / MISSING_VALUE",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "487725ad-2e84-4d92-81e5-6a613fa5c24c",
												"exec": [
													"pm.variables.set('testData', data = [",
													"    { name: \"missing mandatory fields - Birth\", ",
													"      code: \"MISSING_VALUE\",",
													"      display: \"Missing value - 'birth_date', 'birth_date_range_start' or 'birth_date_range_end' required\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=Mapping&gender=female'},",
													"",
													"    { name: \"missing mandatory fields - Family\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'No searches were performed as the search criteria did not meet the minimum requirements'\",",
													"      severity: \"error\",",
													"      query: '/Patient?gender=female&birthdate=2010-01-01'},",
													"      ",
													"    { name: \"missing mandatory fields - Gender\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'No searches were performed as the search criteria did not meet the minimum requirements'\",",
													"      severity: \"error\",",
													"      query: '/Patient?family=Mapping&birthdate=2010-01-01'},",
													"      ",
													"    { name: \"missing mandatory fields - Family & Gender\", ",
													"      code: \"INVALID_SEARCH_DATA\",",
													"      display: \"Invalid search data provided - 'No searches were performed as the search criteria did not meet the minimum requirements'\",",
													"      severity: \"error\",",
													"      query: '/Patient?birthdate=2010-01-01'},",
													"]);"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "89244a2a-1895-4a75-a470-e73b5fb2f211",
												"exec": [
													"let asidHeader = pm.variables.get(\"asidHeader\");",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.variables.get('testData').forEach(scenario => {",
													"    pm.sendRequest({",
													"        url: pm.environment.get(\"environment\") + scenario.query,",
													"        method: 'GET',",
													"        header: {",
													"            asidHeader,",
													"            sessionURIDHeader,",
													"            identityUUIDHeader",
													"        }",
													"    }, function (err, response) {",
													"        pm.test(scenario.name + \": Returns Status code 400 \", () => {",
													"            pm.expect(response.code).to.equal(400);",
													"        });        ",
													"",
													"            pm.test(scenario.name + \": Returns correct FHIR error response\", () => {",
													"            pm.expect(response.json().issue[0].details.coding[0].code).to.eql(scenario.code, 'invalid code');",
													"            pm.expect(response.json().issue[0].details.coding[0].display).to.eql(scenario.display, 'invalid display');",
													"            pm.expect(response.json().issue[0].severity).to.eql(scenario.severity, 'invalid severity');",
													"            pm.expect(response.json().issue[0].details.coding[0].system).to.eql(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\", 'invalid system url');",
													"        });",
													"    });",
													"});",
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?family=Smith&birthdate=2010-01-01",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "family",
													"value": "Smith"
												},
												{
													"key": "gender",
													"value": "female",
													"disabled": true
												},
												{
													"key": "birthdate",
													"value": "2010-01-01"
												}
											]
										},
										"description": "missing mandatory fields on simple search will result in a 400 error response:\n\n- missing DOB\n- missing Family\n- missing Gender"
									},
									"response": []
								},
								{
									"name": "Search query resulting in >50 patients - TOO_MANY_MATCHES",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
												"exec": [
													"eval(pm.globals.get(\"assertThatUtil\"));",
													"eval(pm.globals.get(\"patient\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"",
													"assertThatUtil().statusCodeIs(200);",
													"error.assertCodeIs(\"TOO_MANY_MATCHES\");",
													"error.assertDisplayIs(\"Too Many Matches\");",
													"error.assertSeverityIs(\"information\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_max-results=50&gender=male&birthdate=ge2019-02-11&family=le*",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_max-results",
													"value": "50"
												},
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2019-02-11"
												},
												{
													"key": "family",
													"value": "le*"
												}
											]
										},
										"description": "Search query which results in over 50 patients being matched, returns a *TOO_MANY_MATCHES* error"
									},
									"response": [
										{
											"name": "TOO_MANY_MATCHES error message",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "200000000610"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "1234567890"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "1234567890"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=ge2019-02-11&family=le*",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_max-results",
															"value": "50",
															"disabled": true
														},
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "ge2019-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Wed, 26 Feb 2020 15:52:24 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "538"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "Etag",
													"value": "\"517a1f4fce14f23ea2ef203e8382f9abb2654985\""
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"multiple-matches\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"TOO_MANY_MATCHES\",\n                        \"display\": \"Too Many Matches\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": 1\n                    }\n                ]\n            },\n            \"severity\": \"information\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										}
									]
								},
								{
									"name": "Search query No Match - NO_MATCH",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "6c84e23e-4120-4b5d-9a1d-2de0d010e247",
												"exec": [
													""
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?gender=male&birthdate=ge2019-02-11&family=Smith",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "birthdate",
													"value": "ge2019-02-11"
												},
												{
													"key": "family",
													"value": "Smith"
												}
											]
										},
										"description": "Search query which results in over 50 patients being matched, returns a *TOO_MANY_MATCHES* error"
									},
									"response": [
										{
											"name": "TOO_MANY_MATCHES error message",
											"originalRequest": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "200000000610"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "1234567890"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "1234567890"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient?gender=male&birthdate=ge2019-02-11&family=le*",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient"
													],
													"query": [
														{
															"key": "_max-results",
															"value": "50",
															"disabled": true
														},
														{
															"key": "gender",
															"value": "male"
														},
														{
															"key": "birthdate",
															"value": "ge2019-02-11"
														},
														{
															"key": "family",
															"value": "le*"
														}
													]
												}
											},
											"status": "OK",
											"code": 200,
											"_postman_previewlanguage": "json",
											"header": [
												{
													"key": "Server",
													"value": "nginx"
												},
												{
													"key": "Date",
													"value": "Wed, 26 Feb 2020 15:52:24 GMT"
												},
												{
													"key": "Content-Type",
													"value": "application/json"
												},
												{
													"key": "Content-Length",
													"value": "538"
												},
												{
													"key": "Connection",
													"value": "keep-alive"
												},
												{
													"key": "Etag",
													"value": "\"517a1f4fce14f23ea2ef203e8382f9abb2654985\""
												}
											],
											"cookie": [],
											"body": "{\n    \"issue\": [\n        {\n            \"code\": \"multiple-matches\",\n            \"details\": {\n                \"coding\": [\n                    {\n                        \"code\": \"TOO_MANY_MATCHES\",\n                        \"display\": \"Too Many Matches\",\n                        \"system\": \"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\",\n                        \"version\": 1\n                    }\n                ]\n            },\n            \"severity\": \"information\"\n        }\n    ],\n    \"resourceType\": \"OperationOutcome\"\n}"
										}
									]
								},
								{
									"name": "Performing a fuzzy search in combination with a histroic search returns INVALID_SEARCH_DATA",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"id": "846431cc-1b36-4cfe-83e7-ba25a28404ab",
												"exec": [
													"// Send request with _fuzzy-match=false to make sure no patients are returned",
													"pm.sendRequest({",
													"    url: pm.environment.get(\"environment\") + '/Patient?_fuzzy-match=false&family=James&birthdate=2000-01-01&given=David&gender=male',",
													"    method: 'GET',",
													"    header: {",
													"            'NHSD-ASID': pm.environment.get(\"from_asid\"),",
													"            'NHSD-Session-URID': pm.environment.get(\"role_id\"),",
													"            'NHSD-Identity-UUID': pm.environment.get(\"user_id\")",
													"    }",
													"}, function (err, res) {",
													"    pm.test('@Before: fuzzy-match set to false returns 0 patients', () => {",
													"        console.log('@Before Request: ' + JSON.stringify(res.json()));",
													"        pm.expect(res.json().total).to.equal(0);",
													"    });",
													"});"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"id": "313fe5e8-b7d6-41a2-a834-3a67cecb79ca",
												"exec": [
													"var response = pm.response.json();",
													"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));",
													"const error = eval(pm.globals.get(\"errorMessage\"));",
													"",
													"assertThat.statusCodeIs(400);",
													"error.assertCodeIs(\"INVALID_SEARCH_DATA\");",
													"error.assertDisplayIs(\"Invalid search data provided - 'Performing a historic search and a fuzzy search at the same time is incompatible'\");",
													"error.assertSeverityIs(\"error\");",
													"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient?_fuzzy-match=true&family=James&birthdate=2000-01-01&given=David&gender=male&_history=true",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient"
											],
											"query": [
												{
													"key": "_fuzzy-match",
													"value": "true"
												},
												{
													"key": "family",
													"value": "James"
												},
												{
													"key": "birthdate",
													"value": "2000-01-01"
												},
												{
													"key": "given",
													"value": "David"
												},
												{
													"key": "gender",
													"value": "male"
												},
												{
													"key": "_history",
													"value": "true"
												}
											]
										},
										"description": "Performing a fuzzy-search in conjunction with a historic search returns a 400 BAD REQUEST with the error INVALID_SEARCH_DATA"
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Retrieve",
					"item": [
						{
							"name": "Error Responses",
							"item": [
								{
									"name": "Retrieve Patient - Error Responses",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
												"exec": [
													"/*assign local scenario variable from \"scenario\" variable set in prerequisite script and also assign header variables from variables*/\r",
													"\r",
													"let scenario = pm.variables.get('scenario');\r",
													"let asidHeader = pm.variables.get(\"asidHeader\");\r",
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");\r",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");\r",
													"\r",
													"/*for each scenario dataSet loop the Retrieve Patient service and ensure the correct Error Reponse is returned for each scenario*/   \r",
													"\r",
													"  scenario.forEach(s => {\r",
													"    console.log(\"scenario under test is: \" + s.desc);\r",
													"\r",
													"   pm.sendRequest({\r",
													"        url: pm.environment.get(\"environment\") + \"/Patient/\" + s.nhs_id,\r",
													"        method: 'GET',\r",
													"        header: { asidHeader, sessionURIDHeader, identityUUIDHeader }\r",
													"        \r",
													"    }, function (err, res) {\r",
													"        let response = res.json();\r",
													"        pm.test('The correct error response has been returned for: ' + s.desc, () => {\r",
													"            pm.expect(res.code).to.equal(s.responseStatus);\r",
													"            pm.expect(response.issue[0].details.coding[0].display).to.equal(s.responseDisplay);\r",
													"            pm.expect(response.issue[0].details.coding[0].code).to.equal(s.responseCode);\r",
													"            pm.expect(response.issue[0].severity).to.equal(s.responseSeverity);\r",
													"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');\r",
													"            \r",
													"        })\r",
													"    })\r",
													"\r",
													"});\r",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
												"exec": [
													"/*Create dataSets for testing 'Retrieve Patient' Error Exceptions scenarios and assign the \"scenario\" array to a variable to be used in Test*/ \r",
													"  \r",
													"   let scenario = [\r",
													"       {desc: \"INVALIDATED_RESOURCE - invalidated NHS number (sensetive patient)\",  \r",
													"        nhs_id: \"5900006107\", \r",
													"        responseStatus: 404, \r",
													"        responseIssueCode: \"value\", \r",
													"        responseSeverity: \"error\", \r",
													"        responseCode: \"INVALIDATED_RESOURCE\", \r",
													"        responseDisplay: \"Resource that has been marked as invalid was requested - invalid resources cannot be retrieved\"},\r",
													"        \r",
													"       {desc: \"INVALID_NHS_NUMBER - invalid check digit\",  \r",
													"        nhs_id: \"9000000000\", \r",
													"        responseStatus: 400, \r",
													"        responseIssueCode: \"value\", \r",
													"        responseSeverity: \"error\", \r",
													"        responseCode: \"INVALID_RESOURCE_ID\", \r",
													"        responseDisplay: \"Resource Id is invalid\"},\r",
													"        \r",
													"       {desc: \"INVALID_NHS_NUMBER - too short\", \r",
													"        nhs_id: \"900000000\", \r",
													"        responseStatus: 400, \r",
													"        responseIssueCode: \"value\", \r",
													"        responseSeverity: \"error\", \r",
													"        responseCode: \"INVALID_RESOURCE_ID\", \r",
													"        responseDisplay: \"Resource Id is invalid\"},\r",
													"        \r",
													"      {desc: \"PATIENT_NOT_FOUND - NHS Number Does Not Exist\", \r",
													"        nhs_id: \"9111231130\", \r",
													"        responseStatus: 404, \r",
													"        responseIssueCode: \"not-found\", \r",
													"        responseSeverity: \"information\", \r",
													"        responseCode: \"RESOURCE_NOT_FOUND\", \r",
													"        responseDisplay: \"Resource not found\"},\r",
													"        \r",
													"        {desc: \"INVALID_NHS_NUMBER - not passed in\", \r",
													"        nhs_id: \"\", \r",
													"        responseStatus: 400, \r",
													"        responseIssueCode: \"processing\", \r",
													"        responseSeverity: \"error\", \r",
													"        responseCode: \"UNSUPPORTED_SERVICE\", \r",
													"        responseDisplay: \"Unsupported Service\"},\r",
													"        \r",
													"       {desc: \"RETRIEVAL_UNSUPPORTED\", \r",
													"        nhs_id: \"9111231130/nationality\", \r",
													"        responseStatus: 400, \r",
													"        responseIssueCode: \"processing\", \r",
													"        responseSeverity: \"error\", \r",
													"        responseCode: \"UNSUPPORTED_SERVICE\", \r",
													"        responseDisplay: \"Unsupported Service\"},\r",
													"        \r",
													"       {desc: \"INVALIDATED_NHS_NUMBER\", nhs_id: \"5900006107\", \r",
													"        responseStatus: 404, \r",
													"        responseIssueCode: \"processing\", \r",
													"        responseSeverity: \"error\", \r",
													"        responseCode: \"INVALIDATED_RESOURCE\", \r",
													"        responseDisplay: \"Resource that has been marked as invalid was requested - invalid resources cannot be retrieved\"} \r",
													"       ]\r",
													"       \r",
													"    pm.variables.set('scenario', scenario); "
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient/:nhs_id",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient",
												":nhs_id"
											],
											"variable": [
												{
													"id": "2aea25ad-db20-4934-aa43-c144030b87c5",
													"key": "nhs_id",
													"value": "{{nshID}}",
													"type": "string"
												}
											]
										},
										"description": "Invalid Retrieve Patient calls shall result in a valid Error Response"
									},
									"response": []
								},
								{
									"name": "Security validation is performed before request validation when performing a Retrieve",
									"event": [
										{
											"listen": "test",
											"script": {
												"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
												"exec": [
													"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");",
													"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");",
													"",
													"pm.variables.get('testData').forEach(scenario => {",
													"\tlet asidHeader = getAsidHeader(scenario.asid);",
													"\tpm.sendRequest({",
													"\t\turl: pm.environment.get(\"environment\") + '/Patient/' + scenario.nhsNumber,",
													"\t\tmethod: 'GET',",
													"\t\theader: {",
													"\t\t\tasidHeader,",
													"\t\t\tsessionURIDHeader,",
													"\t\t\tidentityUUIDHeader",
													"\t\t}",
													"\t}, function (err, res) {",
													"\t\tpm.test(scenario.name + \" Returns Status code \" + scenario.expectedStatus, function () {",
													"\t\t\tpm.expect(res.code).to.equal(scenario.expectedStatus, 'invalid response returned');",
													"\t\t});",
													"",
													"\t\tif (scenario.expectedStatus == 400) {",
													"\t\t\tpm.test(scenario.name + \" Returns error code INVALID_RESOURCE_ID\", () => {",
													"\t\t\t\tpm.expect(res.json().issue[0].details.coding[0].code).to.equal('INVALID_RESOURCE_ID');",
													"\t\t\t});",
													"",
													"\t\t} else {",
													"\t\t\tpm.test(scenario.name + \" Returns error code ACCESS_DENIED\", () => {",
													"\t\t\t\tpm.expect(res.json().issue[0].details.coding[0].code).to.equal('ACCESS_DENIED');",
													"\t\t\t});",
													"\t\t}",
													"\t});",
													"",
													"});",
													"",
													"",
													"function getAsidHeader(type) {",
													"\tlet asid;",
													"\tswitch (type) {",
													"\t\tcase 'valid':",
													"\t\t\tasid = pm.environment.get(\"from_asid\");",
													"\t\t\tbreak;",
													"\t\tcase 'invalid':",
													"\t\t\tasid = '123456789';",
													"\t\t\tbreak;",
													"\t\tcase 'missing':",
													"\t\t\tasid = '';",
													"\t\t\tbreak;",
													"\t}",
													"\t",
													"\treturn {",
													"\t\tkey: pm.globals.get(\"nhsd-asid-header\"),",
													"\t\tvalue: asid",
													"\t}",
													"}"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
												"exec": [
													"pm.variables.set('testData', data = [",
													"    { name: \"Valid ASID and Invalid NHS Number\", asid: 'valid', nhsNumber: '1234', expectedStatus: 400},",
													"\t{ name: \"Invalid ASID and Invalid NHS Number\", asid: 'invalid', nhsNumber: '1234', expectedStatus: 401},",
													"\t{ name: \"No ASID and Invalid NHS Number\", asid: 'missing', nhsNumber: '1234', expectedStatus: 401},",
													"\t{ name: \"No ASID and Valid NHS Number\", asid: 'missing', nhsNumber: '5900014061', expectedStatus: 401}",
													"]);"
												],
												"type": "text/javascript"
											}
										}
									],
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "{{nhsd-asid-header}}",
												"type": "text",
												"value": "{{from_asid}}"
											},
											{
												"key": "{{nhsd-session-urid-header}}",
												"type": "text",
												"value": "{{role_id}}"
											},
											{
												"key": "{{nhsd-identity-uuid-header}}",
												"type": "text",
												"value": "{{user_id}}"
											}
										],
										"url": {
											"raw": "{{environment}}/Patient/1234",
											"host": [
												"{{environment}}"
											],
											"path": [
												"Patient",
												"1234"
											]
										},
										"description": "Security checks should be performed first to prevent information leakage.\n\nValidates when sending a request which has both an invalid asid and nhs number, validation is performed on the asid first, thus throwing a 401 Unauthorized instead of a\nnhs number validation error (400 Bad Request)"
									},
									"response": []
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Retrieve Patient - Happy path 1",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
											"pm.variables.set(\"nameType\", \"Usual name\");",
											"pm.variables.set(\"namePeriodStart\", \"2020-03-05\");",
											"pm.variables.set(\"given\", [\"Search\", \"Again\"]);",
											"pm.variables.set(\"family\", \"Mapping\");",
											"pm.variables.set(\"prefix\", \"Dame\");",
											"pm.variables.set(\"suffix\", [\"MBA\", \"PHD\"]);",
											"pm.variables.set(\"gender\", \"female\");",
											"pm.variables.set(\"birthdate\", \"2010-01-01\");",
											"pm.variables.set(\"deceasedDateTime\", \"2015-03-02\");",
											"pm.variables.set(\"addressLine\", JSON.stringify([\"1\", \"westwood\", \"ecclechill\", \"bradfordian\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-02-24\");",
											"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
											"pm.variables.set(\"addressType\", \"usual\");",
											"pm.variables.set(\"telecomType\", \"telephone\");",
											"pm.variables.set(\"telecomUse\", \"home\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-24\");",
											"pm.variables.set(\"telecomValue\", \"07900000000\");",
											"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
											"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"2020-02-27\");",
											"pm.variables.set(\"nominatedPharmacy\", \"FH895\");",
											"pm.variables.set(\"nominatedPharmacyPeriodStart\", \"2020-03-12\");",
											"pm.variables.set(\"nominatedPharmacyPeriodEnd\", \"2020-04-12\");",
											"pm.variables.set(\"dispensingDoctor\", \"C81621\");",
											"pm.variables.set(\"dispensingDoctorPeriodStart\", \"2020-03-06\");",
											"pm.variables.set(\"medicalApplianceSupplier\", \"FYR20\");",
											"pm.variables.set(\"medicalApplianceSupplierPeriodStart\", \"2020-03-06\");",
											"pm.variables.set(\"language\", \"ab\");",
											"pm.variables.set(\"languageDisplay\", \"Abkhazian\");",
											"pm.variables.set(\"interpreter\", false);",
											"pm.variables.set(\"patientId\", \"5900009068\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"id": "3461d46c-da29-4138-a3db-16a73270be57",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Dame\" = PDS Fhir \"Dame\"\n* suffix\n* nameUse - specifically Spine nameType \"Usual name\" = PDS Fhir nameUse \"usual\"\n* namePeriodStart\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - specifically Spine addressType \"usual\" = PDS Fhir addresUse \"home\"\n* postCode\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\n* telecomUse - specifically Spine telecomUse \"home\" = PDS Fhir telecomUse \"home\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient\n* Nominated Pharmacy - if present for Patient\n* Medical Appliance Supplier - if present for Patient\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 2",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"pm.variables.set(\"nameType\", \"alias\");",
											"pm.variables.set(\"family\", \"Alias\");",
											"pm.variables.set(\"gender\", \"male\");",
											"pm.variables.set(\"birthdate\", \"1990-10-10\");",
											"pm.variables.set(\"prefix\", \"Dr\");",
											"pm.variables.set(\"addressType\", \"work\");",
											"pm.variables.set(\"telecomType\", \"fax\");",
											"pm.variables.set(\"telecomUse\", \"work\");",
											"pm.variables.set(\"given\", [\"John\"]);",
											"pm.variables.set(\"suffix\", undefined);",
											"pm.variables.set(\"namePeriodStart\", \"2020-03-02\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"130 Greenhouse Lane\",\"Work Road\",\"Roundhay\",\"Leeds\",\"WEST YORKSHIRE\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2019-01-10\");",
											"pm.variables.set(\"addressPeriodEnd\", \"2020-11-10\");",
											"pm.variables.set(\"postalCode\", \"LS18 4AD\");",
											"pm.variables.set(\"patientId\", \"5900007820\");",
											"pm.variables.set(\"metaVersionId\", \"21\");",
											"pm.variables.set(\"resourceType\", \"Patient\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-26\");",
											"pm.variables.set(\"telecomValue\", \"2342424234\");",
											"pm.variables.set(\"generalPractitionerValue\", \"B86055\");",
											"pm.variables.set(\"generalPractitionerPeriodStart\", \"2020-02-28\");",
											"pm.variables.set(\"generalPractitionerPeriodEnd\", \"2020-04-29\");",
											"pm.variables.set(\"nominatedPharmacy\", \"FH895\");",
											"pm.variables.set(\"nominatedPharmacyPeriodStart\", \"2020-03-12\");",
											"pm.variables.set(\"nominatedPharmacyPeriodEnd\", \"2020-04-12\");",
											"pm.variables.set(\"dispensingDoctor\", \"C81621\");",
											"pm.variables.set(\"dispensingDoctorPeriodStart\", \"2020-03-06\");",
											"pm.variables.set(\"medicalApplianceSupplier\", \"FYR20\");",
											"pm.variables.set(\"medicalApplianceSupplierPeriodStart\", \"2020-03-06\");",
											"pm.variables.set(\"patientId\", \"5900007820\");",
											"pm.variables.set(\"language\", \"en\");",
											"pm.variables.set(\"languageDisplay\", \"English\");",
											"pm.variables.set(\"interpreter\", false);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Dr\" = PDS Fhir \"Dr\"\n* suffix\n* nameUse - specifically Spine nameType \"alias\" = PDS Fhir nameUse \"nickname\"\n* namePeriodStart\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\n* postCode\n* telecomSystem - specifically Spine telecomType \"fax\" = PDS Fhir telecomSystem \"fax\"\n* telecomUse - specifically Spine telecomUse \"work\" = PDS Fhir telecomUse \"work\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient\n* Nominated Pharmacy - if present for Patient\n* Medical Appliance Supplier - if present for Patient\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 3",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL7 is plugged in*/",
											"",
											"",
											"pm.variables.set(\"nameType\", \"preferred\");",
											"pm.variables.set(\"namePeriodStart\", \"2020-02-26\");",
											"pm.variables.set(\"given\", [\"person\"]);",
											"pm.variables.set(\"family\", \"Unknown\");",
											"pm.variables.set(\"prefix\", \"Lady\");",
											"pm.variables.set(\"gender\", \"not known\");",
											"pm.variables.set(\"birthdate\", \"2001-02-01\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"13 westwood\",\"bradford\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-01-02\");",
											"pm.variables.set(\"postalCode\", undefined);",
											"pm.variables.set(\"addressType\", \"correspondence\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-26\");",
											"pm.variables.set(\"telecomValue\", \"0900000000\");",
											"pm.variables.set(\"telecomType\", \"textphone\");",
											"pm.variables.set(\"telecomUse\", \"pager\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
											"pm.variables.set(\"language\", \"ab\");",
											"pm.variables.set(\"languageDisplay\", \"Abkhazian\");",
											"pm.variables.set(\"interpreter\", true);",
											"pm.variables.set(\"patientId\", \"5900007073\");",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											"",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Lady\" = PDS Fhir \"Lady\"\n* suffix\n* nameUse - specifically Spine nameType \"preferred\" = PDS Fhir nameUse \"usual\"\n* namePeriodStart\n* gender - specifically Spine gender \"not known\" = PDS Fhir nameUse \"unknown\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\n* postCode\n* telecomSystem - specifically Spine telecomType \"textphone\" = PDS Fhir telecomSystem \"pager\"\n* telecomUse - specifically Spine telecomUse \"pager\" = PDS Fhir telecomUse \"mobile\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient\n* Nominated Pharmacy - if present for Patient\n* Medical Appliance Supplier - if present for Patient\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 4",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"pm.variables.set(\"nameType\", \"previous\");",
											"pm.variables.set(\"namePeriodStart\", \"2020-02-26\");",
											"pm.variables.set(\"given\", [\"someone\"]);",
											"pm.variables.set(\"family\", \"previous\");",
											"pm.variables.set(\"prefix\", \"Lord\");",
											"pm.variables.set(\"gender\", \"not specified\");",
											"pm.variables.set(\"birthdate\", \"2008-01-01\");",
											"pm.variables.set(\"addressType\", \"temporary\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"1 Temporary Ave\",\"Temporary Place\",\"Temporary Town\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-04-02\");",
											"pm.variables.set(\"postalCode\", \"BD2 7NT\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-26\");",
											"pm.variables.set(\"telecomValue\", \"a.nhs@nhs.com\");",
											"pm.variables.set(\"telecomType\", \"email\");",
											"pm.variables.set(\"telecomUse\", \"home\");",
											"pm.variables.set(\"patientId\", \"5900019241\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"id": "4361981c-2cf7-454d-9e72-6dbef2ee9804",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\n\n* resourseType\n* patientId\n* identifierExtention\n* metaVersionId\n* nameFamily\n* nameGiven\n* prefix - specifically Spine \"Lord\" = PDS Fhir \"Lord\"\n* suffix\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\n* namePeriodStart\n* gender - specifically Spine gender \"not specified\" = PDS Fhir nameUse \"other\"\n* birthDate\n* deceasedDateTime\n* addressLines\n* addressPeriodStart\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\n* postCode\n* telecomSystem - specifically Spine telecomType \"email\" = PDS Fhir telecomSystem \"email\"\n* telecomUse - specifically Spine telecomUse \"home\" = PDS Fhir telecomUse \"home\"\n* telecomPeriodStart\n* telecomValue\n* deceasedDateTime if - if present for Patient\n* generalPractitionerValue - if present for Patient\n* deathNotificationValueDateTime - if present for Patient\n* Nominated Pharmacy - if present for Patient\n* Medical Appliance Supplier - if present for Patient\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 5",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"",
											"pm.variables.set(\"family\", \"temporary\");",
											"pm.variables.set(\"gender\", \"female\");",
											"pm.variables.set(\"birthdate\", \"2004-03-01\");",
											"pm.variables.set(\"prefix\", \"Miss\");",
											"pm.variables.set(\"nameType\", \"birth\");",
											"pm.variables.set(\"addressType\", \"temporary\");",
											"pm.variables.set(\"telecomType\", \"telephone\");",
											"pm.variables.set(\"telecomUse\", \"mobile\");",
											"pm.variables.set(\"given\", [\"ned\"]);",
											"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"13 Westwood\",\"Eccleshill\",\"Bradford\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
											"pm.variables.set(\"patientId\", \"5900008290\");",
											"pm.variables.set(\"metaVersionId\", \"3\");",
											"pm.variables.set(\"resourceType\", \"Patient\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"telecomValue\", \"09000000000\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Miss\" = PDS Fhir \"Miss\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"female\" = PDS Fhir nameUse \"female\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"mobile\" = PDS Fhir telecomUse \"mobile\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient\r\n* Nominated Pharmacy - if present for Patient\r\n* Medical Appliance Supplier - if present for Patient\r\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 6",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"pm.variables.set(\"prefix\", \"Mr\");",
											"pm.variables.set(\"nameType\", \"bachelor\");",
											"pm.variables.set(\"addressType\", \"usual\");",
											"pm.variables.set(\"telecomType\", \"telephone\");",
											"pm.variables.set(\"telecomUse\", \"temporary\");",
											"pm.variables.set(\"family\", \"Mister\");",
											"pm.variables.set(\"gender\", \"male\");",
											"pm.variables.set(\"birthdate\", \"2009-01-01\");",
											"pm.variables.set(\"given\", [\"Any\"]);",
											"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"17 Westwood Avenue\",\"Eccleshill\",\"Bradford\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
											"pm.variables.set(\"patientId\", \"5900005798\");",
											"pm.variables.set(\"metaVersionId\", \"3\");",
											"pm.variables.set(\"resourceType\", \"Patient\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"telecomValue\", \"0900000000\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"id": "5e5d2ead-b483-49d8-80e9-8e8164634903",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Mr\" = PDS Fhir \"Mr\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"male\" = PDS Fhir nameUse \"male\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"temporary\" = PDS Fhir telecomUse \"temp\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient\r\n* Nominated Pharmacy - if present for Patient\r\n* Medical Appliance Supplier - if present for Patient\r\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 7",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"pm.variables.set(\"prefix\", \"Mrs\");",
											"pm.variables.set(\"nameType\", \"maiden\");",
											"pm.variables.set(\"addressType\", \"usual\");",
											"pm.variables.set(\"telecomType\", \"telephone\");",
											"pm.variables.set(\"telecomUse\", \"Answering Machine\");",
											"pm.variables.set(\"family\", \"Answermachine\");",
											"pm.variables.set(\"gender\", \"not known\");",
											"pm.variables.set(\"birthdate\", \"2007-01-01\");",
											"pm.variables.set(\"given\", [\"another\"]);",
											"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"27 Westwood Avenue\",\"Eccleshill\",\"Bradford\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"postalCode\", \"BD2 2NJ\");",
											"pm.variables.set(\"patientId\", \"5900000605\");",
											"pm.variables.set(\"metaVersionId\", \"5\");",
											"pm.variables.set(\"resourceType\", \"Patient\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"telecomValue\", \"09234567\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"id": "a8217d8d-56cf-4c26-a5a2-ed8edce6e0b4",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "work in progress.  This test shall cover a Happy path Retrieve scenario.  It currently asserts on General Practitioner, Pharmicies, Communication & Patient identifier, language.  Other checks shall be added in due course."
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 8",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"pm.variables.set(\"prefix\", \"Ms\");",
											"pm.variables.set(\"nameType\", \"Usual name\");",
											"pm.variables.set(\"addressType\", \"usual\");",
											"pm.variables.set(\"telecomType\", \"telephone\");",
											"pm.variables.set(\"telecomUse\", \"Emergency\");",
											"pm.variables.set(\"family\", \"Emergency\");",
											"pm.variables.set(\"gender\", \"not specified\");",
											"pm.variables.set(\"birthdate\", \"2004-01-01\");",
											"pm.variables.set(\"given\", [\"Emma\"]);",
											"pm.variables.set(\"namePeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"91 Westwood Avenue\",\"Eccleshill\",\"Bradford\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"postalCode\", \"BD2 2LY\");",
											"pm.variables.set(\"patientId\", \"5900013863\");",
											"pm.variables.set(\"metaVersionId\", \"2\");",
											"pm.variables.set(\"resourceType\", \"Patient\");",
											"pm.variables.set(\"telecomPeriodStart\", \"2020-02-27\");",
											"pm.variables.set(\"telecomValue\", \"0900000001\");",
											"pm.variables.set(\"deceasedDateTime\", \"\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"id": "6621d381-1de7-40c9-b34c-528a7ab9ffe4",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* resourseType\r\n* patientId\r\n* identifierExtention\r\n* metaVersionId\r\n* nameFamily\r\n* nameGiven\r\n* prefix - specifically Spine \"Mr\" = PDS Fhir \"Mr\"\r\n* suffix\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* gender - specifically Spine gender \"not specified\" = PDS Fhir nameUse \"other\"\r\n* birthDate\r\n* deceasedDateTime\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* telecomSystem - specifically Spine telecomType \"telephone\" = PDS Fhir telecomSystem \"phone\"\r\n* telecomUse - specifically Spine telecomUse \"Emergency\" = PDS Fhir telecomUse \"home\"\r\n* telecomPeriodStart\r\n* telecomValue\r\n* deceasedDateTime if - if present for Patient\r\n* generalPractitionerValue - if present for Patient\r\n* deathNotificationValueDateTime - if present for Patient\r\n* Nominated Pharmacy - if present for Patient\r\n* Medical Appliance Supplier - if present for Patient\r\n* Communication Language - if present for Patient"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Happy path 9 - Superceded",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "5f6774f4-6032-467f-84b4-1043f7c14a69",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1789ffbf-aaf8-4c8e-9d56-806fd5b9d829",
										"exec": [
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"",
											"pm.variables.set(\"supercededPatientId\", \"5900006360\");",
											"",
											"pm.variables.set(\"nameType\", \"Usual name\");",
											"pm.variables.set(\"addressType\", \"usual\");",
											"pm.variables.set(\"family\", \"Retained\");",
											"pm.variables.set(\"gender\", \"male\");",
											"pm.variables.set(\"birthdate\", \"2006-04-01\");",
											"pm.variables.set(\"given\", [\"Jon\"]);",
											"pm.variables.set(\"namePeriodStart\", \"2020-04-03\");",
											"pm.variables.set(\"addressLine\",JSON.stringify([\"15 Retained Road\",\"Retained\"]));",
											"pm.variables.set(\"addressPeriodStart\", \"2020-04-03\");",
											"pm.variables.set(\"postalCode\", \"BD2 2LK\");",
											"pm.variables.set(\"patientId\", \"5900011143\");",
											"pm.variables.set(\"resourceType\", \"Patient\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "{{from_asid}}"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id"
									],
									"variable": [
										{
											"key": "nhs_id",
											"value": "5900006360",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Demographic data is mapped correctly to the Fhir PDF response, specifically:\r\n\r\n* If the Patient record is marked as Superceded, the response shall return the Retained record for the Patient\r\n* nameUse - specifically Spine nameType \"usual name\" = PDS Fhir nameUse \"official\"\r\n* namePeriodStart\r\n* nameFamily\r\n* nameGiven\r\n* gender - specifically Spine gender \"not specified\" = PDS Fhir nameUse \"other\"\r\n* birthDate\r\n* addressLines\r\n* addressPeriodStart\r\n* addressUse - always returns \"home\" address only even though there may be other address associated with the Patient\r\n* postCode\r\n* resourseType\r\n* patientId\r\n* identifierExtention"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Sensitive",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "309bd3d4-7bfe-413f-99c6-dc84086bdd05",
										"exec": [
											"var response = pm.response.json();",
											"eval(pm.globals.get(\"checkRetrieveMappings\"))();",
											"pm.variables.set(\"s-flagged\", false);"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "a614f542-0c5f-42d0-8190-abce4b8b506a",
										"exec": [
											"pm.variables.set(\"s-flagged\", true);",
											"",
											"/*set variables for checking mapping*/",
											"",
											"/*data variables being checked against.  These shall be replaced by the variables set when HL& is plugged in*/",
											"pm.variables.set(\"nameType\", \"Usual name\");",
											"pm.variables.set(\"addressType\", \"usual\");",
											"pm.variables.set(\"family\", \"sensitive\");",
											"pm.variables.set(\"gender\", \"female\");",
											"pm.variables.set(\"birthdate\", \"2001-02-01\");",
											"pm.variables.set(\"given\", undefined);",
											"pm.variables.set(\"namePeriodStart\", \"2020-04-03\");",
											"pm.variables.set(\"patientId\", \"5900004430\");",
											"pm.variables.set(\"resourceType\", \"Patient\");",
											"pm.variables.set(\"deceasedDateTime\", \"2009-03-01\");",
											"pm.variables.set(\"securityCode\", \"R\");",
											"pm.variables.set(\"deathNotificationValueDateTime\", \"\");",
											"pm.variables.set(\"deathNotificationStatus.display\", \"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\");",
											"pm.variables.set(\"language\", \"be\");",
											"pm.variables.set(\"languageDisplay\", \"Belarusian\");",
											"pm.variables.set(\"interpreter\", true);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/5900004430",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										"5900004430"
									]
								}
							},
							"response": []
						},
						{
							"name": "Retrieve Patient - Date of birth formatting",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d9548ee3-3e3a-4636-a6d5-717fdf15e640",
										"exec": [
											"let testScenarios = pm.variables.get(\"testData\");",
											"let asidHeader = pm.environment.get(\"asidHeader\");",
											"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
											"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
											"",
											"testScenarios.forEach(scenario => {",
											"    pm.sendRequest({",
											"        url: pm.environment.get(\"environment\") + \"/Patient/\" + scenario.nhsNumber,",
											"        method: 'GET',",
											"        header: {",
											"            asidHeader,",
											"            sessionURIDHeader,",
											"            identityUUIDHeader",
											"        }",
											"    }, function (err, res) {",
											"        console.log(\"Response\", res.json());",
											"",
											"        pm.test(scenario.dobFormat, () => {",
											"            pm.expect(res.code).to.equal(200, 'invalid status code');",
											"            pm.expect(res.json().id).to.equal(scenario.nhsNumber, 'wrong patient returned');",
											"            pm.expect(res.json().birthDate).to.equal(scenario.expectedDob, 'invalid birthDate');",
											"        });",
											"    });",
											"})",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1e6368be-c077-402a-9b26-e3e898050385",
										"exec": [
											"pm.variables.set(\"testData\", data = [",
											"    {",
											"        dobFormat: \"Date of birth in the format yyyy is returned in the format yyyy\",",
											"        nhsNumber: \"5900017605\",",
											"        expectedDob: \"2000\"",
											"    },",
											"    {",
											"        dobFormat: \"Date of birth in the format yyyyMM is returned in the format yyyyMM\",",
											"        nhsNumber: \"5900010260\",",
											"        expectedDob: \"2000-01\"",
											"    },",
											"    {",
											"        dobFormat: \"Date of birth which is an invalid date means birthDate element is not returned\",",
											"        nhsNumber: \"5900011631\",",
											"        expectedDob: undefined",
											"    },",
											"    {",
											"        dobFormat: \"Date of birth which is in an invalid format means birthDate element is not returned\",",
											"        nhsNumber: \"5900010384\",",
											"        expectedDob: undefined",
											"    },",
											"    {",
											"        dobFormat: \"Date of birth which is empty means birthDate element is not returned\",",
											"        nhsNumber: \"5900015319\",",
											"        expectedDob: undefined",
											"    },",
											"]);",
											"",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "200000001115"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										""
									]
								},
								"description": "Handle patients dates of birth which are in different formats\n\n\n- NHS Number: 5900017605 with DOB as 2000 (yyyy) should display DOB as 2000  \n- NHS Number: 5900010260 with DOB as 2000/01 (yyyyMM), should display DOB as 2000/01  \n- NHS Number: 5900011631 with DOB as 31st Feb, should not display DOB at all  \n- NHS Number: 5900010384 with DOB as 2 (y), should not display DOB at all  \n- NHS Number: 5900015319 with Missing DOB, should not display DOB at all"
							},
							"response": []
						},
						{
							"name": "Retrieve Patient: Date of death formatting",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d9548ee3-3e3a-4636-a6d5-717fdf15e640",
										"exec": [
											"let testScenarios = pm.variables.get(\"testData\");",
											"let asidHeader = pm.environment.get(\"asidHeader\");",
											"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");",
											"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");",
											"",
											"testScenarios.forEach(scenario => {",
											"    pm.sendRequest({",
											"        url: pm.environment.get(\"environment\") + \"/Patient/\" + scenario.nhsNumber,",
											"        method: 'GET',",
											"        header: {",
											"            asidHeader,",
											"            sessionURIDHeader,",
											"            identityUUIDHeader",
											"        }",
											"    }, function (err, res) {",
											"        console.log(\"Response\", res.json());",
											"",
											"        pm.test(scenario.deathDate, () => {",
											"            pm.expect(res.code).to.equal(200, 'invalid http status code');",
											"            pm.expect(res.json().id).to.equal(scenario.nhsNumber, 'wrong patient returned');",
											"            pm.expect(res.json().deceasedDateTime).to.equal(scenario.expectedDeathDate, 'invalid deceasedDateTime');",
											"        });",
											"    });",
											"})",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "1e6368be-c077-402a-9b26-e3e898050385",
										"exec": [
											"pm.variables.set(\"testData\", data = [",
											"    {",
											"        deathDate: \"Death date in the format yyyy means deceasedDateTime is returned in the format yyyy\",",
											"        nhsNumber: \"5900017605\",",
											"        expectedDeathDate: \"2020\"",
											"    },",
											"    {",
											"        deathDate: \"Death date in the format yyyyMM means deceasedDateTime is returned in the format yyyyMM\",",
											"        nhsNumber: \"5900010260\",",
											"        expectedDeathDate: \"2000-01\"",
											"    },",
											"    {",
											"        deathDate: \"Death date which is an invalid date means deceasedDateTime element is not returned\",",
											"        nhsNumber: \"5900011631\",",
											"        expectedDeathDate: undefined",
											"    },",
											"    {",
											"        deathDate: \"Death date which is an invalid format means deceasedDateTime element is not returned\",",
											"        nhsNumber: \"5900010384\",",
											"        expectedDeathDate: undefined",
											"    },",
											"    {",
											"        deathDate: \"Death date which is empty means deceasedDateTime element is not returned\",",
											"        nhsNumber: \"5900015319\",",
											"        expectedDeathDate: undefined",
											"    },",
											"    {",
											"        deathDate: \"Death date which contains an invalid time means deceasedDateTime element is not returned\",",
											"        nhsNumber: \"5900008142\",",
											"        expectedDeathDate: undefined",
											"    }",
											"]);",
											"",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "{{nhsd-asid-header}}",
										"type": "text",
										"value": "200000001115"
									},
									{
										"key": "{{nhsd-session-urid-header}}",
										"type": "text",
										"value": "{{role_id}}"
									},
									{
										"key": "{{nhsd-identity-uuid-header}}",
										"type": "text",
										"value": "{{user_id}}"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/5900008142 ",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										"5900008142 "
									]
								},
								"description": "Handle patients death date which could be in a different format\n\n- NHS Number: 5900017605 with Death date as 2000 (yyyy) should display Death date as 2000  \n- NHS Number: 5900010260 with Death date as as 2000/01 (yyyyMM)  \n- NHS Number: 5900011631 with Death date as 31st Feb, should not display Death date at all  \n- NHS Number: 5900010384 with Death date as 2 (y), should not display Death date at all  \n- NHS Number: 5900015319 with Missing Death date, should not display Death date at all  \n- NHS Number: 5900008142 with Invalid time for death date, should not display Death date at all"
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Update",
					"item": [
						{
							"name": "Update DOB",
							"item": [
								{
									"name": "Happy Path",
									"item": [
										{
											"name": "Update - DOB before original DOB",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "bc076a6a-1feb-4387-88a0-10094fcdde1b",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*set new birthdate to day before original*/\r",
															"\r",
															"var d = new Date(pm.variables.get(\"birthDate\"));\r",
															"d.setDate(d.getDate() - 1);\r",
															"var newDate = d.toISOString().substr(0, 10);\r",
															"pm.globals.set(\"newBirthDate\", newDate)\r",
															"console.log(\"New birthdate = \" + pm.globals.get(\"newBirthDate\"))"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "0ab9ef7c-1b08-4e1e-8808-50539f8e4111",
														"exec": [
															"//Check that the Update Response has been populated correctly with new updates\r",
															"const PDSUpdateResponse = eval(pm.globals.get(\"PDSUpdateResponseValidator\"));\r",
															"\r",
															"PDSUpdateResponse.assertDateOfBirthHasBeenUpdated(pm.globals.get(\"newBirthDate\"))\r",
															"PDSUpdateResponse.assertVersionIdHasBeenUpdated()\r",
															"\r",
															"//Send HL7 Retrieve message to check new Date of Birth is persisted\r",
															"eval(pm.globals.get(\"SendHL7RetrievePatientMessage\"))();\r",
															"\r",
															"//Check the HL7 Response has been populated with the new DoB\r",
															"setTimeout(function () {\r",
															"      const HL7response = eval(pm.globals.get(\"HL7ResponseValidator\"));\r",
															"      HL7response.assertHL7DateOfBirthIs(pm.globals.get(\"newBirthDate\").replace(/-/g, ''))\r",
															"}, 3000);\r",
															"\r",
															"//set metaversion variable for next request\r",
															"pm.globals.set(\"metaVersionId\", pm.response.headers.get('Etag'));\r",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"content-type": true
												}
											},
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"value": "{{metaVersionId}}",
														"type": "text"
													},
													{
														"key": "Content-Type",
														"value": "application/json-patch+json",
														"type": "text"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"{{newBirthDate}}\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "7f0b479a-2f10-4ec3-997f-e9511d313aa3",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB where the new DoB is earlier than the current DoB and check that the new DoB exist on the Patient record."
											},
											"response": []
										},
										{
											"name": "Update - DOB after original DOB",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "06724de0-f792-401f-8e28-c57d49c1c262",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*set new birthdate to day after original*/\r",
															"\r",
															"var d = new Date(pm.variables.get(\"birthDate\"));\r",
															"d.setDate(d.getDate() + 1);\r",
															"var newDate = d.toISOString().substr(0, 10);\r",
															"pm.globals.set(\"newBirthDate\", newDate)\r",
															"console.log(\"New birthdate = \" + pm.globals.get(\"newBirthDate\"))"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "47374c86-da2d-41ae-825a-969ae078512e",
														"exec": [
															"//Check that the Update Response has been populated correctly with new updates\r",
															"const PDSUpdateResponse = eval(pm.globals.get(\"PDSUpdateResponseValidator\"));\r",
															"\r",
															"PDSUpdateResponse.assertDateOfBirthHasBeenUpdated(pm.globals.get(\"newBirthDate\"))\r",
															"PDSUpdateResponse.assertVersionIdHasBeenUpdated()\r",
															"\r",
															"//Send HL7 Retrieve message to check new Date of Birth is persisted\r",
															"eval(pm.globals.get(\"SendHL7RetrievePatientMessage\"))();\r",
															"\r",
															"//Check the HL7 Response has been populated with the new DoB\r",
															"setTimeout(function () {\r",
															"      const HL7response = eval(pm.globals.get(\"HL7ResponseValidator\"));\r",
															"      HL7response.assertHL7DateOfBirthIs(pm.globals.get(\"newBirthDate\").replace(/-/g, ''))\r",
															"}, 3000);\r",
															"\r",
															"//set metaversion variable for next request\r",
															"pm.globals.set(\"metaVersionId\", pm.response.headers.get('Etag'));"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"{{newBirthDate}}\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "afc05406-687d-4ed9-8940-6b2d4d36dbdb",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB where the new DoB is later than the current DoB and check that the new DoB exist on the Patient record."
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Error Responses",
									"item": [
										{
											"name": "Update - DOB cannot be after the DOD",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "b3a8a016-1654-4b50-b275-bbb0df4a2dbf",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*Send a PDS Update with Date of Death & Death Notification - Date of Death = 2020-01-01*/\r",
															"setTimeout(function () {\r",
															"    var Header = require('postman-collection').Header;\r",
															"    let asidHeader = pm.environment.get(\"asidHeader\");\r",
															"    let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
															"    let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
															"    let authorization = pm.environment.get(\"authorizationHeader\");\r",
															"    let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
															"    let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
															"    let deathNotification = pm.globals.get(\"deathNotification\");\r",
															"\r",
															"\r",
															"    pm.sendRequest({\r",
															"        url: pm.environment.get(\"environment\") + '/Patient/' + pm.globals.get(\"nhsID\"),\r",
															"        method: 'PATCH',\r",
															"        header: {\r",
															"            authorization,\r",
															"            asidHeader,\r",
															"            sessionURIDHeader,\r",
															"            identityUUIDHeader,\r",
															"            contentType,\r",
															"            ifMatch\r",
															"        },\r",
															"        body: deathNotification\r",
															"\r",
															"    }, function (err, response) {\r",
															"        pm.test(\"Returns Status code 200\", function () {\r",
															"            pm.expect(response.code).to.equal(200);\r",
															"        });\r",
															"        pm.globals.set(\"metaVersionId\", response.headers.get('Etag'));\r",
															"    });\r",
															"}, 9000);\r",
															"pm.globals.set(\"newBirthDate\", \"2020-01-02\")"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "949447e6-3cd3-4667-aaf8-6f06cce1810f",
														"exec": [
															"var response = pm.response.json();\r",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
															"const error = eval(pm.globals.get(\"errorMessage\"));\r",
															"\r",
															"assertThat.statusCodeIs(400);\r",
															"error.assertCodeIs(\"INVALID_UPDATE\");\r",
															"error.assertDisplayIs(\"Invalid update with error - birth date cannot be after the deceased date\");\r",
															"error.assertSeverityIs(\"error\");\r",
															"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"{{newBirthDate}}\"}\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "aede8b94-0676-4d59-a1c6-f9cd12ee4cc8",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB remove is not permitted and will result in an error response"
											},
											"response": []
										},
										{
											"name": "Update - DOB mismatch on patient record versionid",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "0122bd8a-c53b-4038-9902-1daf4ec0eb7c",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*Send a PDS Update with Date of Death & Death Notification - Date of Death = 2020-01-01*/\r",
															"setTimeout(function () {\r",
															"    var Header = require('postman-collection').Header;\r",
															"    let asidHeader = pm.environment.get(\"asidHeader\");\r",
															"    let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
															"    let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
															"    let authorization = pm.environment.get(\"authorizationHeader\");\r",
															"    let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
															"    let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
															"    let deathNotification = pm.globals.get(\"deathNotification\");\r",
															"\r",
															"\r",
															"    pm.sendRequest({\r",
															"        url: pm.environment.get(\"environment\") + '/Patient/' + pm.globals.get(\"nhsID\"),\r",
															"        method: 'PATCH',\r",
															"        header: {\r",
															"            authorization,\r",
															"            asidHeader,\r",
															"            sessionURIDHeader,\r",
															"            identityUUIDHeader,\r",
															"            contentType,\r",
															"            ifMatch\r",
															"        },\r",
															"        body: deathNotification\r",
															"\r",
															"    }, function (err, response) {\r",
															"        pm.test(\"Returns Status code 200\", function () {\r",
															"            pm.expect(response.code).to.equal(200);\r",
															"        });\r",
															"        pm.globals.set(\"metaVersionId\", response.headers.get('Etag'));\r",
															"    });\r",
															"}, 9000);\r",
															"pm.globals.set(\"newBirthDate\", \"2020-01-02\")"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "19b4d8d7-eeab-4bf5-ad6f-0912cb6fc39b",
														"exec": [
															"var response = pm.response.json();\r",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
															"const error = eval(pm.globals.get(\"errorMessage\"));\r",
															"\r",
															"assertThat.statusCodeIs(409);\r",
															"error.assertCodeIs(\"RESOURCE_VERSION_MISMATCH\");\r",
															"error.assertDisplayIs(\"Resource version supplied does not match actual version\");\r",
															"error.assertSeverityIs(\"error\");\r",
															"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "W/\"1\""
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"{{newBirthDate}}\"}\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "b3afcf9c-80f4-4fd4-9a10-7c42ac348ef9",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB where the if-match header is different to the current patient version id will result in an error response"
											},
											"response": []
										},
										{
											"name": "Update - DOB cannot be deleted",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "5390263f-61e2-43af-9e6b-30bca05c6e73",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "c3d9e88e-7657-4155-8545-e15471dffe30",
														"exec": [
															"var response = pm.response.json();\r",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
															"const error = eval(pm.globals.get(\"errorMessage\"));\r",
															"\r",
															"assertThat.statusCodeIs(403);\r",
															"error.assertCodeIs(\"FORBIDDEN_UPDATE\");\r",
															"error.assertDisplayIs(\"Forbidden update with error - source not permitted to remove 'birthDate'\");\r",
															"error.assertSeverityIs(\"information\");\r",
															"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"remove\", \"path\": \"/birthDate\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "824bea1e-0dd9-4e4a-9141-c9cf8661857d",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB remove is not permitted and will result in an error response"
											},
											"response": []
										},
										{
											"name": "Update - DOB with an invalid date format",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "3eece6e3-51ce-4519-ad35-2ead857680df",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "1b736f10-a5bb-4784-b328-dfa044c222f6",
														"exec": [
															"var response = pm.response.json();\r",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
															"const error = eval(pm.globals.get(\"errorMessage\"));\r",
															"\r",
															"assertThat.statusCodeIs(400);\r",
															"error.assertCodeIs(\"INVALID_VALUE\");\r",
															"error.assertDisplayIs(\"Invalid value - '20010101' in field 'birthDate'\");\r",
															"error.assertSeverityIs(\"error\");\r",
															"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"20010101\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "eccd04c5-243f-4c61-b1ac-2973104a9a2f",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB with an invalid format DoB will result in an error"
											},
											"response": []
										},
										{
											"name": "Update - DOB with a malformed Patch",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "b92c4c27-b1d4-48cf-a321-f762d7fae048",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "9b9348f5-bfa8-4a44-926c-fa8267ee8f74",
														"exec": [
															"var response = pm.response.json();\r",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
															"const error = eval(pm.globals.get(\"errorMessage\"));\r",
															"\r",
															"assertThat.statusCodeIs(400);\r",
															"error.assertCodeIs(\"INVALID_UPDATE\");\r",
															"error.assertDisplayIs(\"Invalid update with error - 'birthDate' is not a 'json-pointer'\");\r",
															"error.assertSeverityIs(\"error\");\r",
															"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"birthDate\", \"value\": \"20100101\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "c4ab0e78-f856-431e-9bfc-230f9ceca4d6",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB with a malformed Patch will result in an error"
											},
											"response": []
										},
										{
											"name": "Update - DOB cannot be in the future",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "f9510573-d758-4e92-b55d-9109082ede12",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*set a new birthdate to tomorrow*/\r",
															"var d = new Date();\r",
															"d.setDate(d.getDate() + 1);\r",
															"var newDate = d.toISOString().substr(0, 10);\r",
															"pm.globals.set(\"newBirthDate\", newDate)\r",
															"console.log(\"New birthdate = \" + pm.globals.get(\"newBirthDate\"))"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "38d8d724-eef0-488e-8dce-9cbf567b360d",
														"exec": [
															"var response = pm.response.json();\r",
															"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
															"const error = eval(pm.globals.get(\"errorMessage\"));\r",
															"\r",
															"assertThat.statusCodeIs(400);\r",
															"error.assertCodeIs(\"INVALID_UPDATE\");\r",
															"error.assertDisplayIs(\"Invalid update with error - birth date cannot be in the future\");\r",
															"error.assertSeverityIs(\"error\");\r",
															"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"{{newBirthDate}}\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "05a07800-8edc-430c-8ce5-a3d8c24716e6",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Update DoB remove is not permitted and will result in an error response"
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Demo",
									"item": [
										{
											"name": "Retrieve Patient",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "62d27b79-69ba-42a1-9d88-a8333d0b87ea",
														"exec": [
															"var response = pm.response.json();",
															"pm.globals.set(\"metaVersionId\", pm.response.headers.get('Etag'));",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "5c56224a-9513-4e2a-940c-d250e6b2b1db",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"key": "nhs_id",
															"value": "5900014193",
															"type": "string"
														}
													]
												}
											},
											"response": []
										},
										{
											"name": "Update - DOB",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "e1009488-c6e3-4c79-b165-fc77851d55f9",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "4327840c-36fa-4bb5-88f3-8ad234320eae",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\r\n    \"patches\": [\r\n      { \"op\": \"replace\", \"path\": \"/birthDate\", \"value\": \"2020-05-02\" }\r\n  ]\r\n}\r\n",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"key": "nhs_id",
															"value": "5900014193",
															"type": "string"
														}
													]
												},
												"description": "Update DoB where the new DoB is later than the current DoB and check that the new DoB exist on the Patient record."
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						},
						{
							"name": "Update DoD & Death Notification",
							"item": [
								{
									"name": "Happy Path",
									"item": [
										{
											"name": "Update - Add DOD and Death Notification Informal for Today",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "9dc64924-16d0-451c-abd9-56c956f36e6a",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*set the date of death date*/\r",
															"\r",
															"//set the deathNotification valueDateTimme \r",
															"var date = new Date().toISOString().substr(0, 19);\r",
															"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
															"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
															"\r",
															"//set the date of death date\r",
															"\r",
															"var todayDate = date.substring(0, 10);\r",
															"pm.globals.set(\"dateOfDeath\", todayDate);\r",
															"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))\r",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "95598fc2-a503-4437-9a7c-ae834f4fb8de",
														"exec": [
															"//Check that the Update Response has been populated correctly with new updates\r",
															"const PDSUpdateResponse = eval(pm.globals.get(\"PDSUpdateResponseValidator\"));\r",
															"\r",
															"PDSUpdateResponse.assertDateOfDeathHasBeenUpdated(pm.globals.get(\"dateOfDeath\"))\r",
															"PDSUpdateResponse.assertDeathNotificationHasBeenUpdated()\r",
															"PDSUpdateResponse.assertVersionIdHasBeenUpdated()\r",
															"\r",
															"//Send HL7 Retrieve message \r",
															"eval(pm.globals.get(\"SendHL7RetrievePatientMessage\"))();\r",
															"\r",
															"//Check the HL7 Response has been populated with the new DoD and Death Notification\r",
															"setTimeout(function () {\r",
															"const HL7response = eval(pm.globals.get(\"HL7ResponseValidator\"));\r",
															"      HL7response.assertHL7DateOfDeathIs(pm.globals.get(\"dateOfDeath\").replace(/-/g, ''))\r",
															"      HL7response.assertHL7DeathNotificationDateIs(pm.globals.get(\"deathNotificationDateAndTime\").substr(0, 10).replace(/-/g, ''))\r",
															"      HL7response.assertHL7DeathNotificationIs(\"3\")\r",
															"}, 2000);\r",
															"\r",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"content-type": true
												}
											},
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n\t\"patches\": [\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/deceasedDateTime\",\n\t\t\t\"value\": \"{{dateOfDeath}}\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/extension/-\",\n\t\t\t\"value\": {\n\t\t\t\t\"extension\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"deathNotificationStatus\",\n\t\t\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"code\": \"1\",\n\t\t\t\t\t\t\t\t\t\"display\": \"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\n\t\t\t\t\t\t\t\t\t\"system\": \"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\n\t\t\t\t\t\t\t\t\t\"version\": \"1.0.0\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"systemEffectiveDate\",\n\t\t\t\t\t\t\"valueDateTime\": \"{{deathNotificationDateAndTime}}\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"\n\t\t\t}\n\t\t}\n\t]\n}",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "b3cbbff4-c0cf-4bb2-a04f-a7ee27558cfc",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Add a DOD and Death Notification where both DOD and Notification Date is for today"
											},
											"response": []
										},
										{
											"name": "Update - Add DOD and Death Notification Informal where DOD is earlier",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "3dbb1ebf-8d00-4623-bbf5-9af8f37df221",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*set the date of death date*/\r",
															"\r",
															"//set the deathNotification valueDateTimme \r",
															"var date = new Date().toISOString().substr(0, 19);\r",
															"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
															"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
															"\r",
															"//set the date of death date\r",
															"\r",
															"var d = new Date(pm.variables.get(\"deathNotificationDateAndTime\"));\r",
															"d.setDate(d.getDate() - 1);\r",
															"var newDate = d.toISOString().substr(0, 10);\r",
															"pm.globals.set(\"dateOfDeath\", newDate);\r",
															"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "01ee90b1-ab79-466f-b831-a8998ce2e0e2",
														"exec": [
															"//Check that the Update Response has been populated correctly with new updates\r",
															"const PDSUpdateResponse = eval(pm.globals.get(\"PDSUpdateResponseValidator\"));\r",
															"\r",
															"PDSUpdateResponse.assertDateOfDeathHasBeenUpdated(pm.globals.get(\"dateOfDeath\"))\r",
															"PDSUpdateResponse.assertDeathNotificationHasBeenUpdated()\r",
															"PDSUpdateResponse.assertVersionIdHasBeenUpdated()\r",
															"\r",
															"//Send HL7 Retrieve message \r",
															"eval(pm.globals.get(\"SendHL7RetrievePatientMessage\"))();\r",
															"\r",
															"//Check the HL7 Response has been populated with the new DoD and Death Notification\r",
															"setTimeout(function () {\r",
															"const HL7response = eval(pm.globals.get(\"HL7ResponseValidator\"));\r",
															"      HL7response.assertHL7DateOfDeathIs(pm.globals.get(\"dateOfDeath\").replace(/-/g, ''))\r",
															"      HL7response.assertHL7DeathNotificationDateIs(pm.globals.get(\"deathNotificationDateAndTime\").substr(0, 10).replace(/-/g, ''))\r",
															"      HL7response.assertHL7DeathNotificationIs(\"3\")\r",
															"}, 2000);\r",
															"\r",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"content-type": true
												}
											},
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n\t\"patches\": [\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/deceasedDateTime\",\n\t\t\t\"value\": \"{{dateOfDeath}}\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/extension/-\",\n\t\t\t\"value\": {\n\t\t\t\t\"extension\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"deathNotificationStatus\",\n\t\t\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"code\": \"1\",\n\t\t\t\t\t\t\t\t\t\"display\": \"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\n\t\t\t\t\t\t\t\t\t\"system\": \"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\n\t\t\t\t\t\t\t\t\t\"version\": \"1.0.0\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"systemEffectiveDate\",\n\t\t\t\t\t\t\"valueDateTime\": \"{{deathNotificationDateAndTime}}\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"\n\t\t\t}\n\t\t}\n\t]\n}",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "4346f3a2-9655-4ea2-a3e6-53d69e4be631",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Add a DOD and Death Notification where both DOD is before Notification Date"
											},
											"response": []
										},
										{
											"name": "Update - Replace DoD and Death Notification Informal",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "53e9275f-3b89-45a7-90d3-14cebf85326a",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"\r",
															"/*Request specific pre-requisites\r",
															"=================================*/\r",
															"\r",
															"/*Send a PDS Update with Date of Death & Death Notification - Date of Death = 2020-01-01*/\r",
															"setTimeout(function () {\r",
															"    var Header = require(\"postman-collection\").Header;\r",
															"    let authorization = pm.environment.get(\"authorizationHeader\");\r",
															"    let asidHeader = pm.environment.get(\"asidHeader\");\r",
															"    let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
															"    let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
															"    let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
															"    let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
															"    let deathNotification = pm.globals.get(\"deathNotification\");\r",
															"\r",
															"    pm.sendRequest({\r",
															"        url: pm.environment.get(\"environment\") + '/Patient/' + pm.globals.get(\"nhsID\"),\r",
															"        method: 'PATCH',\r",
															"        header: {\r",
															"            authorization,\r",
															"            asidHeader,\r",
															"            sessionURIDHeader,\r",
															"            identityUUIDHeader,\r",
															"            contentType,\r",
															"            ifMatch\r",
															"        },\r",
															"        body: deathNotification\r",
															"\r",
															"    }, function (err, response) {\r",
															"        pm.test(\"Pre-requistie Death Notification Returns Status code 200\", function () {\r",
															"            pm.expect(response.code).to.equal(200);\r",
															"        });\r",
															"        pm.globals.set(\"metaVersionId\", response.headers.get('Etag'));\r",
															"        pm.variables.set(\"versionId\", parseInt(response.json().meta.versionId));\r",
															"        console.log(\"Patient record version is: \" + pm.variables.get(\"versionId\"));\r",
															"        console.log(\"Patient record version is: \" + pm.globals.get(\"metaVersionId\"));\r",
															"    });\r",
															"}, 9000);\r",
															"\r",
															"/*set the date of death date*/\r",
															"\r",
															"//set the deathNotification valueDateTimme \r",
															"var date = new Date().toISOString().substr(0, 19);\r",
															"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
															"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
															"\r",
															"//set the date of death date\r",
															"\r",
															"var todayDate = date.substring(0, 10);\r",
															"pm.globals.set(\"dateOfDeath\", todayDate);\r",
															"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))"
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "1ef888a6-e662-41a4-a961-8cd3be11ba2b",
														"exec": [
															"//Check that the Update Response has been populated correctly with new updates\r",
															"const PDSUpdateResponse = eval(pm.globals.get(\"PDSUpdateResponseValidator\"));\r",
															"\r",
															"PDSUpdateResponse.assertDateOfDeathHasBeenUpdated(pm.globals.get(\"dateOfDeath\"))\r",
															"PDSUpdateResponse.assertDeathNotificationHasBeenUpdated()\r",
															"PDSUpdateResponse.assertVersionIdHasBeenUpdated()\r",
															"\r",
															"//Send HL7 Retrieve message \r",
															"eval(pm.globals.get(\"SendHL7RetrievePatientMessage\"))();\r",
															"\r",
															"//Check the HL7 Response has been populated with the new DoD and Death Notification\r",
															"\r",
															"setTimeout(function () {\r",
															"const HL7response = eval(pm.globals.get(\"HL7ResponseValidator\"));\r",
															"      HL7response.assertHL7DateOfDeathIs(pm.globals.get(\"dateOfDeath\").replace(/-/g, ''))\r",
															"      HL7response.assertHL7DeathNotificationDateIs(pm.globals.get(\"deathNotificationDateAndTime\").substr(0, 10).replace(/-/g, ''))\r",
															"      HL7response.assertHL7DeathNotificationIs(\"3\")\r",
															"}, 2000);\r",
															"\r",
															"\r",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"value": "{{metaVersionId}}",
														"type": "text"
													},
													{
														"key": "Content-Type",
														"value": "application/json-patch+json",
														"type": "text"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"value": "{{from_asid}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"value": "{{role_id}}",
														"type": "text"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"value": "{{user_id}}",
														"type": "text"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n\t\"patches\": [\n\t\t{\n\t\t\t\"op\": \"replace\",\n\t\t\t\"path\": \"/deceasedDateTime\",\n\t\t\t\"value\": \"{{dateOfDeath}}\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"replace\",\n\t\t\t\"path\": \"/extension/0\",\n\t\t\t\"value\": {\n\t\t\t\t\"extension\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"deathNotificationStatus\",\n\t\t\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"code\": \"1\",\n\t\t\t\t\t\t\t\t\t\"display\": \"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\n\t\t\t\t\t\t\t\t\t\"system\": \"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\n\t\t\t\t\t\t\t\t\t\"version\": \"1.0.0\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"systemEffectiveDate\",\n\t\t\t\t\t\t\"valueDateTime\": \"{{deathNotificationDateAndTime}}\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"\n\t\t\t}\n\t\t}\n\t]\n}",
													"options": {
														"raw": {
															"language": "json"
														}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "511ed2fa-a1a7-407b-9add-34a4dc1486aa",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Replace a DOD and Death Notification where there is already a DOD and Notification present for the patient"
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Error Responses",
									"item": [
										{
											"name": "INVALID_UPDATE",
											"item": [
												{
													"name": "Error Responses - INVALID_UPDATE",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "896bdbc5-8c5a-4daf-ba47-d6af3028eeec",
																"exec": [
																	"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
																	"======================================================================================================*/\r",
																	"\r",
																	"/*Build a HL7 xml Request with random Patient Data*/\r",
																	"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
																	"\r",
																	"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
																	"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
																	"\r",
																	"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
																	"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
																	"\r",
																	"\r",
																	"/*Create dataSets for testing 'Update Patient' Error Exceptions scenarios and assign the \"scenario\" array to a variable to be used in Test*/\r",
																	"\r",
																	"/*set a new deathdate to tomorrow*/\r",
																	"var d = new Date();\r",
																	"d.setDate(d.getDate() + 1);\r",
																	"var newDate = d.toISOString().substr(0, 10);\r",
																	"pm.variables.set(\"furturedateOfDeath\", newDate);\r",
																	"\r",
																	"/*set a new deathDate before birthDate*/\r",
																	"var d = new Date(pm.globals.get(\"birthDate\"));\r",
																	"d.setDate(d.getDate() - 1);\r",
																	"var newDate = d.toISOString().substr(0, 10);\r",
																	"pm.variables.set(\"dateOfDeathBeforeDOB\", newDate);\r",
																	"\r",
																	"\r",
																	"let scenario = [\r",
																	"    {\r",
																	"        desc: \"Update - Add DOD cannot be Updated without a Notification\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - when adding a deceased date, a death notification status must also be supplied\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Add DOD Cannot be before DOB\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.variables.get(\"dateOfDeathBeforeDOB\") + '\"},{\"op\":\"add\",\"path\":\"/extension/-\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - deceased date cannot be before the birth date\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Add DOD Cannot be in the future\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.variables.get(\"furturedateOfDeath\") + '\"},{\"op\":\"add\",\"path\":\"/extension/-\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - deceased date cannot be in the future\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Replace DOD when one doesnt exist\",\r",
																	"        body: '{\"patches\":[{\"op\":\"replace\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"add\",\"path\":\"/extension/-\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - Invalid patch - can't replace non-existent object 'deceasedDateTime'\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Add Notification cannot be Updated without DOD\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/extension/-\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - when adding a death notification status, a deceased date must also be supplied\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - DOD with a malformed patch\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"add\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - 'deceasedDateTime' is not a 'json-pointer'\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Death Notification with missing extension url\",\r",
																	"        body: '{\"patches\":[{\"op\":\"replace\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"replace\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}]}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - no id or url found for path with root /extension/0\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Death Notification with a malformed patch - format\",\r",
																	"        body: '{\"patches\":[{\"op\":\"replace\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"replace\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - Invalid payload received - incorrect format\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Death Notification with a malformed patch - path\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"add\",\"path\":\"/extension/\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - Invalid patch - '' is not a valid sequence index\",\r",
																	"        severity: \"error\"\r",
																	"    }\r",
																	"]\r",
																	"pm.variables.set('scenario', scenario);\r",
																	"console.log(pm.variables.get(\"scenario\"))"
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "d211bb1a-1fdc-4f55-9220-a7b154a35bfe",
																"exec": [
																	"/*assign local scenario variable from \"scenario\" variable set in prerequisite script and also assign header variables from variables*/\r",
																	"\r",
																	"var Header = require(\"postman-collection\").Header;\r",
																	"let scenario = pm.variables.get('scenario');\r",
																	"let asidHeader = pm.environment.get(\"asidHeader\");\r",
																	"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
																	"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
																	"let authorization = pm.environment.get(\"authorizationHeader\");\r",
																	"let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
																	"let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
																	"\r",
																	"\r",
																	"/*for each scenario dataSet loop the Update Patient service and ensure the correct Error Reponse is returned for each scenario*/\r",
																	"\r",
																	"scenario.forEach(s => {\r",
																	"    console.log(\"scenario under test is: \" + s.desc);\r",
																	"\r",
																	"    pm.sendRequest({\r",
																	"        url: pm.environment.get(\"environment\") + \"/Patient/\" + pm.globals.get(\"nhsID\"),\r",
																	"        method: 'PATCH',\r",
																	"        header: {\r",
																	"            authorization,\r",
																	"            asidHeader,\r",
																	"            sessionURIDHeader,\r",
																	"            identityUUIDHeader,\r",
																	"            contentType,\r",
																	"            ifMatch\r",
																	"        },\r",
																	"        body: s.body\r",
																	"    }, function (err, res) {\r",
																	"        let response = res.json();\r",
																	"        pm.test(\"The correct error response has been returned for: \" + s.desc, () => {\r",
																	"            pm.expect(res.code).to.equal(s.statusCode);\r",
																	"            pm.expect(response.issue[0].details.coding[0].code).to.eql(s.code);\r",
																	"            pm.expect(response.issue[0].details.coding[0].display).to.eql(s.display);\r",
																	"            pm.expect(response.issue[0].severity).to.equal(s.severity);\r",
																	"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');\r",
																	"        });\r",
																	"    }\r",
																	"    )\r",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{environment}}",
															"host": [
																"{{environment}}"
															]
														}
													},
													"response": []
												},
												{
													"name": "Error Responses - INVALID_UPDATE2",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "79242f15-fdef-4de4-9fbd-4bd574d33165",
																"exec": [
																	"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
																	"======================================================================================================*/\r",
																	"\r",
																	"/*Build a HL7 xml Request with random Patient Data*/\r",
																	"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
																	"\r",
																	"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
																	"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
																	"\r",
																	"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
																	"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
																	"\r",
																	"\r",
																	"/*Request specific pre-requisites\r",
																	"=================================*/\r",
																	"\r",
																	"/*Send a PDS Update with Date of Death & Death Notification - Date of Death = 2020-01-01*/\r",
																	"setTimeout(function () {\r",
																	"    var Header = require(\"postman-collection\").Header;\r",
																	"    let asidHeader = pm.environment.get(\"asidHeader\");\r",
																	"    let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
																	"    let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
																	"    let authorization = pm.environment.get(\"authorizationHeader\");\r",
																	"    let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
																	"    let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
																	"    let deathNotification = pm.globals.get(\"deathNotification\");\r",
																	"\r",
																	"    pm.sendRequest({\r",
																	"        url: pm.environment.get(\"environment\") + '/Patient/' + pm.globals.get(\"nhsID\"),\r",
																	"        method: 'PATCH',\r",
																	"        header: {\r",
																	"            authorization,\r",
																	"            asidHeader,\r",
																	"            sessionURIDHeader,\r",
																	"            identityUUIDHeader,\r",
																	"            contentType,\r",
																	"            ifMatch\r",
																	"        },\r",
																	"        body: deathNotification\r",
																	"\r",
																	"    }, function (err, response) {\r",
																	"        pm.test(\"Pre-requistie Death Notification Returns Status code 200\", function () {\r",
																	"            pm.expect(response.code).to.equal(200);\r",
																	"        });\r",
																	"        pm.globals.set(\"metaVersionId\", response.headers.get('Etag'));\r",
																	"        pm.variables.set(\"versionId\", parseInt(response.json().meta.versionId));\r",
																	"        console.log(\"Patient record version is: \" + pm.variables.get(\"versionId\"));\r",
																	"        console.log(\"Patient record version is: \" + pm.globals.get(\"metaVersionId\"));\r",
																	"    });\r",
																	"}, 9000);\r",
																	"\r",
																	"/*set the date of death date*/\r",
																	"\r",
																	"//set the deathNotification valueDateTimme \r",
																	"var date = new Date().toISOString().substr(0, 19);\r",
																	"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
																	"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
																	"\r",
																	"//set the date of death date\r",
																	"\r",
																	"var todayDate = date.substring(0, 10);\r",
																	"pm.globals.set(\"dateOfDeath\", todayDate);\r",
																	"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))\r",
																	"\r",
																	"let scenario = [\r",
																	"    {\r",
																	"        desc: \"Update - Add DoD and Death Notification when one already exists - INVALID_UPDATE\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"add\",\"path\":\"/extension/-\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_UPDATE\",\r",
																	"        display: \"Invalid update with error - cannot add multiple death notification states\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Remove DOD and Death Notification not permitted\",\r",
																	"        body: '{\"patches\":[{\"op\":\"test\",\"path\":\"/deceasedDateTime\",\"value\":\"2020-01-01T00:00:00+00:00\"},{\"op\":\"remove\",\"path\":\"/deceasedDateTime\"},{\"op\":\"test\",\"path\":\"/extension/0/url\",\"value\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"},{\"op\":\"remove\",\"path\":\"/extension/0\"}]}',\r",
																	"        statusCode: 403,\r",
																	"        code: \"FORBIDDEN_UPDATE\",\r",
																	"        display: \"Forbidden update with error - source not permitted to remove 'deceasedDateTime'\",\r",
																	"        severity: \"information\"\r",
																	"    },\r",
																	"]\r",
																	"pm.variables.set('scenario', scenario);\r",
																	"console.log(pm.variables.get(\"scenario\"))"
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "356992e2-167e-4061-8b55-e3e06cf8c692",
																"exec": [
																	"/*assign local scenario variable from \"scenario\" variable set in prerequisite script and also assign header variables from variables*/\r",
																	"\r",
																	"var Header = require(\"postman-collection\").Header;\r",
																	"let scenario = pm.variables.get('scenario');\r",
																	"let asidHeader = pm.environment.get(\"asidHeader\");\r",
																	"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
																	"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
																	"let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
																	"let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
																	"\r",
																	"\r",
																	"/*for each scenario dataSet loop the Update Patient service and ensure the correct Error Reponse is returned for each scenario*/\r",
																	"\r",
																	"scenario.forEach(s => {\r",
																	"    console.log(\"scenario under test is: \" + s.desc);\r",
																	"\r",
																	"    pm.sendRequest({\r",
																	"        url: pm.environment.get(\"environment\") + \"/Patient/\" + pm.globals.get(\"nhsID\"),\r",
																	"        method: 'PATCH',\r",
																	"        header: {\r",
																	"            asidHeader,\r",
																	"            sessionURIDHeader,\r",
																	"            identityUUIDHeader,\r",
																	"            contentType,\r",
																	"            ifMatch\r",
																	"        },\r",
																	"        body: s.body\r",
																	"    }, function (err, res) {\r",
																	"        let response = res.json();\r",
																	"        pm.test(\"The correct error response has been returned for: \" + s.desc, () => {\r",
																	"            pm.expect(res.code).to.equal(s.statusCode);\r",
																	"            pm.expect(response.issue[0].details.coding[0].code).to.eql(s.code);\r",
																	"            pm.expect(response.issue[0].details.coding[0].display).to.eql(s.display);\r",
																	"            pm.expect(response.issue[0].severity).to.equal(s.severity);\r",
																	"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');\r",
																	"        });\r",
																	"    }\r",
																	"    )\r",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [
															{
																"key": "If-Match",
																"type": "text",
																"value": "{{metaVersionId}}"
															},
															{
																"key": "Content-Type",
																"type": "text",
																"value": "application/json-patch+json"
															},
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"url": {
															"raw": "{{environment}}",
															"host": [
																"{{environment}}"
															]
														},
														"description": "Add a DOD and Death Notification where there is already a DOD and Notification present for the patient is not permitted"
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "INVALID_VALUE",
											"item": [
												{
													"name": "Error Responses - INVALID_VALUE",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "ca926623-d942-4555-95e6-60d27c0502d1",
																"exec": [
																	"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
																	"======================================================================================================*/\r",
																	"\r",
																	"/*Build a HL7 xml Request with random Patient Data*/\r",
																	"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
																	"\r",
																	"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
																	"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
																	"\r",
																	"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
																	"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
																	"\r",
																	"\r",
																	"/*Create dataSets for testing 'Update Patient' Error Exceptions scenarios and assign the \"scenario\" array to a variable to be used in Test*/\r",
																	"\r",
																	"let scenario = [\r",
																	"    {\r",
																	"        desc: \"Update - Death Notification with a invalid status code\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"replace\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"3\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_VALUE\",\r",
																	"        display: \"Invalid value - 3 in field 'valueCodeableConcept/coding/0/code'\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - DOD with invalid date format\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"20200101\"},{\"op\":\"replace\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_VALUE\",\r",
																	"        display: \"Invalid value - '20200101' in field 'deceasedDateTime'\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Add DoD and Replace Death Notification is not permitted\",\r",
																	"        body: '{\"patches\":[{\"op\":\"add\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"replace\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 400,\r",
																	"        code: \"INVALID_VALUE\",\r",
																	"        display: \"Invalid value with error - Cannot find sub-object for update\",\r",
																	"        severity: \"error\"\r",
																	"    },\r",
																	"\r",
																	"]\r",
																	"pm.variables.set('scenario', scenario);\r",
																	"console.log(pm.variables.get(\"scenario\"))"
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "48cc4617-42d1-4452-bd4d-6ad004f7cfd7",
																"exec": [
																	"/*assign local scenario variable from \"scenario\" variable set in prerequisite script and also assign header variables from variables*/\r",
																	"\r",
																	"var Header = require(\"postman-collection\").Header;\r",
																	"let scenario = pm.variables.get('scenario');\r",
																	"let asidHeader = pm.environment.get(\"asidHeader\");\r",
																	"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
																	"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
																	"let authorization = pm.environment.get(\"authorizationHeader\");\r",
																	"let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
																	"let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
																	"\r",
																	"\r",
																	"/*for each scenario dataSet loop the Update Patient service and ensure the correct Error Reponse is returned for each scenario*/\r",
																	"\r",
																	"scenario.forEach(s => {\r",
																	"    console.log(\"scenario under test is: \" + s.desc);\r",
																	"\r",
																	"    pm.sendRequest({\r",
																	"        url: pm.environment.get(\"environment\") + \"/Patient/\" + pm.globals.get(\"nhsID\"),\r",
																	"        method: 'PATCH',\r",
																	"        header: {\r",
																	"            authorization,\r",
																	"            asidHeader,\r",
																	"            sessionURIDHeader,\r",
																	"            identityUUIDHeader,\r",
																	"            contentType,\r",
																	"            ifMatch\r",
																	"        },\r",
																	"        body: s.body\r",
																	"    }, function (err, res) {\r",
																	"        let response = res.json();\r",
																	"        pm.test(\"The correct error response has been returned for: \" + s.desc, () => {\r",
																	"            pm.expect(res.code).to.equal(s.statusCode);\r",
																	"            pm.expect(response.issue[0].details.coding[0].code).to.eql(s.code);\r",
																	"            pm.expect(response.issue[0].details.coding[0].display).to.eql(s.display);\r",
																	"            pm.expect(response.issue[0].severity).to.equal(s.severity);\r",
																	"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');\r",
																	"        });\r",
																	"    }\r",
																	"    )\r",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{environment}}",
															"host": [
																"{{environment}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										},
										{
											"name": "FORBIDDEN_UPDATE",
											"item": [
												{
													"name": "Update - Remove Informal DoD and Death Notification is not permitted",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "5792c65c-cbd6-43b3-9d48-35641c0f92b4",
																"exec": [
																	"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
																	"======================================================================================================*/\r",
																	"\r",
																	"/*Build a HL7 xml Request with random Patient Data*/\r",
																	"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
																	"\r",
																	"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
																	"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
																	"\r",
																	"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
																	"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
																	"\r",
																	"\r",
																	"/*Request specific pre-requisites\r",
																	"=================================*/\r",
																	"\r",
																	"/*Send a PDS Update with Date of Death & Death Notification - Date of Death = 2020-01-01*/\r",
																	"setTimeout(function () {\r",
																	"    var Header = require(\"postman-collection\").Header;\r",
																	"    let asidHeader = pm.environment.get(\"asidHeader\");\r",
																	"    let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
																	"    let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
																	"    let authorization = pm.environment.get(\"authorizationHeader\");\r",
																	"    let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
																	"    let ifMatch = new Header({ key: 'If-Match', value: pm.globals.get(\"metaVersionId\") });\r",
																	"    let deathNotification = pm.globals.get(\"deathNotification\");\r",
																	"\r",
																	"    pm.sendRequest({\r",
																	"        url: pm.environment.get(\"environment\") + '/Patient/' + pm.globals.get(\"nhsID\"),\r",
																	"        method: 'PATCH',\r",
																	"        header: {\r",
																	"            authorization,\r",
																	"            asidHeader,\r",
																	"            sessionURIDHeader,\r",
																	"            identityUUIDHeader,\r",
																	"            contentType,\r",
																	"            ifMatch\r",
																	"        },\r",
																	"        body: deathNotification\r",
																	"\r",
																	"    }, function (err, response) {\r",
																	"        pm.test(\"Pre-requistie Death Notification Returns Status code 200\", function () {\r",
																	"            pm.expect(response.code).to.equal(200);\r",
																	"        });\r",
																	"        pm.globals.set(\"metaVersionId\", response.headers.get('Etag'));\r",
																	"        pm.variables.set(\"versionId\", parseInt(response.json().meta.versionId));\r",
																	"        console.log(\"Patient record version is: \" + pm.variables.get(\"versionId\"));\r",
																	"        console.log(\"Patient record version is: \" + pm.globals.get(\"metaVersionId\"));\r",
																	"    });\r",
																	"}, 9000);\r",
																	"\r",
																	"/*set the date of death date*/\r",
																	"\r",
																	"//set the deathNotification valueDateTimme \r",
																	"var date = new Date().toISOString().substr(0, 19);\r",
																	"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
																	"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
																	"\r",
																	"//set the date of death date\r",
																	"\r",
																	"var todayDate = date.substring(0, 10);\r",
																	"pm.globals.set(\"dateOfDeath\", todayDate);\r",
																	"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))"
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "42a79a9d-b933-4cc4-9480-65ef33fb8050",
																"exec": [
																	"var response = pm.response.json();\r",
																	"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
																	"const error = eval(pm.globals.get(\"errorMessage\"));\r",
																	"\r",
																	"assertThat.statusCodeIs(403);\r",
																	"error.assertCodeIs(\"FORBIDDEN_UPDATE\");\r",
																	"error.assertDisplayIs(\"Forbidden update with error - source not permitted to remove 'deceasedDateTime'\");\r",
																	"error.assertSeverityIs(\"information\");\r",
																	"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");\r",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "PATCH",
														"header": [
															{
																"key": "If-Match",
																"type": "text",
																"value": "{{metaVersionId}}"
															},
															{
																"key": "Content-Type",
																"type": "text",
																"value": "application/json-patch+json"
															},
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"patches\": [\n\t\t{\n\t\t\t\"op\": \"test\",\n\t\t\t\"path\": \"/deceasedDateTime\",\n\t\t\t\"value\": \"2020-01-01T00:00:00+00:00\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"remove\",\n\t\t\t\"path\": \"/deceasedDateTime\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"test\",\n\t\t\t\"path\": \"/extension/0/url\",\n\t\t\t\"value\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"remove\",\n\t\t\t\"path\": \"/extension/0\"\n\t\t}\n\t]\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{environment}}/Patient/:nhs_id",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient",
																":nhs_id"
															],
															"variable": [
																{
																	"id": "d12b438e-7463-403c-8d39-58c151614ddb",
																	"key": "nhs_id",
																	"value": "{{nhsID}}",
																	"type": "string"
																}
															]
														},
														"description": "Removal of an Informal DOD and Death Notification is not permitted"
													},
													"response": []
												},
												{
													"name": "Update - Add Formal Death Notification is not permitted",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "56c28d9b-680d-4b46-b5ca-9f48362d271a",
																"exec": [
																	"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
																	"======================================================================================================*/\r",
																	"\r",
																	"/*Build a HL7 xml Request with random Patient Data*/\r",
																	"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
																	"\r",
																	"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
																	"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
																	"\r",
																	"/*Send a PDS Search request to obtain the Patient nhs Id & Patient record version id*/\r",
																	"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
																	"\r",
																	"\r",
																	"/*Request specific pre-requisites\r",
																	"=================================*/\r",
																	"\r",
																	"//set the deathNotification valueDateTimme \r",
																	"var date = new Date().toISOString().substr(0, 19);\r",
																	"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
																	"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
																	"\r",
																	"//set the date of death date\r",
																	"\r",
																	"var todayDate = date.substring(0, 10);\r",
																	"pm.globals.set(\"dateOfDeath\", todayDate);\r",
																	"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))"
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "8b956e88-6dca-46cc-9cac-ce2bfd871c1f",
																"exec": [
																	"var response = pm.response.json();\r",
																	"const assertThat = eval(pm.globals.get(\"assertThatUtil\"));\r",
																	"const error = eval(pm.globals.get(\"errorMessage\"));\r",
																	"\r",
																	"assertThat.statusCodeIs(403);\r",
																	"error.assertCodeIs(\"FORBIDDEN_UPDATE\");\r",
																	"error.assertDisplayIs(\"Forbidden update with error - source not permitted to set a formal death notification status\");\r",
																	"error.assertSeverityIs(\"information\");\r",
																	"error.assertSystemIs(\"https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode\");\r",
																	""
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "PATCH",
														"header": [
															{
																"key": "If-Match",
																"type": "text",
																"value": "{{metaVersionId}}"
															},
															{
																"key": "Content-Type",
																"type": "text",
																"value": "application/json-patch+json"
															},
															{
																"key": "{{nhsd-asid-header}}",
																"type": "text",
																"value": "{{from_asid}}"
															},
															{
																"key": "{{nhsd-session-urid-header}}",
																"type": "text",
																"value": "{{role_id}}"
															},
															{
																"key": "{{nhsd-identity-uuid-header}}",
																"type": "text",
																"value": "{{user_id}}"
															}
														],
														"body": {
															"mode": "raw",
															"raw": "{\n\t\"patches\": [\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/deceasedDateTime\",\n\t\t\t\"value\": \"{{dateOfDeath}}\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/extension/-\",\n\t\t\t\"value\": {\n\t\t\t\t\"extension\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"deathNotificationStatus\",\n\t\t\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"code\": \"2\",\n                        \t        \"display\": \"Formal - death notice received from Registrar of Deaths\",\n\t\t\t\t\t\t\t\t\t\"system\": \"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\n\t\t\t\t\t\t\t\t\t\"version\": \"1.0.0\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"systemEffectiveDate\",\n\t\t\t\t\t\t\"valueDateTime\": \"{{deathNotificationDateAndTime}}\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"\n\t\t\t}\n\t\t}\n\t]\n}",
															"options": {
																"raw": {
																	"language": "json"
																}
															}
														},
														"url": {
															"raw": "{{environment}}/Patient/:nhs_id",
															"host": [
																"{{environment}}"
															],
															"path": [
																"Patient",
																":nhs_id"
															],
															"variable": [
																{
																	"id": "56354e33-dcb3-4e79-9892-8a24f1be1d0c",
																	"key": "nhs_id",
																	"value": "{{nhsID}}",
																	"type": "string"
																}
															]
														},
														"description": "Add a Formal DOD and Death Notification is not permitted"
													},
													"response": []
												},
												{
													"name": "Error Responses - Formal - FORBIDDEN_UPDATE",
													"event": [
														{
															"listen": "prerequest",
															"script": {
																"id": "2d2bfccc-5db8-4360-acbd-5622e91142e0",
																"exec": [
																	"let scenario = [\r",
																	"    {\r",
																	"        desc: \"Update - Replace DOD and Death Notification not permitted where exisiting is a Formal Notification\",\r",
																	"        body: '{\"patches\":[{\"op\":\"replace\",\"path\":\"/deceasedDateTime\",\"value\":\"' + pm.globals.get(\"dateOfDeath\") + '\"},{\"op\":\"replace\",\"path\":\"/extension/0\",\"value\":{\"extension\":[{\"url\":\"deathNotificationStatus\",\"valueCodeableConcept\":{\"coding\":[{\"code\":\"1\",\"display\":\"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\"system\":\"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\"version\":\"1.0.0\"}]}},{\"url\":\"systemEffectiveDate\",\"valueDateTime\":\"' + pm.globals.get(\"deathNotificationDateAndTime\") + '\"}],\"url\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"}}]}',\r",
																	"        statusCode: 403,\r",
																	"        code: \"FORBIDDEN_UPDATE\",\r",
																	"        display: \"Forbidden update with error - source not permitted to update death details when Death Notification Status is formal\",\r",
																	"        severity: \"information\"\r",
																	"    },\r",
																	"    {\r",
																	"        desc: \"Update - Remove DOD and Death Notification not permitted where exisiting is a Formal Notification\",\r",
																	"        body: '{\"patches\":[{\"op\":\"test\",\"path\":\"/deceasedDateTime\",\"value\":\"2020-05-21T00:00:00+00:00\"},{\"op\":\"remove\",\"path\":\"/deceasedDateTime\"},{\"op\":\"test\",\"path\":\"/extension/0/url\",\"value\":\"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"},{\"op\":\"remove\",\"path\":\"/extension/0\"}]}',\r",
																	"        statusCode: 403,\r",
																	"        code: \"FORBIDDEN_UPDATE\",\r",
																	"        display: \"Forbidden update with error - source not permitted to remove 'deceasedDateTime'\",\r",
																	"        severity: \"information\"\r",
																	"    },\r",
																	"]\r",
																	"pm.variables.set('scenario', scenario);\r",
																	"console.log(pm.variables.get(\"scenario\"))"
																],
																"type": "text/javascript"
															}
														},
														{
															"listen": "test",
															"script": {
																"id": "7e59c403-0930-43c2-b1d5-1ca9f08b8372",
																"exec": [
																	"/*assign local scenario variable from \"scenario\" variable set in prerequisite script and also assign header variables from variables*/\r",
																	"\r",
																	"var Header = require(\"postman-collection\").Header;\r",
																	"let scenario = pm.variables.get('scenario');\r",
																	"let asidHeader = pm.environment.get(\"asidHeader\");\r",
																	"let sessionURIDHeader = pm.environment.get(\"sessionURIDHeader\");\r",
																	"let identityUUIDHeader = pm.environment.get(\"identityUUIDHeader\");\r",
																	"let authorization = pm.environment.get(\"authorizationHeader\");\r",
																	"let contentType = new Header({ key: 'Content-Type', value: 'application/json-patch+json' });\r",
																	"let ifMatch = new Header({ key: 'If-Match', value: 'W/\"3\"' });\r",
																	"\r",
																	"\r",
																	"/*for each scenario dataSet loop the Update Patient service and ensure the correct Error Reponse is returned for each scenario*/\r",
																	"\r",
																	"scenario.forEach(s => {\r",
																	"    console.log(\"scenario under test is: \" + s.desc);\r",
																	"\r",
																	"    pm.sendRequest({\r",
																	"        url: pm.environment.get(\"environment\") + \"/Patient/5900010406\",\r",
																	"        method: 'PATCH',\r",
																	"        header: {\r",
																	"            authorization,\r",
																	"            asidHeader,\r",
																	"            sessionURIDHeader,\r",
																	"            identityUUIDHeader,\r",
																	"            contentType,\r",
																	"            ifMatch\r",
																	"        },\r",
																	"        body: s.body\r",
																	"    }, function (err, res) {\r",
																	"        let response = res.json();\r",
																	"        pm.test(\"The correct error response has been returned for: \" + s.desc, () => {\r",
																	"            pm.expect(res.code).to.equal(s.statusCode);\r",
																	"            pm.expect(response.issue[0].details.coding[0].code).to.eql(s.code);\r",
																	"            pm.expect(response.issue[0].details.coding[0].display).to.eql(s.display);\r",
																	"            pm.expect(response.issue[0].severity).to.equal(s.severity);\r",
																	"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');\r",
																	"        });\r",
																	"    }\r",
																	"    )\r",
																	"});"
																],
																"type": "text/javascript"
															}
														}
													],
													"request": {
														"method": "GET",
														"header": [],
														"url": {
															"raw": "{{environment}}",
															"host": [
																"{{environment}}"
															]
														}
													},
													"response": []
												}
											],
											"protocolProfileBehavior": {},
											"_postman_isSubFolder": true
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								},
								{
									"name": "Demo",
									"item": [
										{
											"name": "Create Patient",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "8901f375-11e6-4861-a361-04d998a63066",
														"exec": [
															"/*Generic pre-requisites - Create me a Patient and obtain the latest Patient record meta version id order to perform the update\r",
															"======================================================================================================*/\r",
															"\r",
															"/*Build a HL7 xml Request with random Patient Data*/\r",
															"eval(pm.globals.get(\"BuildHL7Patient\"))();\r",
															"\r",
															"/*Send a HL7 xml Create Patient Request to DSA and check an acknowledgment response is returned*/\r",
															"eval(pm.globals.get(\"SendHL7Patient\"))();\r",
															"\r",
															"/*Send a PDS Search request to obtain the Patient nhs Id*/\r",
															"eval(pm.globals.get(\"SendPDSSearch\"))();\r",
															"\r",
															"/*Send a PDS Retrieve request to obtain the versionID*/\r",
															"eval(pm.globals.get(\"SendPDSRetrieve\"))();"
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [],
												"url": {
													"raw": "{{environment}}",
													"host": [
														"{{environment}}"
													]
												}
											},
											"response": []
										},
										{
											"name": "Retrieve Patient",
											"event": [
												{
													"listen": "test",
													"script": {
														"id": "503fe679-8979-46b2-bf2b-e1a340d05764",
														"exec": [
															"var response = pm.response.json();",
															"pm.globals.set(\"metaVersionId\", pm.response.headers.get('Etag'));",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "prerequest",
													"script": {
														"id": "7a3c89ca-d2d0-4dfa-9a0a-1b461ffc2f64",
														"exec": [
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"request": {
												"method": "GET",
												"header": [
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"id": "68bdfe12-cc18-441e-9aa7-0e411e6c811d",
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												}
											},
											"response": []
										},
										{
											"name": "Update - Add DOD and Death Notification Informal for Today",
											"event": [
												{
													"listen": "prerequest",
													"script": {
														"id": "48bdfd21-0c08-4155-9785-b705956ea53f",
														"exec": [
															"/*Request specific pre=requisites\r",
															"=================================*/\r",
															"\r",
															"/*set the date of death date*/\r",
															"\r",
															"//set the deathNotification valueDateTimme \r",
															"var date = new Date().toISOString().substr(0, 19);\r",
															"pm.globals.set(\"deathNotificationDateAndTime\", date);\r",
															"console.log(\"Death Notification Date = \" + pm.globals.get(\"deathNotificationDateAndTime\"))\r",
															"\r",
															"//set the date of death date\r",
															"\r",
															"var todayDate = date.substring(0, 10);\r",
															"pm.globals.set(\"dateOfDeath\", todayDate);\r",
															"console.log(\"Date of Death Date = \" + pm.globals.get(\"dateOfDeath\"))\r",
															""
														],
														"type": "text/javascript"
													}
												},
												{
													"listen": "test",
													"script": {
														"id": "3f9b33e2-60ac-4721-bc6a-f031ba014aa9",
														"exec": [
															"//Check that the Update Response has been populated correctly with new updates\r",
															"const PDSUpdateResponse = eval(pm.globals.get(\"PDSUpdateResponseValidator\"));\r",
															"\r",
															"PDSUpdateResponse.assertDateOfDeathHasBeenUpdated(pm.globals.get(\"dateOfDeath\"))\r",
															"PDSUpdateResponse.assertDeathNotificationHasBeenUpdated()\r",
															"\r",
															"\r",
															"\r",
															""
														],
														"type": "text/javascript"
													}
												}
											],
											"protocolProfileBehavior": {
												"disabledSystemHeaders": {
													"content-type": true
												}
											},
											"request": {
												"method": "PATCH",
												"header": [
													{
														"key": "If-Match",
														"type": "text",
														"value": "{{metaVersionId}}"
													},
													{
														"key": "Content-Type",
														"type": "text",
														"value": "application/json-patch+json"
													},
													{
														"key": "{{nhsd-asid-header}}",
														"type": "text",
														"value": "{{from_asid}}"
													},
													{
														"key": "{{nhsd-session-urid-header}}",
														"type": "text",
														"value": "{{role_id}}"
													},
													{
														"key": "{{nhsd-identity-uuid-header}}",
														"type": "text",
														"value": "{{user_id}}"
													}
												],
												"body": {
													"mode": "raw",
													"raw": "{\n\t\"patches\": [\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/deceasedDateTime\",\n\t\t\t\"value\": \"{{dateOfDeath}}\"\n\t\t},\n\t\t{\n\t\t\t\"op\": \"add\",\n\t\t\t\"path\": \"/extension/-\",\n\t\t\t\"value\": {\n\t\t\t\t\"extension\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"deathNotificationStatus\",\n\t\t\t\t\t\t\"valueCodeableConcept\": {\n\t\t\t\t\t\t\t\"coding\": [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\"code\": \"1\",\n\t\t\t\t\t\t\t\t\t\"display\": \"Informal - death notice received via an update from a local NHS Organisation such as GP or Trust\",\n\t\t\t\t\t\t\t\t\t\"system\": \"https://fhir.hl7.org.uk/CodeSystem/UKCore-DeathNotificationStatus\",\n\t\t\t\t\t\t\t\t\t\"version\": \"1.0.0\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\t\"url\": \"systemEffectiveDate\",\n\t\t\t\t\t\t\"valueDateTime\": \"{{deathNotificationDateAndTime}}\"\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\t\"url\": \"https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-DeathNotificationStatus\"\n\t\t\t}\n\t\t}\n\t]\n}",
													"options": {
														"raw": {}
													}
												},
												"url": {
													"raw": "{{environment}}/Patient/:nhs_id",
													"host": [
														"{{environment}}"
													],
													"path": [
														"Patient",
														":nhs_id"
													],
													"variable": [
														{
															"key": "nhs_id",
															"value": "{{nhsID}}",
															"type": "string"
														}
													]
												},
												"description": "Add a DOD and Death Notification where both DOD and Notification Date is for today"
											},
											"response": []
										}
									],
									"protocolProfileBehavior": {},
									"_postman_isSubFolder": true
								}
							],
							"protocolProfileBehavior": {},
							"_postman_isSubFolder": true
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "Related Person",
					"item": [
						{
							"name": "Related Person 1",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900009068\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-09\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"surname\");",
											"pm.variables.set(\"relatedPersonGiven\", [\"first\",\"second\"]);",
											"pm.variables.set(\"relatedPersonPrefix\", \"Dame\");",
											"pm.variables.set(\"relatedPersonSuffix\", [\"MBA\"]);",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"brother\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"",
											"pm.variables.set(\"relatedPersonRelationshipNOKCode\", \"N\");",
											"pm.variables.set(\"relatedPersonRelationshipNOKDisplay\", \"Next-of-Kin\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"home\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"telephone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-09\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"09000000009\");",
											"",
											"pm.variables.set(\"relatedPersonAddressLine\", JSON.stringify([\"12\",\"weetwood\",\"somewhere\",\"somewhere town\",\"a county\"]));",
											"pm.variables.set(\"relatedPersonPostalCode\", \"BD2 2LQ\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"email\");",
											"pm.variables.set(\"relatedPersonPreferredContactTime\", \"12:00\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredWrittenCommsFormat\", \"Large print\");",
											"pm.variables.set(\"relatedPersonCorrespondenceIndicator\", \"yes\");",
											"",
											"pm.variables.set(\"relatedPersonLanguage\", \"ab\");",
											"pm.variables.set(\"relatedPersonLanguageDisplay\", \"Abkhazian\");",
											"pm.variables.set(\"relatedPersonInterpreter\", true);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "5561c941-556a-42de-b041-bbe5d968da99",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"yes\"\n* Related Person PreferredContactMethod Extension - where it is set to \"email\"\n* Related Person PreferredContactTimes Extension - when it has been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has been set to \"Large Print\"\n* Related Person Language Extension - when a language has been set and intepreter required set to \"yes\"\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to brother\n* Related Person RelationshipClass - when class has been set to Agent\n* Related Person Next of Kin - when next of kin has been set to \"yes\"\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "test",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "4f75ed6c-9f2f-4708-b2e0-a11bbc3f9559",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "b61188ff-164d-4585-830d-2d1afdde91ae",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900009068\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-09\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"surname\");",
											"pm.variables.set(\"relatedPersonGiven\", [\"first\",\"second\"]);",
											"pm.variables.set(\"relatedPersonPrefix\", \"Dame\");",
											"pm.variables.set(\"relatedPersonSuffix\", [\"MBA\"]);",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"brother\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"",
											"pm.variables.set(\"relatedPersonRelationshipNOKCode\", \"N\");",
											"pm.variables.set(\"relatedPersonRelationshipNOKDisplay\", \"Next-of-Kin\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"home\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"telephone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-09\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"09000000009\");",
											"",
											"pm.variables.set(\"relatedPersonAddressLine\", JSON.stringify([\"12\",\"weetwood\",\"somewhere\",\"somewhere town\",\"a county\"]));",
											"pm.variables.set(\"relatedPersonPostalCode\", \"BD2 2LQ\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"email\");",
											"pm.variables.set(\"relatedPersonPreferredContactTime\", \"12:00\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredWrittenCommsFormat\", \"Large print\");",
											"pm.variables.set(\"relatedPersonCorrespondenceIndicator\", \"yes\");",
											"",
											"pm.variables.set(\"relatedPersonLanguage\", \"ab\");",
											"pm.variables.set(\"relatedPersonLanguageDisplay\", \"Abkhazian\");",
											"pm.variables.set(\"relatedPersonInterpreter\", true);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson/B67F085F",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson",
										"B67F085F"
									],
									"variable": [
										{
											"id": "5561c941-556a-42de-b041-bbe5d968da99",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"yes\"\n* Related Person PreferredContactMethod Extension - where it is set to \"email\"\n* Related Person PreferredContactTimes Extension - when it has been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has been set to \"Large Print\"\n* Related Person Language Extension - when a language has been set and intepreter required set to \"yes\"\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to brother\n* Related Person RelationshipClass - when class has been set to Agent\n* Related Person Next of Kin - when next of kin has been set to \"yes\"\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 2",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900007820\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-09\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"anothername\");",
											"pm.variables.set(\"relatedPersonGiven\", [\"firstname\"]);",
											"pm.variables.set(\"relatedPersonPrefix\", \"Dr\");",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"child\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Guardian\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"work\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"fax\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-09\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"12345678912\");",
											"",
											"pm.variables.set(\"relatedPersonAddressLine\", JSON.stringify([\"2 Westwood Ave\",\"Eccleshill\",\"Bradford\",\"County\"]));",
											"pm.variables.set(\"relatedPersonPostalCode\", \"BD2 2KM\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"letter\");",
											"pm.variables.set(\"relatedPersonPreferredContactTime\", \"14:00\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredWrittenCommsFormat\", \"Braille\");",
											"pm.variables.set(\"relatedPersonCorrespondenceIndicator\", \"no\");",
											"",
											"pm.variables.set(\"relatedPersonLanguage\", \"ab\");",
											"pm.variables.set(\"relatedPersonLanguageDisplay\", \"Abkhazian\");",
											"pm.variables.set(\"relatedPersonInterpreter\", false);",
											"",
											"pm.variables.set(\"relatedPersonRank1\", 1);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "5f2b8428-9472-42e0-96be-f0534a356779",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"no\"\n* Related Person PreferredContactMethod Extension - where it is set to \"letter\"\n* Related Person PreferredContactTimes Extension - when it has been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has been set to \"Braille\"\n* Related Person Language Extension - when a language has been set and intepreter required set to \"no\"\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"child\"\n* Related Person RelationshipClass - when class has been set to \"Guardian of patient\"\n* Related Person Next of Kin - when next of kin has been set to \"no\"\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 3",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900007073\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-15\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"anothername\");",
											"pm.variables.set(\"relatedPersonGiven\", [\"firstname\"]);",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"partner\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Personal relationship\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"pager\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"textphone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-15\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"12345678912\");",
											"",
											"pm.variables.set(\"relatedPersonAddressLine\", JSON.stringify([\"13 Westwood Ave\",\"Eccleshill\",\"bradford\",\"County\"]));",
											"pm.variables.set(\"relatedPersonPostalCode\", \"BD2 2KM\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"minicom\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredWrittenCommsFormat\", \"Audio tape\");",
											"//pm.variables.set(\"relatedPersonCorrespondenceIndicator\", \"undefined\");",
											"",
											"pm.variables.set(\"relatedPersonLanguage\", \"Null\");",
											"pm.variables.set(\"relatedPersonLanguageDisplay\", \"Unknown\");",
											"pm.variables.set(\"relatedPersonInterpreter\", true);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "a5f9318a-cf32-4c59-8561-d9dff560a7a8",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"no\"\n* Related Person PreferredContactMethod Extension - where it is set to \"Minicom (Textphone)\"\n* Related Person PreferredContactTimes Extension - when it has been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has been set to \"Audio tape\"\n* Related Person Language Extension - when a language has been set and intepreter required set to \"yes\"\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"domestic partner\"\n* Related Person RelationshipClass - when class has been set to \"Personal\"\n* Related Person Next of Kin - when next of kin has been set to \"no\"\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 4",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900019241\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-15\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"test\");",
											"pm.variables.set(\"relatedPersonGiven\", undefined);",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"relative\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"home\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"email\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-15\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"a.s@mail.com\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"not telephone contact\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "74958165-fd26-4773-9573-c6d121592617",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"no\"\n* Related Person PreferredContactMethod Extension - where it is set to \"No Telephone contact\"\n* Related Person PreferredContactTimes Extension - when it has not been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has not been set\n* Related Person Language Extension - when a language has not been set\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"family member\"\n* Related Person RelationshipClass - when class has been set to \"Agent\"\n* Related Person Next of Kin - when next of kin has not been set\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 5",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900008290\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-15\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"test\");",
											"pm.variables.set(\"relatedPersonGiven\", undefined);",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"father\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"answering machine\"); ",
											"pm.variables.set(\"relatedPersontelecomType\", \"telephone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-15\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"23533452345325\");",
											"",
											"pm.variables.set(\"relatedPersonPostalCode\", \"BD2 2KM\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"sign language\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "4d4c3fca-3407-493d-b938-51d3b7a92226",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"no\"\n* Related Person PreferredContactMethod Extension - where it is set to \"Sign Language\"\n* Related Person PreferredContactTimes Extension - when it has not been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has not been set\n* Related Person Language Extension - when a language has not been set\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"father\"\n* Related Person RelationshipClass - when class has been set to \"Agent\"\n* Related Person Next of Kin - when next of kin has not been set\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 6",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900005798\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-15\");",
											"",
											"pm.variables.set(\"relatedPersonFamily\", \"test\");",
											"pm.variables.set(\"relatedPersonGiven\", undefined);",
											"",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"mother\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"",
											"pm.variables.set(\"relatedPersontelecomUse\", \"emergency\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"telephone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-15\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"23533452345325\");",
											"",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"telephone\");"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "af17297b-63c3-4cf3-a0c2-5ffa72086f8b",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  when it is marked as \"no\"\n* Related Person PreferredContactMethod Extension - where it is set to \"Telephone\"\n* Related Person PreferredContactTimes Extension - when it has not been set\n* Related Person PreferredWrittenCommunicationFormat Extension - when it has not been set\n* Related Person Language Extension - when a language has not been set\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"mother\"\n* Related Person RelationshipClass - when class has been set to \"Agent\"\n* Related Person Next of Kin - when next of kin has not been set\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 7",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json();",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											""
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900000605\");",
											"",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-04-16\");",
											"pm.variables.set(\"relatedPersonFamily\", \"test\");",
											"pm.variables.set(\"relatedPersonGiven\", undefined);",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"next of kin\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"pm.variables.set(\"relatedPersontelecomUse\", \"mobile\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"telephone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-04-16\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"23533452345325\");",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"telephone via proxy\");",
											"pm.variables.set(\"relatedPersonPatientID\", \"5900005798\");",
											""
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "eab3a87e-4b03-44c0-ae76-623d926252e0",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  where it has not been set\n* Related Person PreferredContactMethod Extension - where it has not been set\n* Related Person PreferredContactTimes Extension - where it has not been set\n* Related Person PreferredWrittenCommunicationFormat Extension - where it has not been set\n* Related Person Language Extension - where it has not been set\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"Next-of-Kin\"\n* Related Person RelationshipClass - when class has been set to \"Agent\"\n* Related Person Next of Kin - when next of kin has not been set\n* Related Person Telecom"
							},
							"response": []
						},
						{
							"name": "Related Person 8 multiple related persons",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"var response = pm.response.json(); ",
											"eval(pm.globals.get(\"patient\"));",
											"",
											"// Apply Common Mapping Tests",
											"//======================================",
											"eval(pm.globals.get(\"relatedPersonMappings\"))();",
											"",
											"",
											"//Checks performed on Subsequent Related people for the given Patient",
											"let rank = pm.variables.get('rank');",
											"rank.forEach(r => {",
											"    var relatedPerson = getRelatedPerson(r);",
											"        pm.test(\"Subsequent related person family name has been mapped correctly\", function () {",
											"            pm.expect(relatedPerson.resource.name[0].family).to.eql(r.relatedPersonFamily);",
											"        });",
											"        ",
											"        pm.test(\"Subsequent related person rank has been mapped correctly and in the correct order\", function () {",
											"        let entryInstance = (r.relatedPersonRank- 1)",
											"        if (!r.relatedPersonRank) {",
											"            pm.expect(relatedPerson.resource.extension).to.eql(undefined)",
											"            pm.expect(response.entry[16].resource.name[0].family).to.eql(r.relatedPersonFamily)",
											"        }",
											"        else {",
											"              pm.expect(response.entry[entryInstance].resource.extension[0].valuePositiveInt).to.eql(r.relatedPersonRank);",
											"        }",
											"        });",
											"        ",
											"        pm.test(\"Subsequent related person relationshipType has been mapped correctly\", function () {",
											"            ",
											"            if (r.relatedPersonRelationshipType == \"self\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"ONESELF\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"self\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"foster parent\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"PRNFOST\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"foster parent\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"sister\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"SIS\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"sister\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"spouse\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"SPS\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"spouse\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"step parent\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"STPPRN\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"step parent\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"not known\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"U\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Unknown\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"guardian\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"Guardian\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Guardian of patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"polygamous partner\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"PolygamousPartner\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Polygamous Partner of patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"dependant\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"Dependant\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Dependant of patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"nondependant\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"NonDependant\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Non Dependant of patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"proxy contact\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"ProxyContact\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Proxy Contact for patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"proxy communication\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"ProxyCommunication\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Proxy Communication for patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"proxy contact communication\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"ProxyContactCommunication\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Proxy Contact and Communication for patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"carer\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"Carer\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Carer of patient\");",
											"            }",
											"            else if (r.relatedPersonRelationshipType == \"not specified\") {",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].code).to.eql(\"NotSpecified\");",
											"                pm.expect(relatedPerson.resource.relationship[0].coding[0].display).to.eql(\"Not Specified\");",
											"            }",
											"            else pm.expect.fail(\"relationshipType not been mapped correctly\");",
											"        });",
											"});",
											"",
											"//Ensure that the total number of related persons returned is 17",
											"pm.test(\"Returned number of Related Persons is 17\", () =>{",
											"    pm.expect(patient().getTotalNumberOfPatients()).to.eql(17);",
											"});",
											"",
											"response.entry[16].resource.name[0].family",
											"//getRelatdPerson function",
											"function getRelatedPerson(r) {",
											"    for (let person of response.entry) {",
											"        try {",
											"\t\t\tif (person.resource.name[0].family == r.relatedPersonFamily) {",
											"\t\t\t    console.log(person);",
											"\t\t\t\treturn person;",
											"\t\t\t}",
											"            } catch(err) {",
											"                }",
											"        }",
											"}"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900013863\");",
											"",
											"//Related Person 1",
											"pm.variables.set(\"relatedPersonPeriodStart\", \"2020-05-07\");",
											"pm.variables.set(\"relatedPersonAddressLine\", JSON.stringify([\"Rank1\",\"Rank1\"]));",
											"pm.variables.set(\"relatedPersonPostalCode\", \"RANK1\");",
											"pm.variables.set(\"relatedPersonFamily\", \"Rank1\");",
											"pm.variables.set(\"relatedPersonGiven\", undefined);",
											"pm.variables.set(\"relatedPersonRelationshipType\", \"parent\");",
											"pm.variables.set(\"relatedPersonRelationshipClass\", \"Agent\");",
											"pm.variables.set(\"relatedPersontelecomUse\", \"temporary\");",
											"pm.variables.set(\"relatedPersontelecomType\", \"telephone\");",
											"pm.variables.set(\"relatedPersontelecomPeriodStart\", \"2020-05-07\");",
											"pm.variables.set(\"relatedPersontelecomValue\", \"\");",
											"pm.variables.set(\"relatedPersonPreferredContactMethod\", \"visit\");",
											"pm.variables.set(\"relatedPersonRank1\", 1);",
											"",
											"",
											"//Subsequent Related people for this patient",
											"let rank = [",
											"    {relatedPersonRank: 2,",
											"     relatedPersonRelationshipType: \"self\",",
											"     relatedPersonFamily: \"Rank2\"},",
											"     ",
											"    {relatedPersonRank: 3,",
											"     relatedPersonRelationshipType: \"foster parent\",",
											"     relatedPersonFamily: \"Rank3\"},",
											"     ",
											"    {relatedPersonRank: 4,",
											"     relatedPersonRelationshipType: \"sister\",",
											"     relatedPersonFamily: \"Rank4\"},",
											"     ",
											"    {relatedPersonRank: 5,",
											"     relatedPersonRelationshipType: \"spouse\",",
											"     relatedPersonFamily: \"Rank5\"},  ",
											"",
											"    {relatedPersonRank: 6,",
											"     relatedPersonRelationshipType: \"step parent\",",
											"     relatedPersonFamily: \"Rank6\"},  ",
											"     ",
											"    {relatedPersonRank: 7,",
											"     relatedPersonRelationshipType: \"not known\",",
											"     relatedPersonFamily: \"Rank7\"},  ",
											"    ",
											"    {relatedPersonRank: 8,",
											"     relatedPersonRelationshipType: \"guardian\",",
											"     relatedPersonFamily: \"Rank8\"},",
											"     ",
											"    {relatedPersonRank: 9,",
											"     relatedPersonRelationshipType: \"polygamous partner\",",
											"     relatedPersonFamily: \"Rank9\"},",
											"     ",
											"    {relatedPersonRank: 10,",
											"     relatedPersonRelationshipType: \"dependant\",",
											"     relatedPersonFamily: \"Rank10\"},",
											"",
											"    {relatedPersonRank: 11,",
											"     relatedPersonRelationshipType: \"nondependant\",",
											"     relatedPersonFamily: \"Rank11\"},",
											"     ",
											"    {relatedPersonRank: 12,",
											"     relatedPersonRelationshipType: \"proxy contact\",",
											"     relatedPersonFamily: \"Rank12\"},",
											"     ",
											"    {relatedPersonRank: 13,",
											"    relatedPersonRelationshipType: \"proxy communication\",",
											"    relatedPersonFamily: \"Rank13\"},",
											"     ",
											"    {relatedPersonRank: 14,",
											"    relatedPersonRelationshipType: \"proxy contact communication\",",
											"    relatedPersonFamily: \"Rank14\"},",
											"     ",
											"    {relatedPersonRank: 15,",
											"    relatedPersonRelationshipType: \"carer\",",
											"    relatedPersonFamily: \"Rank15\"},",
											" ",
											"    {relatedPersonRank: 16,",
											"    relatedPersonRelationshipType: \"not specified\",",
											"    relatedPersonFamily: \"Rank16\"},",
											"    ",
											"    {relatedPersonRelationshipType: \"not specified\",",
											"    relatedPersonFamily: \"No Rank\"},",
											"];",
											"pm.variables.set('rank', rank);"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "a16a626c-308d-4d44-9ca5-d5d317a9ff87",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that all Patient Related Person data is mapped correctly to the Fhir PDS RelatedPerson response, specifically:\n\n* Related Person Address\n* Related Person Rank Extension -  when Rank has been set\n* Related Person CorrespondenceIndicator Extension -  where it has not been set\n* Related Person PreferredContactMethod Extension - where it has been set to \"Visit\"\n* Related Person PreferredContactTimes Extension - where it has not been set\n* Related Person PreferredWrittenCommunicationFormat Extension - where it has not been set\n* Related Person Language Extension - where it has not been set\n* Related Person Name\n* Related Person Period start date\n* Related Person RelationshipType - when type has been set to \"parent\"\n* Related Person RelationshipClass - when class has been set to \"Agent\"\n* Related Person Next of Kin - when next of kin has not been set\n* Related Person Telecom\n\nThis also tests:\n\n* where there are mora than 1 related persons for the Patient, all the related persons are returned\n* the remainder of the Relationship types; self, foster parent, sister, spouse, step parent, not known\n* where get related person by (related person) object id is triggered, then only that related person is returned for the given patient"
							},
							"response": []
						},
						{
							"name": "Related Person Error Responses",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "e57f793c-3c38-4919-be4e-2392110ef8a1",
										"exec": [
											"/*assign local scenario variable from \"scenario\" variable set in prerequisite script and also assign header variables from variables*/\r",
											"\r",
											"let scenario = pm.variables.get('scenario');\r",
											"let asidHeader = pm.variables.get(\"asidHeader\");\r",
											"let sessionURIDHeader = pm.variables.get(\"sessionURIDHeader\");\r",
											"let identityUUIDHeader = pm.variables.get(\"identityUUIDHeader\");\r",
											"\r",
											"/*for each scenario dataSet loop the Related People Patient service and ensure the correct Error Reponse is returned for each scenario*/   \r",
											"\r",
											"  scenario.forEach(s => {\r",
											"    console.log(\"scenario under test is: \" + s.desc);\r",
											"\r",
											"   pm.sendRequest({\r",
											"        url: pm.environment.get(\"environment\") + \"/Patient/\" + s.nhs_id + \"/RelatedPerson\",\r",
											"        method: 'GET',\r",
											"        header: { asidHeader, sessionURIDHeader, identityUUIDHeader }\r",
											"        \r",
											"    }, function (err, res) {\r",
											"        let response = res.json();\r",
											"        pm.test('The correct error response has been returned for: ' + s.desc, () => {\r",
											"            pm.expect(res.code).to.equal(s.responseStatus);\r",
											"            pm.expect(response.issue[0].details.coding[0].display).to.equal(s.responseDisplay);\r",
											"            pm.expect(response.issue[0].details.coding[0].code).to.equal(s.responseCode);\r",
											"            pm.expect(response.issue[0].severity).to.equal(s.responseSeverity);\r",
											"            pm.expect(response.issue[0].details.coding[0].system).to.equal('https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode');\r",
											"            \r",
											"        })\r",
											"    })\r",
											"\r",
											"});"
										],
										"type": "text/javascript"
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"id": "8a994d0b-16d5-4000-8e78-27ea37241a1c",
										"exec": [
											"pm.variables.set(\"patientId\", \"5900006360\"); ",
											"",
											"/*Create dataSets for testing 'Retrieve Patient' Error Exceptions scenarios and assign the \"scenario\" array to a variable to be used in Test*/ ",
											"  ",
											"   let scenario = [",
											"       {desc: \"INVALID_NHS_NUMBER - invalid check digit\", ",
											"        nhs_id: \"9000000000\", ",
											"        responseStatus: 400, ",
											"        responseIssueCode: \"value\", ",
											"        responseSeverity: \"error\", ",
											"        responseCode: \"INVALID_NHS_NUMBER\", ",
											"        responseDisplay: \"NHS Number Invalid\"},",
											"        ",
											"       {desc: \"Patient has no Related Persons associated\", ",
											"        nhs_id: \"5900006360\", ",
											"        responseStatus: 404, ",
											"        responseIssueCode: \"not-found\", ",
											"        responseSeverity: \"information\", ",
											"        responseCode: \"RESOURCE_NOT_FOUND\", ",
											"        responseDisplay: \"Resource not found\"}",
											"       ]",
											"       ",
											"    pm.variables.set('scenario', scenario); "
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "NHSD-ASID",
										"type": "text",
										"value": "200000000610"
									},
									{
										"key": "NHSD-Identity-UUID",
										"type": "text",
										"value": "1234567890"
									},
									{
										"key": "NHSD-Session-URID",
										"type": "text",
										"value": "1234567890"
									}
								],
								"url": {
									"raw": "{{environment}}/Patient/:nhs_id/RelatedPerson",
									"host": [
										"{{environment}}"
									],
									"path": [
										"Patient",
										":nhs_id",
										"RelatedPerson"
									],
									"variable": [
										{
											"id": "94a5bd10-95ea-454f-a4fd-53a95ae00c59",
											"key": "nhs_id",
											"value": "{{patientId}}",
											"type": "string"
										}
									]
								},
								"description": "This test validates that where a Patient does not have a Related person and appropriate error response is returned."
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "9a507f42-ebdc-4300-b916-8c0ab96ee000",
				"type": "text/javascript",
				"exec": [
					"console.log('Running against environment ' + pm.environment.get('environment'));",
					"",
					"// These are the headers for the pm.sendRequest calls",
					"var Header = require('postman-collection').Header;",
					"",
					"pm.environment.set(\"asidHeader\", new Header({",
					"    key: pm.globals.get(\"nhsd-asid-header\"),",
					"    value: pm.environment.get(\"from_asid\")",
					"}));",
					"",
					"pm.environment.set(\"sessionURIDHeader\", new Header({",
					"    key: pm.globals.get(\"nhsd-session-urid-header\"),",
					"    value: pm.environment.get(\"role_id\")",
					"}));",
					"",
					"pm.environment.set(\"identityUUIDHeader\", new Header({",
					"    key: pm.globals.get(\"nhsd-identity-uuid-header\"),",
					"    value: pm.environment.get(\"user_id\")",
					"}));",
					"",
					"pm.environment.set(\"authorizationHeader\", new Header({",
					"    key: 'Authorization',",
					"    value: 'Bearer ' + pm.globals.get(\"token\")",
					"}));",
					"",
					"",
					"// When running against apigee, there are a set of headers which we don't want to pass in.",
					"if (pm.environment.get('environment').toLowerCase().includes('api.service.nhs.uk')) {",
					"    console.log(\"Removing headers when running via apigee\");",
					"    pm.request.headers.remove('{{nhsd-asid-header}}');",
					"    pm.request.headers.remove('{{nhsd-identity-uuid-header}}');",
					"    pm.request.headers.remove('NHSD-Identity-JWT');",
					"",
					"    pm.environment.set(\"asidHeader\", undefined);",
					"    pm.environment.set(\"identityUUIDHeader\", undefined);",
					"",
					"    console.log(\"Adding Authorization header\");",
					"    pm.request.headers.add({",
					"        key: 'Authorization',",
					"        value: 'Bearer ' + pm.globals.get(\"token\")",
					"    });",
					"",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "f5640239-c903-4595-bac7-e9e41a913759",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "0d797220-5d6b-47f6-b877-2616996bfe42",
			"key": "metaVersion",
			"value": "173",
			"type": "string"
		}
	],
	"protocolProfileBehavior": {}
}
